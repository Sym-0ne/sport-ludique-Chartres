# Configuration du routeur
## ğŸ”§ 1. Configuration initial 
1. PremiÃ¨re Ã©tape : RÃ©initialiser le routeur a sa configuration d'origine sans le mot de passe admin. 

```
#DÃ©marrer le routeur et presser Ctrl+Break pour entrer en mode rommon.

confreg 0x2142
reset

#Le routeur redÃ©marre sans configuration.

enable
configure terminal
config-register 0x2102 #Permet de remettre le switch sur le bon registre
end
write
```
2. Changer le Nom du routeur 
```
enable 
config
hostname CHA-R1
```
## ğŸ”§ 2. Configuration des interfaces 
1. Configurer la premiÃ¨re interface Gigabit0/0
```
interface GigabitEthernet0/0
 ip address 183.44.28.1 255.255.255.252
 ip nat outside
 no shutdown
```
2. Configurer la deuxiÃ¨me interface Gigabit0/1
```
interface GigabitEthernet0/1
 no shutdown
```
<div class="annotate" markdown>
> Info(1)
</div>
1. Ã€ noter que le port du switch cÅ“ur de rÃ©seau reliÃ© au routeur doit Ãªtre configurÃ© en mode **trunk**.

## â• 3. Ajout des vlans 
1. Ajout du Vlan de management
```
interface GigabitEthernet0/1.120
 encapsulation dot1Q 120
 ip address 10.10.120.20 255.255.255.0
 ip access-group 100 out
```
2. Ajout du Vlan d'interconnection
```
interface GigabitEthernet0/1.223
 encapsulation dot1Q 223
 ip address 172.28.63.20 255.255.255.0
 ip nat inside
```
## ğŸŸ¢ 4. Activation du SSH 
1. GÃ©nÃ©ration des clef RSA 
```
crypto key generate rsa
2048
```
2. CrÃ©ation d'un compte local
```
username admin privilege 15 secret MonMotDePasse
```
3. Activation du SSH sur les lignes VTY 
```
line vty 0 4
login local 
transport input ssh 
```
4. Selection de la bonne version SSH 
```
ip ssh version 2
```
## ğŸ”§ 5. Configuration du routage 

1. Activation du NAT 
```
ip nat inside source list 1 interface GigabitEthernet0/0 overload
ip nat inside source list 20 interface GigabitEthernet0/0 overload
```
2. CrÃ©ation des routes de retour
```
ip route 172.28.32.0 255.255.255.0 172.28.63.1 # Gestion des actifs
ip route 172.28.33.0 255.255.255.0 172.28.63.1 # Serveurs
ip route 172.28.35.0 255.255.255.0 172.28.63.1 # Clients
ip route 172.28.63.128 255.255.255.128 172.28.63.1 # LAN2DMZ
ip route 172.28.62.0 255.255.255.0 172.28.63.1 # DMZ Publique
```
3. CrÃ©ation de la route par dÃ©faut
```
ip route 0.0.0.0 0.0.0.0 183.44.28.2
```

## â• 6. Mise en place des ACL 
1. Creation de l'acces list contenant les rÃ©seaux qui auront accÃ¨s a internet
```
access-list 1 permit 172.28.32.0 0.0.31.255
access-list 20 permit 192.168.28.0 0.0.0.255
```
<div class="annotate" markdown>
> Info (1)
</div>
1. Ã€ noter que le masque inversÃ© renvoie vers le rÃ©seau **172.28.32.0/19**, ce qui correspond Ã  la plage de VLAN qui nous est attribuÃ©e.

2. CrÃ©ation de lâ€™access list qui va bloquer lâ€™accÃ¨s Ã  Internet au rÃ©seau de management.
```
access-list 100 deny ip 10.10.120.0 0.0.0.255 any
access-list 100 permit ip any any
```
## ğŸ”€ 7. Redirection DNS 

La redirection DNS permettra aux machines nâ€™ayant pas de serveur DNS dans leur configuration dâ€™utiliser le DNS interne de Chartres.


```
ip dns server 
ip name-server 172.28.33.2
ip domain-lookup
```
## âš™ï¸ 8. Protocole HSRP 
Le HSRP est un protocole qui permet de crÃ©er une adresse VIP (Virtual IP) offrant la haute disponibilitÃ© entre deux routeurs.

Dans notre cas, nous allons mettre en place le HSRP entre nos deux routeurs, R1 et R2, chaque routeur Ã©tant connectÃ© Ã  un FAI diffÃ©rent.

<div class="annotate" markdown>
> Info (1)
</div>
1. Voir la page [Routeur](https://sym-0ne.github.io/sport-ludique-Chartres/Routeur/hsrp/) pour la configuration du HSRP.

## ğŸ”€ PAT
Le PAT, ou Port Address Translation, permet de traduire des adresses en fonction du port contactÃ© par la requÃªte.

Le dÃ©tail de notre PAT se trouve sur la [page associÃ©](https://sym-0ne.github.io/sport-ludique-Chartres/Routeur/PAT/).