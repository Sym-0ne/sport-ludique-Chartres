{"config":{"lang":["fr"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Accueil - P\u00f4le Chartres","text":""},{"location":"#presentation","title":"Pr\u00e9sentation","text":"<p>BTS SIO option SISR Ann\u00e9e scolaire 2025-2026  </p> <p>Enseignant : Ludovic MERY Co-Enseignant : Kevin Huet  </p>"},{"location":"#le-pole-chartres","title":"Le P\u00f4le Chartres","text":"<p>Le site de Chartres est le si\u00e8ge de SportLudique SARL et regroupe les fonctions strat\u00e9giques et administratives de l\u2019entreprise. Il constitue le c\u0153ur op\u00e9rationnel de la soci\u00e9t\u00e9 avec plusieurs d\u00e9partements cl\u00e9s.</p>"},{"location":"#fonctions-et-departements","title":"Fonctions et d\u00e9partements","text":"<p>Le site de Chartres accueille :</p> <ul> <li>Direction g\u00e9n\u00e9rale </li> <li>Marketing </li> <li>Finances </li> <li>Ressources humaines </li> <li>Direction des Services Informatiques (DSI)</li> </ul> <p>La DSI est dirig\u00e9e par Monsieur Claude Postic et compte 4 techniciens. Le service RH est dirig\u00e9 par Madame Helen Paisley-Le Bihan.</p>"},{"location":"#mission-du-site","title":"Mission du site","text":"<p>Le P\u00f4le Chartres assure la coordination des activit\u00e9s de l\u2019ensemble des sites et joue un r\u00f4le central dans :</p> <ul> <li>La gestion administrative et financi\u00e8re  </li> <li>Le marketing et la promotion des produits  </li> <li>La supervision de la production et de la logistique via les autres sites  </li> <li>Le support et la maintenance informatique interne  </li> </ul>"},{"location":"#informations-cles","title":"Informations cl\u00e9s","text":"<ul> <li>Si\u00e8ge social : Agglom\u00e9ration chartraine  </li> <li>Effectif sur le site : Inclus dans les 452 employ\u00e9s de l\u2019entreprise  </li> <li>Activit\u00e9 : Conception et fabrication d\u2019articles de sports et loisirs, ainsi que la proposition d\u2019installations cl\u00e9 en main aux collectivit\u00e9s  </li> </ul>"},{"location":"#schema-reseau","title":"Schema r\u00e9seau","text":""},{"location":"#schema-physique","title":"Schema physique","text":""},{"location":"#photo-de-la-baie","title":"Photo de la baie","text":""},{"location":"#photo-de-la-baie-serveur","title":"Photo de la baie serveur","text":""},{"location":"DNS/DNS%20Resolveur/","title":"Configuration DNS Resolveur UNBOUND","text":""},{"location":"DNS/DNS%20Resolveur/#1-installation-de-unbound","title":"1. Installation de UNBOUND","text":"<pre><code>sudo apt update\nsudo apt install unbound -y\n</code></pre> <p>Unbound se lancera automatiquement apr\u00e8s l'installation.</p> <p>V\u00e9rifier si c'est bien le cas :</p> <pre><code>sudo systemctl status unbound\n</code></pre>"},{"location":"DNS/DNS%20Resolveur/#2-configuration-du-dns","title":"2. Configuration du DNS","text":"<p>Editer le fichier suivant :</p> <pre><code>sudo nano /etc/unbound/unbound.conf\n</code></pre> <p>Puis ajouter votre conf :</p> <pre><code>server:\n    #######################################################################\n    #  PARAM\u00c8TRES G\u00c9N\u00c9RAUX DU SERVEUR UNBOUND\n    #######################################################################\n\n    # Interfaces d'\u00e9coute\n    interface: 0.0.0.0\n    interface: ::0\n    port: 53\n\n    # Autorise IPv4, d\u00e9sactive IPv6 si inutile\n    do-ip4: yes\n    do-ip6: no\n    do-udp: yes\n    do-tcp: yes\n\n    # R\u00e9seaux autoris\u00e9s \u00e0 interroger le r\u00e9solveur\n    access-control: 127.0.0.0/8 allow        # localhost\n    access-control: 172.28.33.0/24 allow     # LAN\n    access-control: 172.28.62.0/24 allow     # DMZ\n    access-control: 172.28.35.0/24 allow     # CLIENTS\n    access-control: 0.0.0.0/0 refuse         # tout le reste bloqu\u00e9\n\n    # D\u00e9sactive DNSSEC\n    module-config: \"iterator\"\n    val-permissive-mode: no\n    auto-trust-anchor-file: \"\"\n    trust-anchor-signaling: no\n    harden-dnssec-stripped: no\n\n    # R\u00e9pertoires de travail\n    directory: \"/etc/unbound\"\n    logfile: \"/var/log/unbound.log\"\n    verbosity: 1\n\n    # Cache\n    cache-min-ttl: 60\n    cache-max-ttl: 86400\n\n#######################################################################\n#  D\u00c9CLARATION DES ZONES AVEC SERVEURS FORWARDERS SP\u00c9CIFIQUES\n#######################################################################\n\n# Zone locale -&gt; DNS de la DMZ\nstub-zone:\n    name: \"chartres.sportludique.fr\"\n    stub-addr: 172.28.62.1     # \u2190 IP du DNS autoritaire de la DMZ\n\n# Zone de l\u2019entreprise -&gt; DNS de l\u2019enseignant\nstub-zone:\n    name: \"sportludique.fr\"\n    stub-addr: 121.183.90.205  # \u2190 IP du DNS de l\u2019enseignant\n</code></pre> <p>V\u00e9rifier la syntaxe :</p> <pre><code>sudo unbound-checkconf\n</code></pre> <p>Si il y a des erreurs, le DNS ne fonctionnerra pas car vous ne pourrais pas red\u00e9marrer le service donc il faut absolument r\u00e9soudre les erreurs.</p> <p>Sinon red\u00e9marrer le service :</p> <pre><code>sudo systemctl restart unbound\nsudo systemctl enable unbound\n</code></pre> <p>V\u00e9rifier que le fichier comporte les bonnes adresses IP :</p> <pre><code>sudo cat /etc/resolv.conf\n</code></pre> <p>Le r\u00e9sultat attendus est :</p> <pre><code>search chartres.sportludique.fr\nnameserver 172.28.33.4\nnamserver 172.28.33.5\n</code></pre>"},{"location":"DNS/DNS%20Resolveur/#3-verification","title":"3. V\u00e9rification","text":"<p>Tester depuis le client avec \"nslookup ns1.chartres.sportludique.fr\".</p> <p>Il devrait renvoyer l'adresse IP du DNS autorit\u00e9.</p> <p>Et ensuite tester depuis un poste d'un autre groupe avec la m\u00eame commande.</p> <p>Il devrait renvoyer l'adresse IP de la FAI (183.44.28.1).</p>"},{"location":"DNS/DNS%20Resolveur/#4-configuration-dns-secondaire","title":"4. Configuration DNS Secondaire","text":"<p>Refaire toute les \u00e9tapes ci-dessus.</p> <p>Ajouter en plus le dns secondaire authorit\u00e9 :</p> <pre><code># Zone locale -&gt; DNS de la DMZ\nstub-zone:\n    name: \"chartres.sportludique.fr\"\n    stub-addr: 172.28.62.1     # \u2190 IP du DNS autoritaire primaire de la DMZ\n    stub-addr: 172.28.62.11    # \u2190 IP du DNS autoritaire secondaire de la DMZ\n</code></pre>"},{"location":"DNS/DNS-autorit%C3%A9/","title":"Configuration DNS autorit\u00e9 BIND9","text":"<p>Cette documentation sert a d\u00e9tailler l'installation et la configuration de notre serveur DNS d'autorit\u00e9 gr\u00e2ce au service BIND9 bas\u00e9 sur Debian 13.</p>"},{"location":"DNS/DNS-autorit%C3%A9/#1-preparation","title":"1. Pr\u00e9paration","text":"<p>Avant de commencer il faut se poser les bonnes questions, nous aurons donc besoin : </p> <p>1.1 Serveur d'autorit\u00e9 UNIQUEMENT  aucune r\u00e9cursivit\u00e9 sur celui-ci</p> <p>1.2 Deux zones de recherche DNS, une locale et une externe, explication sur le mkdoc de Mr Merry</p> <p>1.3 Un PAT sur le routeur pour les utilisateurs externes</p> <p>1.4 Des routes statiques sur le DNS d'autorit\u00e9 \u00e0 cause de l'IP Forwarding bloqu\u00e9 par l'IPS du StormShield</p>"},{"location":"DNS/DNS-autorit%C3%A9/#2-installation-de-bind9","title":"2. Installation de BIND9","text":"<pre><code>sudo apt update \nsudo apt upgrade \nsudo apt install bind9 bind9utils bind9-doc dnsutils -y\n</code></pre> <p>(1)</p> <ol> <li>A noter que <code>bind9utils bind9-doc dnsutils</code> ne sont que des outils suppl\u00e9mentaires pour le test du DNS et du BIND9</li> </ol>"},{"location":"DNS/DNS-autorit%C3%A9/#3-creation-des-dossier-dedies","title":"3. Cr\u00e9ation des dossier d\u00e9di\u00e9s","text":"<p>Cr\u00e9ation de dossiers o\u00f9 l'on va stocker nos fichiers de zones et attribution des droits au service BIND9</p> <pre><code>sudo mkdir -p /etc/bind/zones\nsudo chown bind:bind /etc/bind/zones\n</code></pre>"},{"location":"DNS/DNS-autorit%C3%A9/#4-configuration-des-views","title":"4. Configuration des \"views\"","text":"<p>Les \"view\" sont les diff\u00e9rentes zones que notre DNS va utiliser en fonction des adresses que ces m\u00eames zones desservent. </p> <pre><code>sudo nano /etc/bind/name.conf.local\n</code></pre> <pre><code>// === VUE INTERNE ===\nview \"internal\" {\n    match-clients { 172.28.0.0/16; 127.0.0.1; };\n    recursion no;\n\n    zone \"chartres.sportludique.fr\" {\n        type master;\n        file \"/etc/bind/zones/db.chartres.sportludique.fr.internal\";\n    };\n};\n\n// === VUE EXTERNE ===\nview \"external\" {\n    match-clients { any; };\n    recursion no;\n\n    zone \"chartres.sportludique.fr\" {\n        type master;\n        file \"/etc/bind/zones/db.chartres.sportludique.fr.external\";\n    };\n};\n</code></pre>"},{"location":"DNS/DNS-autorit%C3%A9/#5-creation-des-fichiers-de-zones","title":"5. Cr\u00e9ation des fichiers de zones","text":""},{"location":"DNS/DNS-autorit%C3%A9/#51-creation-du-fichier-internal","title":"5.1 Cr\u00e9ation du fichier \"internal\"","text":"<p>Ce fichier servira a traduire les noms de domaines en IP pour toutes les adresses du LAN. <pre><code>sudo nano /etc/bind/zones/db.chartres.sportludique.fr.internal\n</code></pre></p> <pre><code>$TTL 86400\n@   IN  SOA ns1.chartres.sportludique.fr. admin.chartres.sportludique.fr. (\n        2025100701 ; Num\u00e9ros de s\u00e9rie au format YYYY/MM/DD/01\n        3600       ; Intervalle de rafra\u00eechissement\n        1800       ; Intervalle de r\u00e9essai\n        1209600    ; Intervalle d'expiration\n        86400 )    ; Dur\u00e9e minimale de cache\n\n; Serveurs de nom\n@   IN  NS  ns1.chartres.sportludique.fr.\n\n; Enregistrements\nns1 IN  A   172.28.62.1   ; Serveur DNS d'autorit\u00e9 (nous m\u00eame)\nwww IN  A   172.28.62.5   ; Reverse Proxy\nwww.cimmob IN A 172.28.62.5\ncha IN  A   172.28.33.2   ; Serveur DNS de l'AD\n</code></pre>"},{"location":"DNS/DNS-autorit%C3%A9/#52-creation-du-fichier-external","title":"5.2 Cr\u00e9ation du fichier \"external\"","text":"<p>Ce fichier servira a traduire les noms de domaines en IP pour toutes les adresses externes \u00e0 notre infrastructure.  <pre><code>sudo nano /etc/bind/zones/db.chartres.sportludique.fr.external\n</code></pre></p> <pre><code>$TTL 86400\n@   IN  SOA ns1.chartres.sportludique.fr. admin.chartres.sportludique.fr. (\n        2025100701 ; Num\u00e9ros de s\u00e9rie au format YYYY/MM/DD/01\n        3600       ; Intervalle de rafra\u00eechissement\n        1800       ; Intervalle de r\u00e9essai\n        1209600    ; Intervalle d'expiration\n        86400 )    ; Dur\u00e9e minimale de cache\n\n; Serveurs de nom\n@   IN  NS  ns1.chartres.sportludique.fr.\n\n; Enregistrements\nns1 IN  A   183.44.28.1   ; Serveur DNS d'autorit\u00e9 (nous m\u00eame)\nwww IN  A   183.44.28.1   ; Serveur Web\nwww.cimmob IN A 183.44.28.1\n</code></pre> <p>(1)</p> <ol> <li>Tout les enregistrements pointent vers l'IP publique de R1 qui feras ensuite le lien avec le LAN gr\u00e2ce au PAT, la haute disponibilit\u00e9 seras impl\u00e9menter plus tard</li> </ol> <p>\u26a0\ufe0f\u26a0\ufe0f\u26a0\ufe0f Tout changement dans la configuration des zones requier l'incr\u00e9mentation du \"Num\u00e9ros de s\u00e9rie\" pour prendre effet \u26a0\ufe0f\u26a0\ufe0f\u26a0\ufe0f</p>"},{"location":"DNS/DNS-autorit%C3%A9/#6-desactivation-des-13-serveurs-racines","title":"6. D\u00e9sactivation des 13 serveurs racines","text":"<p>Les 13 serveurs DNS racines servent \u00e0 TOUS les serveurs r\u00e9cursifs \u00e0 se diriger vers les bons serveurs DNS pour accomplir leur r\u00e9solution, nous allons les d\u00e9sactiv\u00e9es car ils rentrent en conflit avec nos views, de plus il est inutile de les avoirs \u00e9tant donn\u00e9 que ce serveur ne fait AUCUNE r\u00e9cursion. </p> <pre><code>sudo nano /etc/bind/named.conf.root-hints \n</code></pre> <p>Il suffit ensuite de mettre toutes les lignes en commentaires</p> <pre><code>// prime the server with knowledge of the root servers\n//zone \".\" {\n//      type hint;\n//      file \"/usr/share/dns/root.hints\";\n//};\n</code></pre>"},{"location":"DNS/DNS-autorit%C3%A9/#7-tests-et-verification","title":"7. Tests et v\u00e9rification :","text":"<p>Pour finir il ne nous reste plus qu'\u00e0 ex\u00e9cuter ces 3 commandes afin de v\u00e9rifier le bon fonctionnement de notre DNS</p>"},{"location":"DNS/DNS-autorit%C3%A9/#71-fichier-de-configuration","title":"7.1 Fichier de configuration","text":"<p><pre><code>sudo named-checkconf\n</code></pre> Cette commande ne nous retourne rien si le fichier de configuration est bon</p>"},{"location":"DNS/DNS-autorit%C3%A9/#72-zones","title":"7.2 Zones","text":"<pre><code>sudo named-checkzone chartres.sportludique.fr /etc/bind/zones/db.chartres.sportludique.fr.internal\nsudo named-checkzone chartres.sportludique.fr /etc/bind/zones/db.chartres.sportludique.fr.external\n</code></pre> <p>Ces deux commandes nous retourneront la valeur du num\u00e9ro de s\u00e9rie de la zone si elle est bien configur\u00e9e</p>"},{"location":"DNS/DNS-autorit%C3%A9/#8-pare-feux-local-ufw","title":"8. Pare-feux local (UFW)","text":"<p>Nous allons mettre en place un firewall local gr\u00e2ce a UFW (1) afin de bloquer toutes les connexion non necessaire au fonctionnement du DNS pour plus de s\u00e9curit\u00e9.</p> <ol> <li>Toute la documentation concernant UFW se trouve ici</li> </ol>"},{"location":"DNS/DNS-autorit%C3%A9/#81-besoins","title":"8.1 Besoins","text":"<p>Apr\u00e8s avoir installer UFW (1) il nous suffit de mettre en place 3 r\u00e8gles :</p> <ol> <li> <p> Attention, l'activation d'UFW dois \u00eatre effectuer a la fin pour ne pas perdre la connexion SSH avant d'avoir mis les r\u00e8gles qui l'autorise en place.</p> </li> <li> <p>Une r\u00e8gle qui autorise les conexion SSH depuis le r\u00e9seau de management sur mon interface de management</p> </li> <li>Une r\u00e8gle qui autorise les connexions DNS en UDP sur le port 53</li> <li>Une r\u00e8gle qui autorise les connexions DNS en TCP sur le port 53</li> </ol> <p>Ces r\u00e8gles ont \u00e9t\u00e9 d\u00e9cider gr\u00e2ce a l'\u00e9tude des connexion qui auront lieu sur notre r\u00e9seau et leur sens.</p>"},{"location":"DNS/DNS-autorit%C3%A9/#82-configuration","title":"8.2 Configuration","text":""},{"location":"DNS/DNS-autorit%C3%A9/#821-regles-par-defaut","title":"8.2.1 R\u00e8gles par d\u00e9faut","text":"<p>Par defaut nous allons refuser toutes les connexion afin d'autoriser uniquement les connexion DNS par la suite.</p> <pre><code>sudo ufw default deny incoming \nsudo ufw default deny outgoing\n</code></pre>"},{"location":"DNS/DNS-autorit%C3%A9/#822-regles-de-filtrage","title":"8.2.2 R\u00e8gles de filtrage","text":"<p>Voici donc les r\u00e8gles de filtrages a appliquer a nos interfaces : <pre><code>sudo ufw allow in on ens4 from 10.10.120.0/24 to 10.10.120.8 port 22 proto tcp\nsudo ufw allow in on ens3 from all to 172.28.62.1 port 53 proto tcp\nsudo ufw allow in on ens3 from all to 172.28.62.1 port 53 proto udp\n</code></pre></p>"},{"location":"DNS/DNS-autorit%C3%A9/#823-activation-dufw","title":"8.2.3 Activation d'UFW","text":"<p>Une fois les r\u00e8gles qui laissent passer les trafics voulues il ne nous reste plus qu'\u00e0 activer UFW afin que nos r\u00e8gles prennent effet. <pre><code>sudo ufw enable\n</code></pre></p>"},{"location":"DNS/DNS-autorit%C3%A9/#9-route-statique","title":"9. Route statique","text":""},{"location":"DNS/DNS-autorit%C3%A9/#91-pourquoi","title":"9.1 Pourquoi","text":"<p>L'ajout de routes statiques au sein de notre DNS est obligatoire \u00e0 cause de notre pare-feu Stormshield (PFW) et de la conception de notre r\u00e9seau. En effet, commeexpliqu\u00e9 ici le Stormshield et son Statefull Inspection bloquent le flux TCP, car le handshake ne s'effectue pas correctement..</p>"},{"location":"DNS/DNS-autorit%C3%A9/#92-ajout-des-routes","title":"9.2 Ajout des routes","text":"<p>Il nous faut donc ajouter manuellement des routes statiques afin de passer directement par le VFW pour rejoindre notre LAN. <pre><code>sudo nano /etc/network/interfaces\n</code></pre></p> <p>Ajouter ensuite ces lignes :</p> <pre><code># Exemple de route : up ip route add 'r\u00e9seau \u00e0 joindre' via 'passerelle' dev 'interface sortante'\nup ip route add 172.28.32.0/24 via 172.28.62.253 dev ens3\nup ip route add 172.28.33.0/24 via 172.28.62.253 dev ens3\nup ip route add 172.28.35.0/24 via 172.28.62.253 dev ens3\n</code></pre> <p>Gr\u00e2ce \u00e0 ces lignes, notre DNS passera directement par le VFW et non par le PFW (Stormshield).</p>"},{"location":"DNS/DNS-autorit%C3%A9/#10-ns1-et-ns2","title":"10. NS1 et NS2","text":"<p>Voici la phrase corrig\u00e9e :</p> <p>Afin de garantir la haute disponibilit\u00e9 de nos services, nous avons doubl\u00e9 notre PFW ainsi que notre DNS d'autorit\u00e9 (1). Dans notre cas, le cheminement r\u00e9seau change en fonction des \u00e9quipements en service ou hors service.</p> <ol> <li>\u00c0 noter que c'est \u00e0 cause de la Stateful Inspection du StormShield que nous devons doubler ces \u00e9quipements.</li> </ol>"},{"location":"DNS/DNS-autorit%C3%A9/#101-besoins","title":"10.1 Besoins","text":"<p>Les zones internes ne changeant pas, NS1 et NS2 seront donc synchronis\u00e9es, NS1 \u00e9tant master et NS2 slave (1).</p> <p>Les zones externes, elles, changent, notamment au niveau de la r\u00e9solution, o\u00f9 NS1 renvoie vers R1 et NS2 vers R2.</p> <ol> <li>Master est le ma\u00eetre et Slave l'esclave\u202f; le ma\u00eetre envoie la configuration et les esclaves la copient.</li> </ol>"},{"location":"DNS/DNS-autorit%C3%A9/#102-configuration","title":"10.2 Configuration","text":"<p>Dans le fichier <code>/etc/bind/name.conf.local</code> de NS1, il faut ajouter ces lignes : <pre><code>// === VUE INTERNE ===\nview \"internal\" {\n    match-clients { 172.28.0.0/16; 127.0.0.1; };\n    recursion no;\n\n    zone \"chartres.sportludique.fr\" {\n        type master;\n        file \"/etc/bind/zones/db.chartres.sportludique.fr.internal\";\n        allow-transfer {172.28.62.11;};\n        also-notify {172.28.62.11;};\n    };\n};\n\n// === VUE EXTERNE ===---\nview \"external\" {\n    match-clients { any; };\n    recursion no;\n\n    zone \"chartres.sportludique.fr\" {\n        type master;\n        file \"/etc/bind/zones/db.chartres.sportludique.fr.external\";\n    };\n};\n</code></pre> Ensuite, dans le fichier <code>/etc/bind/name.conf.local</code> de NS2, il suffit de rajouter ces lignes : <pre><code>// Vue interne\nview \"internal\" {\n    match-clients { 127.0.0.1; 172.28.0.0/16; };\n    recursion no;\n\n    zone \"chartres.sportludique.fr\" {\n        type slave;\n        masters { 172.28.62.1; };  // IP du ma\u00eetre\n        file \"/var/cache/bind/db.chartres.sportludique.fr.internal\";\n    };\n};\n\n// Vue externe\nview \"external\" {\n    match-clients { any; };\n    recursion no;\n\n    zone \"chartres.sportludique.fr\" {\n        type master;\n        file \"/etc/bind/zones/db.chartres.sportludique.fr.external\";\n    };---\n};\n</code></pre></p> <p>Pour finir, il suffit de modifier le fichier <code>/etc/bind/zones/db.chartres.sportludique.fr.external</code> de NS2 pour qu'il pointe vers R2 et non R1. </p> <pre><code>$TTL 86400\n@       IN SOA  ns1.chartres.sportludique.fr. admin.chartres.sportludique.fr. (\n                2025100704 ; Serial\n                3600        ; Refresh\n                1800        ; Retry\n                1209600     ; Expire\n                86400 )     ; Negative Cache TTL\n\n; ----- Serveurs DNS -----\n@       IN NS   ns1.chartres.sportludique.fr.\n@       IN NS   ns2.chartres.sportludique.fr.\n\n; Exemple (\u00e0 compl\u00e9ter si tu veux) :\nns1    IN A 183.44.28.1\nns2    IN A 221.87.128.2  \nwww    IN A 221.87.128.2\ncimmob IN A 221.87.128.2\n</code></pre> <p>Ne pas oublier de mettre \u00e0 jour le fichier External sur les deux DNS, puisqu'ils ne sont plus synchronis\u00e9s.</p>"},{"location":"DocumentationMkdocs/Plugins/plugin/","title":"Documentation des plugins","text":""},{"location":"DocumentationMkdocs/Plugins/plugin/#1-drawio","title":"\u270f\ufe0f 1. Drawio :","text":"<p>Drawio est un logiciel en ligne d'\u00e9dition de diagrames en tout genre, dans notre cas il sagit d'un schema r\u00e9seau, l'utilisation de ce plugin permet de g\u00e9n\u00e9rer une API html interactive utilisant les fichier en .drawio, cela nous permet un zoom et une navigation simplifier du diagrame, de plus l'utilisation de cette API d\u00e9bloque certaines fonctionnalit\u00e9 comme les fenetres r\u00e9ductibles. </p>"},{"location":"DocumentationMkdocs/Plugins/plugin/#modification-du-workflow","title":"Modification du workflow.","text":"<p>Afin de pouvoir utiliser le plugin, il faut tout dabord l'installer, nous allons donc modifier le fichier main.yml de notre github, le but \u00e9tant d'ajouter la commande qui installeras le plugin \"drawio\"</p> <pre><code>name: ci \non:\n  push:\n    branches:\n      - master \n      - main\npermissions:\n  contents: write\njobs:\n  deploy:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n      - name: Configure Git Credentials\n        run: |\n          git config user.name github-actions[bot]\n          git config user.email 41898282+github-actions[bot]@users.noreply.github.com\n      - uses: actions/setup-python@v5\n        with:\n          python-version: 3.x\n      - run: echo \"cache_id=$(date --utc '+%V')\" &gt;&gt; $GITHUB_ENV \n      - uses: actions/cache@v4\n        with:\n          key: mkdocs-material-${{ env.cache_id }}\n          path: ~/.cache \n          restore-keys: |\n            mkdocs-material-\n      - run: pip install mkdocs-material \n      - run: pip install mkdocs-drawio\n      - run: mkdocs gh-deploy --force\n</code></pre> <p>Une fois le workflow modifier, github installeras le plugin \"drawio\" a chaque mise a jour du code. </p>"},{"location":"DocumentationMkdocs/Plugins/plugin/#ajout-du-plugin-dans-le-mkdocsyml","title":"Ajout du plugin dans le mkdocs.yml","text":"<p>Il faut ensuite ajouter le plugin dans le fichier de configuration mkdocs</p> <pre><code>plugins: \n  - drawio \n</code></pre>"},{"location":"DocumentationMkdocs/Plugins/plugin/#ajout-du-fichier-drawio-dans-une-page","title":"Ajout du fichier drawio dans une page","text":"<p>Pour finir il ne reste plus qu'\u00e0 ins\u00e9rer le fichier avec l'extention \".drawio\" dans notre fichier makdown a la mani\u00e8re d'une image</p> <pre><code>![](fichier.drawio)\n</code></pre>"},{"location":"DocumentationMkdocs/Plugins/plugin/#2-search","title":"2. Search","text":"<p>Search est un plugin qui permet d'ajouter une barre de recherche en haut a droite de votre page, cette barre de recherche permet de rechercher des mots, titres ou pages de votre document Mkdocs. </p>"},{"location":"DocumentationMkdocs/Plugins/plugin/#activation","title":"Activation \u26a1","text":"<p>Ce plugin \u00e9tant natif a Mkdocs, il suffit d'ajouter la ligne dans le fichier mkdocs.yml </p> <pre><code>plugins: \n  - drawio \n  - search\n</code></pre>"},{"location":"DocumentationMkdocs/Syntaxe/Syntaxe/","title":"Syntaxe &amp; tips","text":"<p>Voici les principales commandes de syntaxe sous mkdocs avec le theme mat\u00e9rial, toute ces tips ont \u00e9t\u00e9 trouv\u00e9 sur cette page0 github.</p>"},{"location":"DocumentationMkdocs/Syntaxe/Syntaxe/#1-liste-des-extension-markdown","title":"1. Liste des extension Markdown","text":"<p>Voici la liste de nos extension en markdown a impl\u00e9menter dans votre fichier mkdocs.yml afin de garentir le bon fonctionnement de toutes les commandes de styntaxes. </p> <pre><code>markdown_extensions:\n  - pymdownx.emoji:\n      emoji_index: !!python/name:material.extensions.emoji.twemoji\n      emoji_generator: !!python/name:material.extensions.emoji.to_svg\n  - pymdownx.tabbed\n  - attr_list\n  - md_in_html\n  - pymdownx.superfences\n  - pymdownx.highlight\n  - pymdownx.tilde\n  - pymdownx.tasklist:\n      custom_checkbox: true\n      clickable_checkbox: true\n</code></pre>"},{"location":"DocumentationMkdocs/Syntaxe/Syntaxe/#2-les-commandes-principales","title":"2. Les commandes principales","text":""},{"location":"DocumentationMkdocs/Syntaxe/Syntaxe/#syntaxe","title":"Syntaxe","text":"<p>Gras : <pre><code>**texte**\n</code></pre></p> <p>Italique : <pre><code>*texte*\n</code></pre></p> <p>Barr\u00e9 : <pre><code>~~texte~~\n</code></pre> Souligner :  <pre><code>&lt;ins&gt; \ntexte \n&lt;/ins&gt;\n</code></pre></p>"},{"location":"DocumentationMkdocs/Syntaxe/Syntaxe/#mise-en-forme","title":"Mise en forme","text":"<p>Code inline : <pre><code>`code`\n</code></pre> Citation </p> <p>Ceci est une sitation :  <pre><code>&gt; Texte\n</code></pre></p> <p>Bloc de code : <pre><code>\"```\"\nton code ici\n\"```\"\n</code></pre>  indice : <sub>indice </sub> <pre><code>&lt;sub&gt;\nindice\n&lt;/sub&gt;\n</code></pre> Exposant : <sup> Exposant </sup> <pre><code>&lt;sup&gt;\nexposant \n&lt;/sup&gt;\n</code></pre></p> <p>\"#\" Titre Principale </p> <p>\"##\" Sous titre 1</p> <p>\"###\" Sous titre 2</p> <p>\"####\" Sous titre 3 </p>"},{"location":"DocumentationMkdocs/Syntaxe/Syntaxe/#outils","title":"Outils","text":""},{"location":"DocumentationMkdocs/Syntaxe/Syntaxe/#liens-externe-google","title":"Liens externe google","text":"<pre><code>[texte du lien](http://ceciestunlien)\n</code></pre>"},{"location":"DocumentationMkdocs/Syntaxe/Syntaxe/#images","title":"Images","text":"<p><pre><code>![texte de l'image](lien vers l'image)\n</code></pre> Voici le moyen d'ordonner vos liens :  <pre><code>Context Lien relatif\nDans un fichier .md sur la m\u00eame branche /assets/images/electrocat.png\nDans un fichier .md sur une autre branche   /../main/assets/images/electrocat.png\nDans les probl\u00e8mes, les demandes de tirage et les commentaires du d\u00e9p\u00f4t ../blob/main/assets/images/electrocat.png?raw=true\nDans un fichier .md dans un autre d\u00e9p\u00f4t /../../../../github/docs/blob/main/assets/images/electrocat.png\nDans les probl\u00e8mes, les demandes de tirage et les commentaires d\u2019un autre d\u00e9p\u00f4t ../../../github/docs/blob/main/assets/images/electrocat.png?raw=true\n</code></pre></p>"},{"location":"DocumentationMkdocs/Syntaxe/Syntaxe/#listes","title":"Listes","text":"<pre><code>-Premier \u00e9l\u00e9ment \n-Deuxi\u00e8me element\n-Troisi\u00e8me \u00e9l\u00e9ment\n\n1. James Madison\n2. James Monroe\n3. John Quincy Adams\n</code></pre> <ol> <li>Ceci est une annotation</li> </ol> <p><pre><code>&lt;div class=\"annotate\" markdown&gt;\n\nPhrase avant l'annotation (1) phrase apr\u00e8s l'annotation\n\n&lt;/div&gt;\n1. Contenue de l'annotation\n</code></pre> Il est possible de modifier l'icone de l'annotation en ajoutant l'icone dans le mkdocs.yml  <pre><code>theme :\n  logo : logo.png\n  icon : material/chevron-right-circle\n  name : material\n  language : fr\n  palette:\n    - scheme: default\n      primary: red\n      accent: white\n      toggle:\n        icon: material/weather-night\n        name: Switch to dark mode\n    - scheme: slate\n      primary: red\n      accent: white\n      toggle:\n        icon: material/weather-sunny\n        name: Switch to light mode\n</code></pre></p> <p>Il est possbile de diff\u00e9rencier les annotation et d'en mettre plusieurs \u00e0 la suite, il suffit de changer le num\u00e9ro associ\u00e9.</p> <ol> <li>mettre un \"x\" entre les crochet marque la t\u00e2che comme faite</li> </ol> <pre><code>- [x] #739\n- [ ] https://github.com/octo-org/octo-repo/issues/740\n- [ ] Add delight to the experience when all tasks are complete :tada:\n</code></pre> <ul> <li> TACHE ACOMPLIE</li> <li> TACHE A ACOMPLIRE</li> </ul> <ol> <li>Liste compl\u00e8te des emoji utilisables en markdown ici.</li> </ol>"},{"location":"DocumentationMkdocs/Syntaxe/Syntaxe/#anotation","title":"Anotation","text":"<p>(1)</p>"},{"location":"DocumentationMkdocs/Syntaxe/Syntaxe/#liste-de-taches","title":"Liste de taches","text":"<p>(1)</p>"},{"location":"DocumentationMkdocs/Syntaxe/Syntaxe/#emoji","title":"Emoji","text":"<p>(1) <pre><code>:EMOJICODE:\n</code></pre></p>"},{"location":"DocumentationMkdocs/Syntaxe/Syntaxe/#surligner","title":"Surligner","text":"<p>Il est possible sur surligner des lignes de codes dans un bloc de code, il suffit d'ajouter  <pre><code>python hl_lines=\"0\"\n</code></pre> Juste apr\u00e8s \"```\" la ou 0 repr\u00e9sente le num\u00e9ro de ligne.  <pre><code>Dans mon exemple \nla 4 \u00e8me ligne\nseras surligner\ncelle la\n</code></pre></p>"},{"location":"Hyperviseur/lacp-proxmox/","title":"Documentation : Configuration LACP et Trunk via l\u2019interface Web Proxmox VE","text":""},{"location":"Hyperviseur/lacp-proxmox/#objectif","title":"Objectif :","text":"<p>Mettre en place une configuration de liens agr\u00e9g\u00e9s (LACP) et de trunks VLAN sur Proxmox VE et le switch hyperviseur, afin d\u2019assurer la haute disponibilit\u00e9 et la segmentation r\u00e9seau via VLANs.</p>"},{"location":"Hyperviseur/lacp-proxmox/#1-configuration-sur-proxmox-ve-interface-web","title":"1. Configuration sur Proxmox VE (Interface Web)","text":""},{"location":"Hyperviseur/lacp-proxmox/#11-creation-du-bond-lacp","title":"1.1 Cr\u00e9ation du Bond LACP","text":"<ol> <li>Connectez-vous \u00e0 l\u2019interface web de Proxmox VE.</li> <li>Allez dans Datacenter \u2192 Node \u2192 System \u2192 Network.</li> <li>Cliquez sur Create \u2192 Linux Bond.</li> <li>Param\u00e9trez le bond comme suit :<ul> <li>Name : <code>bond0</code></li> <li>Slaves : s\u00e9lectionnez les interfaces (ex : <code>eno1</code>, <code>ens3f0</code>, <code>ens3f1</code>) </li> <li>Mode : <code>802.3ad (LACP)</code></li> <li>Transmit Hash Policy : <code>layer2+3</code> </li> </ul> </li> <li>Cliquez sur Create pour valider.</li> </ol> <p>\u26a0\ufe0f Ne mettre aucune IP ni Gateway sur le Linux Bond</p>"},{"location":"Hyperviseur/lacp-proxmox/#12-attribution-de-lip-au-bond-via-un-linux-bridge","title":"1.2 Attribution de l\u2019IP au bond via un Linux Bridge","text":"<ol> <li>Toujours dans l\u2019onglet Network, cliquez sur Create \u2192 Linux Bridge.</li> <li> <p>Param\u00e9trez le bridge pour utiliser le bond comme port physique :</p> <ul> <li>Name : <code>vmbr2</code></li> <li>Bridge ports : <code>bond0</code></li> <li>Manage Vlan's : <code>On</code></li> <li>STP : <code>Off</code></li> <li>IP Address : <code>172.28.33.4/24</code></li> <li>Gateway (IPv4) : <code>172.28.33.254</code></li> <li>Vlan ID : <code>221-229</code></li> </ul> </li> <li> <p>Cliquez sur Create pour appliquer le bridge.</p> </li> </ol> <p>Le bridge <code>vmbr2</code> permet \u00e0 vos VM de se connecter au r\u00e9seau via le bond LACP.</p>"},{"location":"Hyperviseur/lacp-proxmox/#13-vlans-sur-le-bridge","title":"1.3 VLANs sur le bridge","text":"<p>Contraites VLANs with Trunk :</p> <ul> <li>VLAN serveur : VLAN 221</li> <li>VLANs suppl\u00e9mentaires : 222 \u00e0 229 si n\u00e9cessaire.</li> </ul> <p>Cette configuration permet de g\u00e9rer les VLANs directement sur le bridge et d\u2019avoir des VM ou containers connect\u00e9s aux VLANs via le bridge.</p>"},{"location":"Hyperviseur/lacp-proxmox/#2-configuration-sur-le-switch-hyperviseur","title":"2. Configuration sur le Switch Hyperviseur","text":""},{"location":"Hyperviseur/lacp-proxmox/#21-creation-du-port-channel-lacp","title":"2.1 Cr\u00e9ation du Port-Channel (LACP)","text":"<ol> <li>S\u00e9lectionnez les ports connect\u00e9s \u00e0 l\u2019hyperviseur.</li> <li>Cr\u00e9ez un Port-Channel et activez LACP.</li> </ol> <p>Configuration Cisco :</p> <pre><code>interface range GigabitEthernet1/0/21-23\n    channel-group 2 mode active\n    switchport mode trunk\n</code></pre> <ul> <li>channel-group 2 mode active : active LACP.</li> <li>switchport mode trunk : configure le trunk.</li> </ul>"},{"location":"Hyperviseur/lacp-proxmox/#22-configuration-des-vlans-sur-le-trunk","title":"2.2 Configuration des VLANs sur le trunk","text":"<p>VLANs autoris\u00e9s sur le trunk : 221 \u00e0 229</p> <p>Configuration Cisco :</p> <pre><code>interface Port-channel2\n    switchport trunk allowed vlan 221-229\n</code></pre>"},{"location":"Hyperviseur/lacp-proxmox/#3-verifications","title":"3. V\u00e9rifications","text":""},{"location":"Hyperviseur/lacp-proxmox/#31-sur-proxmox-ve","title":"3.1 Sur Proxmox VE","text":"<p>a) V\u00e9rifiez que le bond fonctionne :</p> <ul> <li>Datacenter \u2192 Node \u2192 System \u2192 Network \u2192 bond0</li> <li>V\u00e9rifiez les VLANs sur le bridge :</li> <li>Datacenter \u2192 Node \u2192 System \u2192 Network \u2192 vmbr2 \u2192 VLANs</li> </ul> <p>b) Test de connectivit\u00e9 :</p> <ul> <li>Ping depuis l\u2019hyperviseur vers la passerelle : ping 172.28.33.254</li> <li>Ping vers d\u2019autres VLANs si configur\u00e9s</li> </ul>"},{"location":"Hyperviseur/lacp-proxmox/#32-sur-le-switch","title":"3.2 Sur le Switch","text":"<pre><code>show etherchannel summary\nshow vlan brief\nshow interfaces trunk\n</code></pre> <ul> <li>V\u00e9rifier que le port-channel est actif et les VLANs correctement propag\u00e9s.</li> </ul>"},{"location":"Hyperviseur/ldaps-prox/","title":"Mise en place du Protocole LDAPS sur Proxmox.","text":""},{"location":"Hyperviseur/ldaps-prox/#objectif","title":"Objectif :","text":"<p>Configurer une authentification Active Directory s\u00e9curis\u00e9e (LDAPS) sur un cluster Proxmox, \u00e0 l\u2019aide d\u2019un certificat g\u00e9n\u00e9r\u00e9 par le service ADCS (Active Directory Certificate Services), et assurer la communication s\u00e9curis\u00e9e entre le serveur Proxmox et les contr\u00f4leurs de domaine.</p>"},{"location":"Hyperviseur/ldaps-prox/#1-creation-dun-dossier-partage-pour-les-certificats","title":"1. Cr\u00e9ation d\u2019un dossier partag\u00e9 pour les certificats.","text":"<p>Sur le contr\u00f4leur de domaine principal (AD principal), cr\u00e9er un dossier partag\u00e9 qui servira \u00e0 stocker le certificat g\u00e9n\u00e9r\u00e9 par le service ADCS : <pre><code>C:\\Backup\\Certificat\n</code></pre></p>"},{"location":"Hyperviseur/ldaps-prox/#2-generation-et-exportation-du-certificat-via-adcs","title":"2. G\u00e9n\u00e9ration et exportation du certificat via ADCS.","text":"<ul> <li>Installer le r\u00f4le ADCS (Active Directory Certificate Services) sur le contr\u00f4leur de domaine secondaire.</li> <li>G\u00e9n\u00e9rer un certificat pour le serveur LDAP s\u00e9curis\u00e9 (LDAPS).</li> <li>Exporter le certificat au format .crt (ou .cer).</li> <li>Copier ce fichier dans le dossier partag\u00e9 cr\u00e9\u00e9 pr\u00e9c\u00e9demment.</li> </ul> <pre><code>\\\\CHA-DC-01\\Backup\\Certificat\\certificat.crt\n</code></pre> <p>Pour toutes ces \u00e9tapes voir : Tuto ADCS et Certificat</p>"},{"location":"Hyperviseur/ldaps-prox/#3-transfert-du-certificat-vers-le-serveur-proxmox","title":"3. Transfert du certificat vers le serveur Proxmox.","text":"<p>Sur le poste o\u00f9 se trouve le certificat, ex\u00e9cuter la commande suivante pour le transf\u00e9rer sur le serveur Proxmox : <pre><code>scp Documents/certificat.crt root@10.10.120.50:/usr/local/share/ca-certificates\n</code></pre></p> <p>\ud83d\udca1 10.10.120.50 correspond \u00e0 l\u2019adresse IP du serveur Proxmox.</p>"},{"location":"Hyperviseur/ldaps-prox/#4-installation-du-certificat-sur-proxmox","title":"4. Installation du certificat sur Proxmox","text":"<p>Connectez-vous au serveur Proxmox via SSH, puis ex\u00e9cutez : <pre><code>cd /usr/local/share/ca-certificates\nls\nupdate-ca-certificates\n</code></pre></p> <p>\ud83d\udca1 Cette commande mettra \u00e0 jour la base des autorit\u00e9s de certification de Proxmox pour reconna\u00eetre le certificat ADCS comme fiable.</p>"},{"location":"Hyperviseur/ldaps-prox/#5-normalisation-du-nom-du-serveur-active-directory","title":"5. Normalisation du nom du serveur Active Directory.","text":"<p>Proxmox n\u2019accepte pas les caract\u00e8res \u201c_\u201d (underscore) dans les noms de serveurs. <pre><code>Ancien nom : CHA_DC_01\nNouveau nom : CHA-DC-01\n</code></pre></p> <p>Ce changement permet une compatibilit\u00e9 totale avec Proxmox et le protocole LDAPS.</p>"},{"location":"Hyperviseur/ldaps-prox/#6-utilisation-du-fqdn-nom-de-domaine-complet","title":"6. Utilisation du FQDN (Nom de domaine complet).","text":"<p>Le nom complet (FQDN) du serveur Active Directory principal est : <pre><code>CHA-DC-01.cha.chartres.sportludique.fr\n</code></pre></p> <p>C\u2019est ce FQDN qui sera utilis\u00e9 comme identifiant de serveur AD dans la configuration de Proxmox et non l'ip du serveur.</p>"},{"location":"Hyperviseur/ldaps-prox/#7-configuration-du-realm-royaume-dans-proxmox","title":"7. Configuration du Realm (Royaume) dans Proxmox.","text":"<p>Chemin d\u2019acc\u00e8s :</p> <pre><code>Datacenter \u2192 Permissions \u2192 Realms \u2192 Add \u2192 Active Directory\n</code></pre> Champ Valeur Realm ad Default Domain cha.chartres.sportludique.fr Port 636 Mode LDAPS Server1 CHA-DC-01.cha.chartres.sportludique.fr Server2 10.10.120.3 (serveur secondaire AD) V\u00e9rifier le certificat \u2705 Oui Commentaire Authentification AD <p>\ud83e\udde9 Le port 636 correspond au protocole LDAPS (LDAP s\u00e9curis\u00e9 via SSL/TLS).</p>"},{"location":"Hyperviseur/proxmox-raid/","title":"Configuration de Proxmox VE &amp; RAID","text":""},{"location":"Hyperviseur/proxmox-raid/#1-proxmox-ve","title":"1. Proxmox VE","text":""},{"location":"Hyperviseur/proxmox-raid/#11-installation","title":"1.1 Installation","text":"<ul> <li>Mise en place de Proxmox VE sur le serveur physique.</li> <li>D\u00e9finition d\u2019un mot de passe administrateur avec l'utilisateur par d\u00e9faut root pour acc\u00e9der \u00e0 l\u2019interface web et \u00e0 l\u2019OS.</li> </ul>"},{"location":"Hyperviseur/proxmox-raid/#12-configuration-de-lhyperviseur","title":"1.2 Configuration de l\u2019hyperviseur","text":"<ul> <li> <p>Attribution d\u2019un nom d\u2019h\u00f4te :   <code>cha.chartres.sportludiques.fr</code></p> </li> <li> <p>Association des VLAN :</p> </li> <li>VLAN Mana : <code>120</code> \u2192 acc\u00e8s \u00e0 l\u2019interface web d\u2019administration.<ul> <li>Adresse IP du Mana : <code>10.10.120.50</code></li> </ul> </li> <li>VLAN Serveur : <code>221</code> \u2192 configuration car l\u2019hyperviseur est utilis\u00e9 en tant que serveur.<ul> <li>Adresse IP du Serveur : <code>172.28.33.4</code></li> </ul> </li> </ul>"},{"location":"Hyperviseur/proxmox-raid/#2-raid-10","title":"2. RAID 1+0","text":""},{"location":"Hyperviseur/proxmox-raid/#21-contrainte-materielle","title":"2.1 Contrainte mat\u00e9rielle","text":"<p>Le serveur (g\u00e9n\u00e9ration 8) ne prend en charge que les niveaux de RAID suivants : * RAID 0 * RAID 1 * RAID 1+0</p>"},{"location":"Hyperviseur/proxmox-raid/#22-choix-effectue","title":"2.2 Choix effectu\u00e9","text":"<ul> <li>Mise en place d\u2019un RAID 1+0 (au lieu du RAID 5 initialement pr\u00e9vu).</li> <li>Cons\u00e9quence : perte de 50 % de la capacit\u00e9 totale de stockage, mais gain en fiabilit\u00e9 et en performances en lecture/\u00e9criture.</li> </ul>"},{"location":"Hyperviseur/vlan-prox/","title":"Configuration des VLAN et Zones dans la SDN","text":""},{"location":"Hyperviseur/vlan-prox/#1-contexte","title":"1. Contexte","text":"<p>Cette proc\u00e9dure d\u00e9crit la configuration des VLAN et Zones au sein de la SDN (Software Defined Network) utilis\u00e9e dans l\u2019infrastructure. L\u2019objectif est de structurer le r\u00e9seau en diff\u00e9rentes zones logiques et de garantir une gestion coh\u00e9rente des interfaces et des connexions entre les machines virtuelles.</p>"},{"location":"Hyperviseur/vlan-prox/#2-creation-de-la-zone-service","title":"2. Cr\u00e9ation de la Zone \u201cService\u201d","text":"<ol> <li>Acc\u00e9der \u00e0 la console de gestion SDN sur l'interface Web de Proxmox.</li> <li>Cr\u00e9er une nouvelle zone nomm\u00e9e : <code>Service</code> </li> <li>Cette zone sera utilis\u00e9e pour l\u2019ensemble des VLAN list\u00e9s ci-dessous.</li> </ol>"},{"location":"Hyperviseur/vlan-prox/#3-creation-des-vlan-dans-les-vnets","title":"3. Cr\u00e9ation des VLAN dans les Vnets","text":""},{"location":"Hyperviseur/vlan-prox/#31-vlan-concernes","title":"3.1 VLAN concern\u00e9s","text":"Nom du VLAN ID VLAN Zone associ\u00e9e Gestion Actif 222 Service Client 224 Service DMZ 226 Service Serveur 221 Service"},{"location":"Hyperviseur/vlan-prox/#32-etapes-de-creation","title":"3.2 \u00c9tapes de cr\u00e9ation","text":"<ol> <li>Dans la section Vnets, cr\u00e9er un VLAN pour chaque identifiant mentionn\u00e9 ci-dessus.  </li> <li>Affecter \u00e0 chaque VLAN :<ul> <li>Un nom explicite (ex. : <code>VLAN_GestionActif</code>, <code>VLAN_Client</code>, etc.).  </li> <li>La zone \u201cService\u201d.  </li> </ul> </li> <li>Ne pas cocher :<ul> <li>Gestion des VLANs </li> <li>Pare-feu </li> </ul> </li> <li>Ne pas ajouter d\u2019\u00e9tiquette VLAN (VLAN Tag) lors de la configuration.</li> </ol>"},{"location":"Hyperviseur/vlan-prox/#4-association-des-vlan-aux-machines-virtuelles-vm","title":"4. Association des VLAN aux Machines Virtuelles (VM)","text":"<p>Lors de la cr\u00e9ation d\u2019une nouvelle VM :</p> <ol> <li>Dans les param\u00e8tres de la carte r\u00e9seau de la VM, section Pont (Bridge) :<ul> <li>S\u00e9lectionner la Zone \u201cService\u201d.  </li> </ul> </li> <li>Ne pas cocher :<ul> <li>Gestion des VLANs </li> <li>Pare-feu </li> </ul> </li> <li>Ne pas renseigner de Tag VLAN.  </li> </ol>"},{"location":"Hyperviseur/vlan-prox/#5-probleme-de-detection-de-la-carte-reseau","title":"5. Probl\u00e8me de d\u00e9tection de la carte r\u00e9seau","text":"<p>Si, apr\u00e8s la cr\u00e9ation de la VM, la carte r\u00e9seau n\u2019appara\u00eet pas dans l\u2019invite de commande (CMD) de la VM :</p> <ol> <li>Ouvrir les param\u00e8tres de la VM sur Proxmox.  </li> <li>Aller dans Mat\u00e9riel \u2192 Carte R\u00e9seau \u2192 Mod\u00e8le.  </li> <li>Changer le mod\u00e8le de la carte r\u00e9seau en Intel E1000.  </li> <li>Red\u00e9marrer la VM si n\u00e9cessaire.  </li> </ol>"},{"location":"Hyperviseur/vlan-prox/#6-vlan-independant","title":"6. VLAN ind\u00e9pendant","text":"<p>Le VLAN 120 (Management) est ind\u00e9pendant de la zone Service et de la SDN. Il dispose d\u2019une interface r\u00e9seau d\u00e9di\u00e9e : - Interface : <code>vmbr0</code> - Adresse IP : <code>10.10.120.50/24</code> </p>"},{"location":"Hyperviseur/vlan-prox/#cas-dutilisation","title":"Cas d\u2019utilisation","text":"<p>Si une VM doit disposer d\u2019un acc\u00e8s au VLAN Management :</p> <ol> <li>Ajouter une seconde carte r\u00e9seau \u00e0 la VM.  </li> <li>Dans la rubrique Pont (Bridge), s\u00e9lectionner <code>vmbr0</code>.  </li> <li>Ne pas cocher :<ul> <li>Gestion des VLANs </li> <li>Pare-feu </li> </ul> </li> <li>Ne pas mettre d\u2019\u00e9tiquette VLAN.  </li> </ol>"},{"location":"Hyperviseur/vlan-prox/#7-resume-rapide","title":"7. R\u00e9sum\u00e9 rapide","text":"\u00c9l\u00e9ment Param\u00e8tre / Valeur Zone principale Service VLANs utilis\u00e9s 221, 222, 224, 226 VLAN Management 120 (ind\u00e9pendant) Interface Management vmbr0 \u2013 IP : 10.10.120.50/24 Mod\u00e8le de carte r\u00e9seau Intel E1000 Options \u00e0 ne pas activer Gestion des VLANs / Pare-feu / Tag VLAN"},{"location":"Pare-feux/UFW/","title":"UFW","text":""},{"location":"Pare-feux/UFW/#objectif","title":"Objectif :","text":"<p>Cette documentation donne les commandes basiques et l'installation d'UFW (Uncomplicated Fire Wall)</p> <p>UFW (Uncomplicated Firewall) est un pare-feu simple pour Linux, bas\u00e9 sur iptables. Il sert \u00e0 contr\u00f4ler le trafic r\u00e9seau entrant et sortant gr\u00e2ce \u00e0 des r\u00e8gles faciles \u00e0 g\u00e9rer.</p> <p>Points cl\u00e9s :</p> <ul> <li> <p>Facile \u00e0 utiliser : commandes simples (allow, deny, status).</p> </li> <li> <p>Filtrage par port, protocole et IP.</p> </li> <li> <p>Gestion des interfaces multiples.</p> </li> <li> <p>R\u00e8gles persistantes et journalisation.</p> </li> <li> <p>Objectif : s\u00e9curiser un serveur ou un r\u00e9seau en autorisant uniquement le trafic n\u00e9cessaire.</p> </li> </ul>"},{"location":"Pare-feux/UFW/#1-instalation","title":"1. Instalation","text":"<p>Mettez \u00e0 jour votre syst\u00e8me : <pre><code>sudo apt update \nsudo apt upgrade\n</code></pre></p> <p>Installez UFW : <pre><code>sudo apt install ufw -y\n</code></pre></p>"},{"location":"Pare-feux/UFW/#2-configuration-basique","title":"2. Configuration basique","text":"<p>Voici les commandes basiques d'UFW :</p>"},{"location":"Pare-feux/UFW/#21-activation-desactivation","title":"2.1 Activation/ D\u00e9sactivation","text":"<p>UFW comme tout les pare-feux peut \u00eatre activer ou d\u00e9sactiver, lors de son instalation il est d\u00e9sactiver par default <pre><code>sudo ufw enable     #active le pare-feux\nsudo ufw disable    #d\u00e9sactive le pare-feux\nsudo ufw status     #Donne l'\u00e9tat du pare-feux (actif/inactif)\n</code></pre></p>"},{"location":"Pare-feux/UFW/#22-regles-par-defaut","title":"2.2 R\u00e8gles par d\u00e9faut","text":"<p>UFW compte 4 r\u00e8gles de filtrage par default qui servent a tout bloquer/autoriser sur le trafic entrant ou sortant : <pre><code>sudo ufw default deny incoming   # Bloque tout le trafic entrant par d\u00e9faut\nsudo ufw default allow incoming  # Autorise tout le trafic entrant par d\u00e9faut\nsudo ufw default allow outgoing  # Autorise tout le trafic sortant par d\u00e9faut\nsudo ufw default deny outgoing   # Bloque tout le trafic sortant (si serveur tr\u00e8s s\u00e9curis\u00e9)\n</code></pre></p>"},{"location":"Pare-feux/UFW/#23-regles-filtrantes","title":"2.3 R\u00e8gles filtrantes","text":"<p>Chaque r\u00e8gle prend en compte plusieurs param\u00e8tres, autoriser, refuser, le port, l'IP... </p> <p>Voici une commande type d'UFW </p> <p><pre><code>sudo ufw &lt;allow/deny&gt; &lt;in/out&gt; on &lt;interface&gt; from &lt;all/ip/r\u00e9seau&gt; to &lt;all/ip/r\u00e9seau&gt; port &lt;n\u00b0de port&gt; proto &lt;protocole ip&gt;\n</code></pre> Chaque r\u00e8gle peut \u00eatre adapt\u00e9 en fonction des besoins. </p>"},{"location":"Pare-feux/ldaps-pfw/","title":"Configuration LDAPS Stormshield SN210","text":""},{"location":"Pare-feux/ldaps-pfw/#1-configuration-des-annuaires-distants","title":"1. Configuration des Annuaires Distants","text":"<p>Chemin interface web : Configuration &gt; Utilisateurs &gt; Configuration Annuaires &gt; Ajouter un annuaire</p> <p>Annuaire Distant :</p> Param\u00e8tre Valeur / Description Nom de domaine cha.chartres.sportludique.fr Serveur Cr\u00e9er l'objet ActiveDirectory avec l'adresse IP 10.10.120.2 Port LDAPS (636) Domaine Racine (Base DN) DC=cha,DC=chartres,DC=sportludique,DC=fr Identifiant CN=admin.ldap,OU=UserServices Mot de Passe Mot de passe de l'utilisateur de liaison : admin.ldap <p>Connexion S\u00e9curis\u00e9e (SSL) :</p> Param\u00e8tre Valeur / Description Activer l'acc\u00e8s en SSL Cocher la case V\u00e9rifier le certificat selon une Autorit\u00e9 de certification Ne pas cocher la case <p>Configuration Avanc\u00e9e :</p> Param\u00e8tre Valeur / Description Serveur de secours Cr\u00e9er l'objet ActiveDirectorySecondaire avec l'adresse IP 10.10.120.3 Port serveur de secours LDAPS (636) Utiliser le compte du firewall pour v\u00e9rifier l\u2019authentification Ne pas cocher la case Ne pas compl\u00e9ter l'identifiant (ID) par le Domain Name (Base DN) Ne pas cocher la case"},{"location":"Pare-feux/ldaps-pfw/#2-ajout-des-utilisateurs-administrateurs-techniciens-dsi","title":"2. Ajout des utilisateurs Administrateurs Techniciens DSI","text":"<p>Chemin interface web : Configuration &gt; Syst\u00e8me &gt; Administrateurs &gt; Ajouter un administrateur</p> <ul> <li>Rechercher les utilisateurs de la DSI concern\u00e9s : wassim.dsi, simon.dsi, david.dsi</li> <li>Ajouter les utilisateurs un par un</li> <li>Accorder tous les droits administratifs \u00e0 ces utilisateurs</li> <li>Sauvegarder en bas de page</li> </ul>"},{"location":"Pare-feux/ldaps-pfw/#3-problemes-rencontres-lors-de-la-confgiruation","title":"3. Probl\u00e8mes rencontr\u00e9s lors de la confgiruation","text":"<ul> <li>Stormshield garde en m\u00e9moire le premier ajout d'annuaire, m\u00eame si celui-ci n'\u00e9tait plus visible dans l'interface web.</li> <li>Dans les fichiers de configuration LDAP, l'annuaire externe peut rester pr\u00e9sent, ce qui emp\u00eache de r\u00e9initialiser la configuration correctement.</li> </ul>"},{"location":"Pare-feux/ldaps-pfw/#31-reinitialiser-les-compteurs-ldap-cli","title":"3.1 R\u00e9initialiser les compteurs LDAP (CLI)","text":"<p>Chemin interface web : Configuration &gt; Syst\u00e8me &gt; Console CLI</p> <ul> <li> <p>V\u00e9rifier les compteurs LDAP :     <pre><code>config ldap count\n</code></pre>     Si <code>External=1</code> ou <code>Internal=1</code>, proc\u00e9der aux \u00e9tapes suivantes.</p> </li> <li> <p>Supprimer l'annuaire probl\u00e9matique :     <pre><code>config ldap remove domainname=cha.chartres.sportludique.fr force=on\n</code></pre> Remplacer le nom de domaine par celui de votre annuaire concern\u00e9.</p> </li> <li> <p>Mettre \u00e0 jour la configuration :     <pre><code>config ldap update\n</code></pre></p> </li> <li> <p>V\u00e9rifier \u00e0 nouveau les compteurs LDAP :     <pre><code>config ldap count\n</code></pre></p> <ul> <li>V\u00e9rifier que <code>External=0</code> et <code>Internal=0</code> avant de refaire l\u2019ajout correct des annuaires.</li> </ul> </li> </ul>"},{"location":"Pare-feux/opnsense/","title":"Installation et Configuration d\u2019OPNsense sur Nutanix","text":""},{"location":"Pare-feux/opnsense/#1-installation","title":"1. Installation","text":""},{"location":"Pare-feux/opnsense/#11-deploiement-de-la-vm","title":"1.1 D\u00e9ploiement de la VM","text":"<ul> <li>Cr\u00e9ation d\u2019une VM OPNsense sur Nutanix.</li> <li> <p>Ressources attribu\u00e9es :</p> </li> <li> <p>Stockage : 50 Go</p> </li> <li>RAM : 8 Go</li> <li>vCPU : 2</li> </ul>"},{"location":"Pare-feux/opnsense/#12-reseau-et-vlan","title":"1.2 R\u00e9seau et VLAN","text":"<ul> <li>Association de 3 VLAN :</li> <li>VLAN Management : <code>120</code></li> <li>VLAN DMZ : <code>226</code></li> <li> <p>VLAN LAN2DMZ : <code>223</code></p> </li> <li> <p>Attribution d\u2019une adresse IP de management (10.10.120.70) dans le VLAN 120 pour acc\u00e9der \u00e0 l\u2019interface web et administrer le pare-feu.</p> </li> </ul>"},{"location":"Pare-feux/opnsense/#2-configuration","title":"2. Configuration","text":""},{"location":"Pare-feux/opnsense/#21-acces-web-comptes","title":"2.1 Acc\u00e8s Web &amp; comptes","text":"<ul> <li>Utilisateur administrateur : <code>root</code> (nom d\u2019utilisateur v\u00e9rifi\u00e9).  </li> <li>Mot de passe : mot de passe initial remplac\u00e9 \u2014 un mot de passe administrateur personnalis\u00e9 a \u00e9t\u00e9 d\u00e9fini pour l\u2019acc\u00e8s \u00e0 l\u2019interface web.  </li> <li>Recommandation : stocker les identifiants de mani\u00e8re s\u00e9curis\u00e9e (gestionnaire de mots de passe).</li> </ul>"},{"location":"Pare-feux/opnsense/#22-interfaces","title":"2.2 Interfaces","text":"<ul> <li>Activation des interfaces DMZ et LAN2DMZ.</li> <li> <p>Attribution d\u2019une adresse IP et d\u2019une passerelle \u00e0 chacune : </p> <ul> <li>DMZ : <ul> <li>Adresse IP : 172.28.62.253 </li> <li>Gateway : 172.28.62.254</li> </ul> </li> <li>LAN2DMZ : <ul> <li>Adresse IP : 172.28.63.140</li> <li>Gateway : 172.28.63.254</li> </ul> </li> </ul> </li> </ul>"},{"location":"Pare-feux/opnsense/#23-regles-de-pare-feu","title":"2.3 R\u00e8gles de Pare-feu","text":"<ul> <li> <p>Mise en place temporaire d\u2019une r\u00e8gle permissive :</p> </li> <li> <p>Allow All / Any (autorisation de toutes les trames, y compris ICMP/ping).</p> </li> <li>Objectif : tester le bon fonctionnement initial du pare-feu.</li> <li>Des r\u00e8gles de filtrage plus restrictives seront appliqu\u00e9es ult\u00e9rieurement.</li> </ul>"},{"location":"Pare-feux/opnsense/#24-routage","title":"2.4 Routage","text":"<ul> <li> <p>Configuration des routes aller/retour.</p> <ul> <li>Adresse IP : 172.28.35.0/24 | Gateway : 172.28.63.130 (SWCORE) </li> <li>Adresse IP : 172.28.32.0/24 | Gateway : 172.28.63.130 (SWCORE) </li> <li>Adresse IP : 172.28.33.0/24 | Gateway : 172.28.63.130 (SWCORE)  </li> </ul> </li> </ul>"},{"location":"Pare-feux/proxy/","title":"Mise en place et configuration d'un Proxy Filtrant via Stormshield (SN210)","text":""},{"location":"Pare-feux/proxy/#contexte-quest-ce-quun-proxy-filtrant","title":"Contexte : qu'est ce qu'un proxy filtrant ?","text":"<p>Un proxy filtrant est un composant de s\u00e9curit\u00e9 r\u00e9seau qui se place entre les utilisateurs et Internet. Son r\u00f4le est de contr\u00f4ler, analyser et \u00e9ventuellement bloquer ou modifier le trafic web avant qu\u2019il n\u2019atteigne les sites visit\u00e9s.</p> <p>Il sert notamment \u00e0 :</p> <ul> <li>Bloquer les sites dangereux ou non conformes aux r\u00e8gles de l\u2019entreprise,</li> <li>Analyser le trafic HTTPS (inspection SSL),</li> <li>Prot\u00e9ger les utilisateurs contre les malwares,</li> <li>Appliquer des politiques d\u2019acc\u00e8s (cat\u00e9gories, filtrage, blocage\u2026).</li> </ul> <p>En r\u00e9sum\u00e9, c\u2019est un interm\u00e9diaire s\u00e9curis\u00e9 qui v\u00e9rifie tout ce qui sort et tout ce qui rentre.</p>"},{"location":"Pare-feux/proxy/#stormshield-et-son-proxy-filtrant","title":"Stormshield et son proxy filtrant","text":"<p>Les firewalls Stormshield (SNS) int\u00e8grent un proxy filtrant natif, capable de g\u00e9rer :</p> <ul> <li>Le filtrage URL,</li> <li>L\u2019analyse HTTPS (d\u00e9chiffrement SSL),</li> <li>Les contr\u00f4les de certificats,</li> <li>L\u2019application de r\u00e8gles de s\u00e9curit\u00e9 par utilisateur, cat\u00e9gorie ou site.</li> </ul> <p>Ce proxy fait partie des modules de protection applicative du firewall, et il permet d\u2019aller beaucoup plus loin qu\u2019un simple filtrage IP classique.</p>"},{"location":"Pare-feux/proxy/#1-configurer-la-politique-de-filtrage-ssl","title":"1. Configurer la politique de filtrage SSL","text":""},{"location":"Pare-feux/proxy/#11-se-rendre-dans-la-configuration","title":"1.1 Se rendre dans la configuration :","text":"<p>Configuration \u2192 Politique de s\u00e9curit\u00e9 \u2192 Filtrage SSL.</p>"},{"location":"Pare-feux/proxy/#12-mettre-en-place-le-filtrage-ssl","title":"1.2 Mettre en place le filtrage SSL","text":"<p>Cr\u00e9ez une nouvelle politique SSL en cliquant sur <code>Ajouter</code></p>"},{"location":"Pare-feux/proxy/#13-configurez-la-regle","title":"1.3 Configurez la r\u00e8gle :","text":"<pre><code>-   D\u00e9chiffrer \u2192 inspection SSL,\n-   Passer sans d\u00e9chiffrer,\n-   Bloquer sans d\u00e9chiffrer.\n</code></pre>"},{"location":"Pare-feux/proxy/#14-odres-des-regles","title":"1.4 Odres des r\u00e9gl\u00e8s","text":""},{"location":"Pare-feux/proxy/#assurez-vous-du-bon-ordre-des-regles-selon-les-autorisations-et-interdictions-mises-en-place","title":"Assurez-vous du bon ordre des r\u00e8gles selon les autorisations et interdictions mises en place.","text":""},{"location":"Pare-feux/proxy/#15-categories-dobjets","title":"1.5 Cat\u00e9gories d'objets :","text":"<p><code>URL-CN</code> est un objet (cat\u00e9gorie d\u2019URL) regroupant plusieurs sites. Par exemple :</p> <ul> <li>URL-CN : Online \u2192 sites de paris en ligne, r\u00e9seaux sociaux, plateformes interactives\u2026</li> <li>URL-CN : News \u2192 journaux en ligne, sites de radiodiffusion, magazines, m\u00e9dias d\u2019actualit\u00e9\u2026</li> </ul>"},{"location":"Pare-feux/proxy/#2-configurer-la-politique-de-filtrage-et-nat","title":"2. Configurer la politique de Filtrage et NAT","text":""},{"location":"Pare-feux/proxy/#21-se-rendre-dans-la-configuration","title":"2.1 Se rendre dans la configuration :","text":"<p>Configuration \u2192 Politique de s\u00e9curit\u00e9 \u2192 Filtrage &amp; NAT.</p>"},{"location":"Pare-feux/proxy/#22-mettre-en-place-le-filtrage","title":"2.2 Mettre en place le filtrage","text":"<p>Cr\u00e9ez une nouvelle politique de filtrage en cliquant sur <code>Nouvelle r\u00e8gle</code></p>"},{"location":"Pare-feux/proxy/#23-configurez-la-regle","title":"2.3 Configurez la r\u00e8gle :","text":"<pre><code>-   \u00c9tat : Activ\u00e9\n-   Action : D\u00e9chiffrer\n-   Sources : Network_Internals\n-   Destination : In\n-   Port Destiation : SSL_srv (Objet incluant les protocoles : https, imaps, ftps...)\n-   Protocole : Laisser cette case vide\n-   Inspection de S\u00e9curit\u00e9 : Filtrage SSL : *Nom de la r\u00e8gle de filtrage SSL cr\u00e9\u00e9r pr\u00e9c\u00e9demment*\n</code></pre>"},{"location":"Pare-feux/proxy/#24-odres-des-regles","title":"2.4 Odres des r\u00e9gl\u00e8s","text":"<p>Assurez-vous que cette r\u00e8gle se trouve en t\u00eate de liste.</p>"},{"location":"Pare-feux/proxy/#4-tester-le-dechiffrement-ssl","title":"4. Tester le d\u00e9chiffrement SSL","text":"<p>Depuis un poste client, acc\u00e9dez \u00e0 un site HTTPS.</p>"},{"location":"Pare-feux/proxy/#41-verifiez-que","title":"4.1  V\u00e9rifiez que :","text":"<p>a) Le site se charge. b) Le site charg\u00e9 est bloqu\u00e9 avec une page violette qui est le Proxy avec le message suivant : </p> <p><code>Your administrator reject the connection to this SSL Server</code></p> <p>Cela signifique que le Proxy est bel et bien fonctionnel !</p>"},{"location":"Pare-feux/proxy/#5-acceder-aux-objects","title":"5. Acc\u00e9der aux objects :","text":"<pre><code>Objets \u2192 Certificat / PKI \u2192 Ajouter \u2192 Importer un fichier :\n    - Importer le CA (de tout les sites sportludique.fr)\n    - Selectionner le format **PEM**\n    - Ne pas mettre de mot de passe\n    - \u00c9lements \u00e0 importer : CA\nPuis valider l'importation !\n</code></pre>"},{"location":"Pare-feux/proxy/#51-acceder-a-la-configuration","title":"5.1 Acc\u00e9der \u00e0 la configuration :","text":"<pre><code>- Configuration \u2192 Protection applicative \u2192 Protocoles.\n- S\u00e9lectionnez *SSL*.\n- Cliquez sur *Acc\u00e9der \u00e0 la configuration globale*.\n- Autorit\u00e9s de certification personnalis\u00e9es \u2192 Ajouter \u2192 S\u00e9l\u00e9ctionner le CA\n</code></pre>"},{"location":"Pare-feux/r%C3%A9glePF/","title":"R\u00e9gle des Pare-Feu.","text":""},{"location":"Pare-feux/r%C3%A9glePF/#stormshield-n1","title":"Stormshield n\u00b01","text":"Cat\u00e9gorie Interface N\u00b0 Source Port Src Destination Port Dest Protocole Action DNS (entr\u00e9e depuis l'ext\u00e9rieur) WAN 1 * * 172.28.62.1 53 TCP/UDP Permit Reverse Proxy HTTP WAN 2 * * 172.28.62.5 80 TCP Permit Reverse Proxy HTTPS WAN 3 * * 172.28.62.5 443 TCP Permit Mail SMTP (entr\u00e9e depuis l'ext\u00e9rieur) WAN 4 * * 172.28.62.2 25 TCP Permit Mail IMAP (entr\u00e9e depuis l'ext\u00e9rieur) WAN 5 * * 172.28.62.2 143 TCP Permit Mail SMTP (sortie vers l'ext\u00e9rieur) DMZ \u2192 WAN 6 172.28.62.2 * * 25 TCP Permit DNS sortant (DMZ \u2192 Internet) DMZ \u2192 WAN 7 172.28.62.0/24 * * 53 TCP/UDP Permit Acc\u00e8s Internet LAN LAN 8 172.28.32.0/19 * * * ANY Permit Bloc tout WAN WAN 9 * * * * ANY Deny"},{"location":"Pare-feux/r%C3%A9glePF/#stormshield-n2","title":"Stormshield n\u00b02","text":"Cat\u00e9gorie Interface N\u00b0 Source Port Src Destination Port Dest Protocole Action DNS secondaire (entr\u00e9e depuis ext\u00e9rieur) WAN 1 * * 172.28.62.11 53 TCP/UDP Permit Reverse Proxy HTTP secondaire WAN 2 * * 172.28.62.10 80 TCP Permit Reverse Proxy HTTPS secondaire WAN 3 * * 172.28.62.10 443 TCP Permit DNS sortant (DMZ \u2192 Internet) DMZ \u2192 WAN 4 172.28.62.0/24 * * 53 ANY Permit Acc\u00e8s Internet LAN LAN 5 172.28.32.0/19 * * * ANY Permit Bloc tout WAN WAN 6 * * * * ANY Deny"},{"location":"Pare-feux/r%C3%A9glePF/#opnsense","title":"OPNsense","text":"Cat\u00e9gorie Interface N\u00b0 Source Port Src Destination Port Dest Protocole Action Commentaire R\u00e9seau DMZ \u2192 DNS Resolveur 1 WAN 1 172.28.62.0/24 * 172.28.33.4 53 TCP/UDP Permit \u2014 R\u00e9seau DMZ \u2192 DNS Resolveur 2 WAN 2 172.28.62.0/24 * 172.28.33.5 53 TCP/UDP Permit \u2014 Web  \u2192 BDD WAN 3 172.28.62.3 * 192.168.28.10 3306 TCP Permit \u2014 REVERSE PROXY 1 \u2192 DOCKER (GLPI) WAN 4 172.28.62.5 * 172.28.33.8 2000 TCP Permit \u26a0\ufe0f Sp\u00e9cifier la passerelle REVERSE PROXY 2 \u2192 DOCKER (GLPI) WAN 5 172.28.62.10 * 172.28.33.8 2000 TCP Permit \u26a0\ufe0f Sp\u00e9cifier la passerelle SMTP DMZpub \u2192 Clients WAN 6 172.28.62.2 * 172.28.35.0/24 25 TCP Permit \u2014 IMAP DMZpub \u2192 Clients WAN 7 172.28.62.2 * 172.28.35.0/24 143 TCP Permit \u2014 Bloc tout WAN WAN 8 * * * * ANY Deny R\u00e8gle de blocage Internet LAN LAN 1 172.28.32.0/19 * * * ANY Permit \u2014 Bloc tout LAN 2 * * * * ANY Deny \u2014 Bloc tout DMZpriv 1 * * * * ANY Deny R\u00e8gle par d\u00e9faut"},{"location":"Pare-feux/stormshield/","title":"Configuration du Pare Feu Stormshield","text":""},{"location":"Pare-feux/stormshield/#1-reinitialisation-du-pare-feu","title":"1. R\u00e9initialisation du Pare-Feu","text":"<p>Sur les bo\u00eetiers physiques: un appui sur le bouton reset (attendre que les led devant clignotent) pour les bo\u00eetiers physiques permet de restaurer la configuration d'usine et red\u00e9marrer en bridge sur toutes les interfaces.</p>"},{"location":"Pare-feux/stormshield/#11-schema-physique-du-pare-feu-apres-reset","title":"1.1 Schema physique du pare feu apr\u00e8s reset","text":""},{"location":"Pare-feux/stormshield/#2connexion-apres-reset","title":"2.Connexion apr\u00e8s reset","text":"<p>Pour configurer le pare-feu, il faut se brancher sur une interface IN et mettre son poste en DHCP.</p> <p>En configuration usine sur un bo\u00eetier physique, toutes les interfaces sont incluses dans un bridge dont l'adresse est 10.0.0.254/8.Un serveur DHCP est actif sur toutes les interfaces du bridge et il distribue des adresses IP comprises entre 10.0.0.10 et 10.0.0.100. L'acc\u00e8s \u00e0 l'interface web de configuration du pare-feu se fait avec l'url : https://10.0.0.254/.</p> <p>Par d\u00e9faut, seul le compte syst\u00e8me admin (mot de passe par d\u00e9faut admin), dispose de tous les privil\u00e8ges sur le bo\u00eetier.</p> <p></p>"},{"location":"Pare-feux/stormshield/#3configuration-generale","title":"3.Configuration g\u00e9n\u00e9rale","text":""},{"location":"Pare-feux/stormshield/#31-modification-du-mot-de-passe-de-ladministrateur","title":"3.1 Modification du mot de passe de l'administrateur","text":"<p>La modification du mot de passe admin se fait dans le menu Configuration/Syst\u00e8me/Administrateurs puis onglet Compte ADMIN.</p> <p></p>"},{"location":"Pare-feux/stormshield/#32-nom","title":"3.2 Nom","text":"<p>S\u00e9lectionner dans le menu \u00e0 gauche Configuration / Syst\u00e8me puis Configuration G\u00e9n\u00e9rale.</p> <p>Commencer par donner un nom \u00e0 votre Firewall si besoin et changer la langue du clavier du CLI.</p> <p></p> <p>Puis cliquer sur Appliquer.</p>"},{"location":"Pare-feux/stormshield/#33-fuseau-horaire","title":"3.3 Fuseau horaire","text":"<p>La zone Param\u00e8tres de date et d'heure permet de modifier le fuseau horaire. Dans la zone Fuseau horaire, s\u00e9lectionnez Europe/Paris.</p> <p></p> <p>Il est possible d'utiliser un serveur NTP interne ou externe afin de maintenir l'\u00e9quipement \u00e0 l'heure</p>"},{"location":"Pare-feux/stormshield/#4configuration-du-reseau","title":"4.Configuration du r\u00e9seau","text":"<p>Par defaut, toutes les interfaces sont dans le bridge.</p> <p></p> <p>Choisir une interface (par exemple IN) et configurer une IP fixe afin de la faire sortir du Bridge. </p> <p></p> <p>Faire pareil avec les autres interfaces.</p> <p></p>"},{"location":"Pare-feux/stormshield/#5routage","title":"5.Routage","text":""},{"location":"Pare-feux/stormshield/#51-route-par-defaut","title":"5.1 Route par d\u00e9faut","text":"<p>Cliquer Configuration / R\u00e9seau / Routage / Routes statiques IPv4.</p> <p></p> <p>Sur les syt\u00e8mes stormshield les configurations fonctionnent majoritairement avec les Objets, il vous faudras donc en cr\u00e9e un pour l'IP de votre passerelle. Cliquer sur l'ic\u00f4ne  pour ajouter un objet r\u00e9seau, choisir Machine et renseigner le nom et l'IP de votre passerelle. </p> <p></p>"},{"location":"Pare-feux/stormshield/#52-route-de-retour","title":"5.2 Route de retour","text":""},{"location":"Pare-feux/stormshield/#6filtrage-temporaire","title":"6.Filtrage temporaire.","text":"<p>Allez dans Configuration / Politique de s\u00e9curit\u00e9 / Filtrage et NAT.</p> <p>Choisir la r\u00e9gle \"Pass all\" et modifier la colonne \"Inspection de s\u00e9curit\u00e9\" en mettant \"Ne pas inspecter\".</p> <p></p> <p></p> <p>\u26a0\ufe0f\u26a0\ufe0f\u26a0\ufe0f ATTENTION \u26a0\ufe0f\u26a0\ufe0f\u26a0\ufe0f</p> <p>Cette configuration des r\u00e8gles est temporaire et NON SECURISEE il faut bien vieller a mettre en place des r\u00e8gles par la suite !!!</p> <p>\u26a0\ufe0f\u26a0\ufe0f\u26a0\ufe0f ATTENTION \u26a0\ufe0f\u26a0\ufe0f\u26a0\ufe0f</p>"},{"location":"Pare-feux/stormshield/#7-statefull-inspection","title":"\u26a0\ufe0f 7. Statefull Inspection","text":"<p>Le Stormshield dispose par d\u00e9faut d\u2019une inspection des paquets qui n\u2019est pas d\u00e9sactivable. Cette inspection peut rejeter silencieusement des paquets, sans m\u00eame les enregistrer dans les logs. Dans notre cas, elle pose probl\u00e8me avec le handshake TCP, \u00e0 noter que cela ne concerne pas les connexion UDP car il n'y a aucune v\u00e9rification de session (seamless).</p> <p>Ce principe est la base du protocole TCP : il s'agit d'une liaison compos\u00e9e des \u00e9tats SYN, SYN-ACK et ACK. Le client envoie un SYN, le serveur r\u00e9pond avec un SYN-ACK, puis le client renvoie un ACK au serveur. Cela permet au client de savoir que le serveur a bien re\u00e7u son paquet gr\u00e2ce au SYN-ACK, et au serveur de confirmer que le client a re\u00e7u le paquet gr\u00e2ce \u00e0 l\u2019ACK. Ce m\u00e9canisme assure la v\u00e9rification des diff\u00e9rentes \u00e9tapes de transition d\u2019un paquet TCP.</p> <p>Autrement dit, le Stormshield refuse les paquets TCP dont il n\u2019a aucune trace d\u2019initialisation en m\u00e9moire ou qu\u2019il n\u2019a pas initialis\u00e9s lui-m\u00eame. Par cons\u00e9quent, si le Stormshield re\u00e7oit un SYN-ACK sans avoir re\u00e7u de SYN sur la m\u00eame session, il ne consid\u00e8re pas la session TCP comme d\u00e9marr\u00e9e et ne r\u00e9pond pas \u00e0 celle-ci.</p> <p>Sur ce premier sch\u00e9ma, le flux est refus\u00e9 par le Stormshield :  Sur ce sch\u00e9ma, nous pouvons voir qu\u2019au lieu de renvoyer un SYN-ACK, le Stormshield ne renvoie rien, mettant ainsi fin \u00e0 la connexion TCP sans aucune explication.</p> <p>Voici donc le moyen d\u2019assurer une communication correcte entre les \u00e9quipements, sans rompre le handshake : </p> <p>Si l\u2019on ne passe pas par le Stormshield, le paquet est correctement transmis gr\u00e2ce au bon d\u00e9roulement du handshake.</p> <p>Et pour ne pas passer par le Stormshield voici la solution.</p>"},{"location":"Routeur/PAT/","title":"Configuration PAT sur R1 et R2","text":""},{"location":"Routeur/PAT/#1-configurer-le-pat","title":"1. Configurer le PAT","text":"<p>Dans notre cas, nous avons besoin du PAT pour la redirection vers le reverse-proxy et le DNS autoritatif pour les requ\u00eates provenant de l\u2019ext\u00e9rieur.</p> <p>(1)</p> <ol> <li>Les requ\u00eates venant du r\u00e9seau interne sont directement r\u00e9solues par le DNS autoritatif.</li> </ol>"},{"location":"Routeur/PAT/#11-configuration-r1","title":"1.1 Configuration R1","text":"<pre><code>ip nat inside source static tcp 172.28.62.1 53 183.44.28.1 53\nip nat inside source static udp 172.28.62.1 53 183.44.28.1 53\nip nat inside source static tcp 172.28.62.5 80 183.44.28.1 80\nip nat inside source static tcp 172.28.62.5 443 183.44.28.1 443\n</code></pre>"},{"location":"Routeur/PAT/#12-configuration-r2","title":"1.2 Configuration R2","text":"<pre><code>ip nat inside source static tcp 172.28.62.11 53 221.87.128.2 53\nip nat inside source static udp 172.28.62.11 53 221.87.128.2 53\nip nat inside source static tcp 172.28.62.5 80 221.87.128.2 80\nip nat inside source static tcp 172.28.62.5 443 221.87.128.2 443\n</code></pre>"},{"location":"Routeur/PAT/#2-verification","title":"2. V\u00e9rification","text":"<p>V\u00e9rifier que le NAT est correctement configur\u00e9 : <pre><code>show ip nat translations\n</code></pre> Il devrais en ressortir ceci pour R2 par exemple:  <pre><code>Pro Inside global\ntcp 221.87.128.2:80     172.28.62.11:53\ntcp 221.87.128.2:443    172.28.62.5:80\ntcp 221.87.128.2:53     172.28.62.5:80\nudp 221.87.128.2:53     172.28.62.11:53\n</code></pre></p>"},{"location":"Routeur/R1/","title":"Configuration du routeur (R1)","text":""},{"location":"Routeur/R1/#1-configuration-initial","title":"1. Configuration initial","text":""},{"location":"Routeur/R1/#11-reinitialiser-le-routeur-a-sa-configuration-dorigine-sans-le-mot-de-passe-admin","title":"1.1 R\u00e9initialiser le routeur \u00e0 sa configuration d'origine sans le mot de passe admin.","text":"<pre><code>#D\u00e9marrer le routeur et presser Ctrl+Break pour entrer en mode rommon.\n\nconfreg 0x2142\nreset\n\n#Le routeur red\u00e9marre sans configuration.\n\nenable\nconfigure terminal\nconfig-register 0x2102 #Permet de remettre le switch sur le bon registre\nend\nwrite\n</code></pre>"},{"location":"Routeur/R1/#12-changer-le-nom-du-routeur","title":"1.2 Changer le Nom du routeur","text":"<pre><code>enable \nconfig\nhostname CHA-R1\n</code></pre>"},{"location":"Routeur/R1/#2-configuration-des-interfaces","title":"2. Configuration des interfaces","text":""},{"location":"Routeur/R1/#21-configurer-la-premiere-interface-gigabit00","title":"2.1 Configurer la premi\u00e8re interface Gigabit0/0","text":"<pre><code>interface GigabitEthernet0/0\n ip address 183.44.28.1 255.255.255.252\n ip nat outside\n no shutdown\n</code></pre>"},{"location":"Routeur/R1/#22-configurer-la-deuxieme-interface-gigabit01","title":"2.2 Configurer la deuxi\u00e8me interface Gigabit0/1","text":"<pre><code>interface GigabitEthernet0/1\n no shutdown\n</code></pre> <p>Info(1)</p> <ol> <li>\u00c0 noter que le port du switch c\u0153ur de r\u00e9seau reli\u00e9 au routeur doit \u00eatre configur\u00e9 en mode trunk.</li> </ol>"},{"location":"Routeur/R1/#3-ajout-des-vlans","title":"3. Ajout des vlans","text":""},{"location":"Routeur/R1/#31-ajout-du-vlan-de-management","title":"3.1 Ajout du Vlan de management","text":"<pre><code>interface GigabitEthernet0/1.120\n encapsulation dot1Q 120\n ip address 10.10.120.20 255.255.255.0\n ip access-group 100 out\n</code></pre>"},{"location":"Routeur/R1/#32-ajout-du-vlan-dinterconnection","title":"3.2 Ajout du Vlan d'interconnection","text":"<pre><code>interface GigabitEthernet0/1.223\n encapsulation dot1Q 223\n ip address 172.28.63.20 255.255.255.0\n ip nat inside\n</code></pre>"},{"location":"Routeur/R1/#4-activation-du-ssh","title":"4. Activation du SSH","text":""},{"location":"Routeur/R1/#41-generation-des-clef-rsa","title":"4.1 G\u00e9n\u00e9ration des clef RSA","text":"<pre><code>crypto key generate rsa\n2048\n</code></pre>"},{"location":"Routeur/R1/#42-creation-dun-compte-local","title":"4.2 Cr\u00e9ation d'un compte local","text":"<pre><code>username admin privilege 15 secret MonMotDePasse\n</code></pre>"},{"location":"Routeur/R1/#43-activation-du-ssh-sur-les-lignes-vty","title":"4.3 Activation du SSH sur les lignes VTY","text":"<pre><code>line vty 0 4\nlogin local \ntransport input ssh \n</code></pre>"},{"location":"Routeur/R1/#44-selection-de-la-bonne-version-ssh","title":"4.4 Selection de la bonne version SSH","text":"<pre><code>ip ssh version 2\n</code></pre>"},{"location":"Routeur/R1/#5-configuration-du-routage","title":"5. Configuration du routage","text":"<ol> <li>Activation du NAT  <pre><code>ip nat inside source list 1 interface GigabitEthernet0/0 overload\nip nat inside source list 20 interface GigabitEthernet0/0 overload\n</code></pre></li> <li>Cr\u00e9ation des routes de retour <pre><code>ip route 172.28.32.0 255.255.255.0 172.28.63.1 # Gestion des actifs\nip route 172.28.33.0 255.255.255.0 172.28.63.1 # Serveurs\nip route 172.28.35.0 255.255.255.0 172.28.63.1 # Clients\nip route 172.28.63.128 255.255.255.128 172.28.63.1 # LAN2DMZ\nip route 172.28.62.0 255.255.255.0 172.28.63.1 # DMZ Publique\n</code></pre></li> <li>Cr\u00e9ation de la route par d\u00e9faut <pre><code>ip route 0.0.0.0 0.0.0.0 183.44.28.2\n</code></pre></li> </ol>"},{"location":"Routeur/R1/#6-mise-en-place-des-acl","title":"6. Mise en place des ACL","text":"<ol> <li>Creation de l'acces list contenant les r\u00e9seaux qui auront acc\u00e8s a internet <pre><code>access-list 1 permit 172.28.32.0 0.0.31.255\naccess-list 20 permit 192.168.28.0 0.0.0.255\n</code></pre></li> </ol> <p>Info (1)</p> <ol> <li> <p>\u00c0 noter que le masque invers\u00e9 renvoie vers le r\u00e9seau 172.28.32.0/19, ce qui correspond \u00e0 la plage de VLAN qui nous est attribu\u00e9e.</p> </li> <li> <p>Cr\u00e9ation de l\u2019access list qui va bloquer l\u2019acc\u00e8s \u00e0 Internet au r\u00e9seau de management. <pre><code>access-list 100 deny ip 10.10.120.0 0.0.0.255 any\naccess-list 100 permit ip any any\n</code></pre></p> </li> </ol>"},{"location":"Routeur/R1/#7-redirection-dns","title":"7. Redirection DNS","text":"<p>La redirection DNS permettra aux machines n\u2019ayant pas de serveur DNS dans leur configuration d\u2019utiliser le DNS interne de Chartres.</p> <pre><code>ip dns server \nip name-server 172.28.33.2\nip domain-lookup\n</code></pre>"},{"location":"Routeur/R1/#8-protocole-hsrp","title":"8. Protocole HSRP","text":"<p>Le HSRP est un protocole qui permet de cr\u00e9er une adresse VIP (Virtual IP) offrant la haute disponibilit\u00e9 entre deux routeurs.</p> <p>Dans notre cas, nous allons mettre en place le HSRP entre nos deux routeurs, R1 et R2, chaque routeur \u00e9tant connect\u00e9 \u00e0 un FAI diff\u00e9rent.</p> <p>Info (1)</p> <ol> <li>Voir la page Routeur pour la configuration du HSRP.</li> </ol>"},{"location":"Routeur/R1/#9-pat","title":"9. PAT","text":"<p>Le PAT, ou Port Address Translation, permet de traduire des adresses en fonction du port contact\u00e9 par la requ\u00eate.</p> <p>Le d\u00e9tail de notre PAT se trouve sur la page associ\u00e9.</p>"},{"location":"Routeur/R2/","title":"Configuration du routeur (R2)","text":"<p>Dans cette page, seuls les configurations qui diff\u00e8rent avec R1 seront r\u00e9pertori\u00e9es, pour la configuration primaire du routeur il faut se r\u00e9f\u00e9rer \u00e0 cette page</p>"},{"location":"Routeur/R2/#1-configuration-des-interfaces","title":"1. Configuration des interfaces","text":""},{"location":"Routeur/R2/#11-configurer-la-premiere-interface-gigabit00","title":"1.1 Configurer la premi\u00e8re interface Gigabit0/0","text":"<pre><code>interface GigabitEthernet0/0\n ip address 221.97.136.2 255.255.255.252\n ip nat outside\n no shutdown\n</code></pre>"},{"location":"Routeur/R2/#12-configurer-la-deuxieme-interface-gigabit01","title":"1.2 Configurer la deuxi\u00e8me interface Gigabit0/1","text":"<pre><code>interface GigabitEthernet0/1\n no shutdown\n</code></pre> <p>Info(1)</p> <ol> <li>A noter que le port du switch coeur de r\u00e9seau reli\u00e9 au routeur doit \u00eatre configur\u00e9 en mode trunk.</li> </ol>"},{"location":"Routeur/R2/#2-ajout-des-vlans","title":"2. Ajout des vlans","text":""},{"location":"Routeur/R2/#21-ajout-du-vlan-de-management","title":"2.1 Ajout du Vlan de management","text":"<pre><code>interface GigabitEthernet0/1.120\n encapsulation dot1Q 120\n ip address 10.10.120.30 255.255.255.0\n ip access-group 100 out\n</code></pre>"},{"location":"Routeur/R2/#22-ajout-du-vlan-dinterconnection","title":"2.2 Ajout du Vlan d'interconnection","text":"<pre><code>interface GigabitEthernet0/1.223\n encapsulation dot1Q 223\n ip address 172.28.63.30 255.255.255.0\n ip nat inside\n</code></pre>"},{"location":"Routeur/R2/#3-configuration-du-routage","title":"3. Configuration du routage","text":""},{"location":"Routeur/R2/#31-activation-du-nat","title":"3.1 Activation du NAT","text":"<pre><code>ip nat inside source list 1 interface GigabitEthernet0/0 overload\nip nat inside source list 20 interface GigabitEthernet0/0 overload\n</code></pre>"},{"location":"Routeur/R2/#32-creation-des-routes-de-retour","title":"3.2 Cr\u00e9ation des routes de retour","text":"<pre><code>ip route 172.28.32.0 255.255.255.0 172.28.63.2 # Gestion des actifs\nip route 172.28.33.0 255.255.255.0 172.28.63.2 # Serveurs\nip route 172.28.35.0 255.255.255.0 172.28.63.2 # Clients\nip route 172.28.63.128 255.255.255.128 172.28.63.2 # LAN2DMZ\nip route 172.28.62.0 255.255.255.0 172.28.63.2 # DMZ Publique\n</code></pre>"},{"location":"Routeur/R2/#33-creation-de-la-route-par-defaut","title":"3.3 Cr\u00e9ation de la route par d\u00e9faut","text":"<pre><code>ip route 0.0.0.0 0.0.0.0 221.97.136.1\n</code></pre>"},{"location":"Routeur/R2/#4-mise-en-place-des-acl","title":"4. Mise en place des ACL","text":""},{"location":"Routeur/R2/#41-creation-de-lacces-list-contenant-les-reseaux-qui-auront-acces-a-internet","title":"4.1 Creation de l'acces list contenant les r\u00e9seaux qui auront acc\u00e8s \u00e0 internet","text":"<pre><code>access-list 1 permit 172.28.32.0 0.0.31.255\naccess-list 20 permit 192.168.28.0 0.0.0.255\n</code></pre> <p>Info (1)</p> <ol> <li>A noter que le masque invers\u00e9 renvoie vers le r\u00e9seau 172.28.32.0/19 ce qui correspond \u00e0 la plage de VLAN qui nous as \u00e9t\u00e9 atribu\u00e9e. </li> </ol>"},{"location":"Routeur/R2/#42-creation-de-laccess-list-qui-vas-bloquer-lacces-a-internet-au-reseau-de-management","title":"4.2 Cr\u00e9ation de l'access list qui vas bloquer l'acc\u00e8s a internet au r\u00e9seau de management","text":"<pre><code>access-list 100 deny ip 10.10.120.0 0.0.0.255 any\naccess-list 100 permit ip any any\n</code></pre>"},{"location":"Routeur/R2/#5-redirection-dns","title":"5. Redirection DNS","text":"<p>La redirection DNS permettra aux machine n'ayant pas de serveur DNS dans leur configuration \u00e0 pouvoir utiliser le DNS interne de Chartres</p> <pre><code>ip dns server \nip name-server 172.28.33.2\nip domain-lookup\n</code></pre>"},{"location":"Routeur/R2/#6-pat","title":"6. PAT","text":"<p>Le PAT ou Port Adress Traslation permet de traduire des adresses en fonction du port contacter par la requete.</p> <p>Le d\u00e9tail de notre PAT se trouve sur la page associ\u00e9.</p>"},{"location":"Routeur/hsrp/","title":"FailOver avec le Protocole HSRP","text":""},{"location":"Routeur/hsrp/#objectif","title":"Objectif :","text":"<p>Voici une pr\u00e9sentation rapide du protocole HSRP avec des exemples de configuration utilisant des adresses IP de la plage 172.28.63.0/24, avec une adresse VIP (Virtual IP) de 172.28.63.254 :</p> <p>Supposons que vous ayez deux routeurs Cisco, R1 et R2, et que vous souhaitiez configurer HSRP entre eux pour la haute disponibilit\u00e9.</p>"},{"location":"Routeur/hsrp/#1-configuration-de-r1","title":"1. Configuration de R1","text":"<pre><code>interface GigabitEthernet0/0\n ip address 172.28.63.2 255.255.255.0\n standby 1 ip 172.28.63.10\n standby 1 priority 110\n standby 1 preempt\n</code></pre>"},{"location":"Routeur/hsrp/#11-dans-cette-configuration","title":"1.1 Dans cette configuration","text":"<p>L'interface GigabitEthernet0/0 de R1 est configur\u00e9e avec l'adresse IP 172.28.63.2.</p> <p><code>\"standby 1 ip 172.28.63.10\"</code> d\u00e9finit l'adresse VIP (Virtual IP) HSRP \u00e0 172.28.x.254. <code>\"standby 1 priority 110\"</code> d\u00e9finit la priorit\u00e9 de ce routeur \u00e0 110 (par d\u00e9faut est 100). <code>\"standby 1 preempt\"</code> permet \u00e0 R1 de reprendre automatiquement le r\u00f4le de routeur actif s'il redevient disponible apr\u00e8s une panne.</p>"},{"location":"Routeur/hsrp/#2-configuration-de-r2","title":"2. Configuration de R2","text":"<pre><code>interface GigabitEthernet0/0\n ip address 172.28.63.3 255.255.255.0\n standby 1 ip 172.28.63.10\n standby 1 priority 100\n standby 1 preempt\n</code></pre>"},{"location":"Routeur/hsrp/#22-dans-cette-configuration","title":"2.2 Dans cette configuration","text":"<p>L'interface GigabitEthernet0/0 de R2 est configur\u00e9e avec l'adresse IP 172.28.63.3.</p> <p><code>\"standby 1 ip 172.28.63.10\"</code> d\u00e9finit \u00e9galement l'adresse VIP HSRP \u00e0 172.28.63.10, qui est la m\u00eame que celle configur\u00e9e sur R1. <code>\"standby 1 priority 100\"</code> d\u00e9finit la priorit\u00e9 de ce routeur \u00e0 100. <code>\"standby 1 preempt\"</code> permet \u00e0 R2 de prendre le relais en tant que routeur actif si R1 devient indisponible.</p> <p>Ainsi, avec cette configuration, R1 sera le routeur actif tant qu'il est disponible. En cas de panne de R1 ou de sa connexion, R2 prendra automatiquement le relais en tant que routeur actif, assurant ainsi une haute disponibilit\u00e9 pour la VIP 172.28.63.10.</p>"},{"location":"SWCore/lacp_hp_a5500/","title":"Mise en place de LACP sur HP A5500","text":""},{"location":"SWCore/lacp_hp_a5500/#1-introduction","title":"1. Introduction","text":"<p>LACP (Link Aggregation Control Protocol) est d\u00e9fini dans la norme IEEE 802.3ad. Il permet de regrouper plusieurs interfaces physiques en une seule interface logique (Eth-Trunk) afin de : - augmenter la bande passante disponible, - assurer une redondance en cas de panne de lien, - r\u00e9partir le trafic r\u00e9seau entre plusieurs ports.  </p> <p>Dans une stack de switchs HP A5500, l\u2019utilisation de LACP est recommand\u00e9e pour les liaisons : - vers un autre switch.  - vers un serveur (Nutanix &amp; Proxmox dans notre cas).  </p>"},{"location":"SWCore/lacp_hp_a5500/#2-etapes-de-configuration","title":"2. \u00c9tapes de configuration","text":""},{"location":"SWCore/lacp_hp_a5500/#21-creation-du-port-logique","title":"2.1 Cr\u00e9ation du port logique","text":"<p>Depuis le mode configuration syst\u00e8me : <pre><code>[SW-A5500] system-view\n[SW-A5500] int bridge-aggregation 1\n[SW-A5500-Bridge-aggregation1] link-aggregation mode dynamic\n[SW-A5500-Bridge-aggregation1] quit\n</code></pre></p>"},{"location":"SWCore/lacp_hp_a5500/#22-ajout-des-interfaces-physiques-dans-le-port-link-aggregation","title":"2.2 Ajout des interfaces physiques dans le port link-aggregation","text":"<p>Exemple avec GigabitEthernet1/0/32 et GigabitEthernet2/0/32 : <pre><code>[SW-A5500] int gig 1/0/32\n[SW-A5500-GigabitEthernet1/0/32] port link-aggregation group 1\n\n[SW-A5500-GigabitEthernet2/0/32] int gig 2/0/32\n[SW-A5500-GigabitEthernet2/0/32] port link-aggregation group 1\n\n[SW-A5500-GigabitEthernet2/0/32] quit\n</code></pre></p> <ul> <li>Les interfaces physiques sont associ\u00e9es au groupe <code>Bridge-aggregation1</code>.  </li> <li>Elles deviennent des membres du port agr\u00e9g\u00e9.  </li> </ul>"},{"location":"SWCore/lacp_hp_a5500/#23-configuration-du-type-de-lien-trunkaccess","title":"2.3 Configuration du type de lien (trunk/access)","text":"<p>Si le lien doit transporter plusieurs VLANs (trunk) : <pre><code>[SW-A5500] int bridge-aggregation 1\n[SW-A5500-Bridge-aggregation1] port link-type trunk\n\n[SW-A5500-Bridge-aggregation1] port trunk permit vlan *num vlan* to *num vlan* \n\n[SW-A5500-Bridge-aggregation1] quit\n</code></pre> \u26a0\ufe0f \u27a1 Le PERMIT VLAN ALL ne fonctionne PAS sur le Swtich HP A5000 JD374A Comware version 5.20 (Raison Inconnu). \u26a0\ufe0f</p> <p>Si le lien est pour un seul VLAN (access) : <pre><code>[SW-A5500] int bridge-aggregation 1\n[SW-A5500-Bridge-aggregation1] port link-type access\n[SW-A5500-Bridge-aggregation1] port access vlan 10\n</code></pre></p> <pre><code>[SW-A5500] save\n</code></pre>"},{"location":"SWCore/lacp_hp_a5500/#24-verification-de-letat-lacp","title":"2.4 V\u00e9rification de l\u2019\u00e9tat LACP","text":"<p>Commande de diagnostic : <pre><code>[HP] display link-aggregation verbose\n</code></pre></p> <p>Exemple de sortie attendue : <pre><code>Aggregation Group 1:\n  Aggregation Mode: Dynamic\n  Selected Ports: GigabitEthernet1/0/32, GigabitEthernet2/0/32\n  Operational Key: 1\n</code></pre></p>"},{"location":"SWCore/lacp_hp_a5500/#3-points-importants","title":"3. Points importants","text":"<ul> <li>Tous les ports d\u2019un m\u00eame Bridge-Aggregaton doivent \u00eatre configur\u00e9s de mani\u00e8re identique (m\u00eame VLAN, m\u00eame mode trunk/access).  </li> <li>Sur l\u2019\u00e9quipement distant (autre switch, serveur), la configuration doit correspondre (m\u00eame agr\u00e9gation et VLANs).  </li> <li>LACP est dynamique : seuls les liens valides et actifs seront utilis\u00e9s dans l\u2019agr\u00e9gat.  </li> <li>En cas de panne d\u2019un lien, le trafic continue sur les liens restants.  </li> </ul>"},{"location":"SWCore/lacp_hp_a5500/#4-conclusion","title":"4. Conclusion","text":"<p>Avec LACP, nous disposons d\u2019un lien logique robuste et performant entre notre stack HP A5500 et un serveur ou autre switch. Cette configuration est standard et r\u00e9utilisable dans diff\u00e9rents contextes (uplink, serveur, cluster).  </p>"},{"location":"SWCore/reseau/","title":"Configuration des Switchs HP A5500 (Coeur de R\u00e9seau)","text":""},{"location":"SWCore/reseau/#objectif","title":"Objectif :","text":"<ul> <li>Connexion au switch via le port console depuis Linux Mint  </li> <li>R\u00e9initialisation de la configuration (factory reset)  </li> <li>Configuration d\u2019un stack IRF (Intelligent Resilient Framework)</li> <li>Mise en place d\u2019un VLAN de management (VLAN 120)  </li> <li>Activation de l\u2019acc\u00e8s SSH pour l\u2019administration  </li> </ul>"},{"location":"SWCore/reseau/#connexion-au-switch-via-port-console-linux-mint","title":"Connexion au switch via port console (Linux Mint)","text":""},{"location":"SWCore/reseau/#materiel-requis","title":"Mat\u00e9riel requis","text":"<ul> <li>C\u00e2ble console (RJ45-DB9 ou adaptateur USB-RJ45 selon le mod\u00e8le)</li> <li>PC sous Linux Mint avec droits administrateur</li> </ul>"},{"location":"SWCore/reseau/#comment-faire","title":"Comment faire ?","text":"<ol> <li>Brancher le c\u00e2ble console entre le PC et le switch.  </li> </ol> <p>\u26a0\ufe0f Linux Mint ne supporte pas les Switchs HP d\u00fb \u00e0 un probl\u00e8me d'OS, donc il faut utiliser le Laptot Windows XP afin de configurer les \u00e9quipements HP sans probl\u00e8mes.</p> <p>Utiliser Putty sur le laptop et la connexion fonctionne directement.</p>"},{"location":"SWCore/reseau/#1-reinitialisation-de-la-configuration-factory-reset","title":"1. R\u00e9initialisation de la configuration (Factory Reset)","text":""},{"location":"SWCore/reseau/#11-une-fois-demarre-supprimer-la-configuration-existante","title":"1.1 Une fois d\u00e9marr\u00e9, supprimer la configuration existante :","text":"<pre><code>&lt;HP&gt; reset saved-configuration\n</code></pre> <p>Si cette commande ne supprime pas correctement la conf, il faut les supprim\u00e9s manuellement un par un :  <pre><code>&lt;HP&gt; delete \"nom du fichier de conf \u00e0 supprimer\" \n</code></pre></p>"},{"location":"SWCore/reseau/#12-enregistrer","title":"1.2 Enregistrer :","text":"<pre><code>&lt;HP&gt; save force \n</code></pre>"},{"location":"SWCore/reseau/#13-redemarrer","title":"1.3 Red\u00e9marrer :","text":"<pre><code>&lt;HP&gt; reboot\n</code></pre> <p>\ud83d\udc49 Le switch red\u00e9marre avec la configuration d\u2019usine.</p>"},{"location":"SWCore/reseau/#2-configuration-dun-stack-irf-intelligent-resilient-framework","title":"2. Configuration d\u2019un stack IRF (Intelligent Resilient Framework)","text":"<p>*V\u00e9rifier que les deux switchs ont la m\u00eame version logicielle.</p>"},{"location":"SWCore/reseau/#21-configurer-lid-irf-sur-chaque-switch","title":"2.1 Configurer l\u2019ID IRF sur chaque switch :","text":"<pre><code>&lt;HP&gt; system-view\n[HP] irf member 1 renumber 1   \u2190 premier switch\n[HP] irf member 1 renumber 2   \u2190 deuxi\u00e8me switch\n</code></pre>"},{"location":"SWCore/reseau/#22-sauvegarder-et-redemarrer","title":"2.2 Sauvegarder et red\u00e9marrer :","text":"<pre><code>[HP] save\n</code></pre>"},{"location":"SWCore/reseau/#23-configurer-les-ports-irf","title":"2.3 Configurer les ports IRF :","text":"<p>Rack4sw1 (Switch Master) IRF port configuration <pre><code>[Rack4sw1]interface Ten-GigabitEthernet 1/1/1\n[Rack4sw1-Ten-GigabitEthernet1/1/1]shutdown\n[Rack4sw1-Ten-GigabitEthernet1/1/1]quit\n[Rack4sw1]irf-port 1/1\n[Rack4sw1-irf-port1/1]port group interface Ten-GigabitEthernet 1/1/1\n[Rack4sw1-irf-port1/1]quit\n[Rack4sw1]interface Ten-GigabitEthernet 1/1/1\n[Rack4sw1-Ten-GigabitEthernet1/1/1]undo shutdown  \n[Rack4sw1]irf-port-configuration active\n[Rack4sw1]save force \n</code></pre></p> <p>Rack4sw2 (Switch Slave) port configuration <pre><code>[Rack6sw2]interface Ten-GigabitEthernet 2/1/1\n[Rack6sw2-Ten-GigabitEthernet2/1/1]shutdown\n[Rack6sw2-Ten-GigabitEthernet2/1/1]quit\n</code></pre></p> <pre><code>[Rack6sw2]irf-port 2/2\n[Rack6sw2-irf-port2/2]port group interface Ten-GigabitEthernet 2/1/1\n[Rack6sw2-irf-port2/2]quit\n</code></pre> <pre><code>[Rack6sw2]interface Ten-GigabitEthernet 2/1/1\n[Rack6sw2-Ten-GigabitEthernet2/1/1]undo shutdown\n[Rack6sw2-Ten-GigabitEthernet2/1/1]quit\n</code></pre> <p>Note: Save the configuation before activating the port.</p> <pre><code>[Rack6sw2]save force \n</code></pre>"},{"location":"SWCore/reseau/#24-activer-la-configuration-irf-et-redemarrer","title":"2.4 Activer la configuration IRF et red\u00e9marrer :","text":"<pre><code>[HP] irf-port-configuration active\n[HP] save\n[HP] reboot\n</code></pre> <p>IRF verification <pre><code>&lt;Rack4sw1&gt;display irf&lt;br&gt;\n</code></pre></p> <pre><code>Switch  Role   Priority  CPU-Mac         Description&lt;br&gt;\n*+1   Master  1         b8af-xxxx-xxxx  -----&lt;br&gt;\n2   Slave   1         b8af-xxxx-xxxx  -----\n</code></pre>"},{"location":"SWCore/reseau/#3-creation-dun-vlan-de-management-vlan-120","title":"3. Cr\u00e9ation d\u2019un VLAN de management (VLAN 120)","text":""},{"location":"SWCore/reseau/#31-creer-le-vlan-120","title":"3.1 Cr\u00e9er le VLAN 120 :","text":"<pre><code>[HP] vlan 120\n[HP-vlan120] quit\n</code></pre>"},{"location":"SWCore/reseau/#32-creer-linterface-vlan-et-attribuer-une-adresse-ip-libre","title":"3.2 Cr\u00e9er l\u2019interface VLAN et attribuer une adresse IP libre :","text":"<pre><code>[HP] interface Vlan-interface 120\n[HP-Vlan-interface120] ip address \"ip\" \"masque sous r\u00e9seau\"\n[HP-Vlan-interface120] quit\n</code></pre>"},{"location":"SWCore/reseau/#33-associer-un-port-physique-au-vlan-120","title":"3.3 Associer un port physique au VLAN 120 :","text":"<pre><code>[HP] interface GigabitEthernet1/0/1\n[HP-GigabitEthernet1/0/1] port link-type access\n[HP-GigabitEthernet1/0/1] port access vlan 120\n</code></pre> <p>\ud83d\udc49 Ce VLAN servira exclusivement pour l\u2019administration.</p>"},{"location":"SWCore/reseau/#4-activer-et-securiser-lacces-ssh","title":"4. Activer et s\u00e9curiser l\u2019acc\u00e8s SSH","text":""},{"location":"SWCore/reseau/#41-generer-les-cles-rsa-pour-ssh","title":"4.1 G\u00e9n\u00e9rer les cl\u00e9s RSA pour SSH :","text":"<pre><code>[HP] public-key local create rsa\n</code></pre>"},{"location":"SWCore/reseau/#42-activer-le-service-ssh-stelnet","title":"4.2 Activer le service SSH (stelnet) :","text":"<pre><code>[HPSwitch] ssh server enable\n</code></pre>"},{"location":"SWCore/reseau/#43-creer-un-utilisateur-administrateur","title":"4.3 Cr\u00e9er un utilisateur administrateur :","text":"<pre><code>[HP] local-user admin\n[HP-luser-admin] password simple MonMotDePasseFort\n[HP-luser-admin] service-type ssh\n[HP-luser-admin] authorization-attribute level 3\n</code></pre>"},{"location":"SWCore/reseau/#44-configurer-les-sessions-vty-pour-nautoriser-que-ssh","title":"4.4 Configurer les sessions VTY pour n\u2019autoriser que SSH :","text":"<pre><code>[HP] user-interface vty 0 4\n[HP-ui-vty0-4] authentication-mode scheme\n[HP-ui-vty0-4] protocol inbound ssh\n[HP-ui-vty0-4] quit\n</code></pre> <p>\ud83d\udc49 Ainsi, Telnet est d\u00e9sactiv\u00e9 et seul SSH est autoris\u00e9.</p>"},{"location":"SWCore/reseau/#5-verifications-et-tests","title":"5. V\u00e9rifications et tests","text":""},{"location":"SWCore/reseau/#51-verifier-letat-du-stack-irf","title":"5.1 V\u00e9rifier l\u2019\u00e9tat du stack IRF :","text":"<pre><code>&lt;HP&gt; display irf\n</code></pre>"},{"location":"SWCore/reseau/#52-verifier-ladresse-ip-du-vlan-de-management","title":"5.2 V\u00e9rifier l\u2019adresse IP du VLAN de management :","text":"<pre><code>&lt;HP&gt; display ip interface brief\n</code></pre>"},{"location":"SWCore/reseau/#53-depuis-un-poste-client-tester-lacces-ssh","title":"5.3 Depuis un poste client, tester l\u2019acc\u00e8s SSH :","text":"<pre><code>ssh admin@ip.vlan.management\n</code></pre> <p>\ud83d\udc49 Si tout est correct, la connexion doit s\u2019\u00e9tablir en SSH avec l\u2019utilisateur admin.</p>"},{"location":"SWCore/reseau/#54-test","title":"5.4 Test","text":"<p>Une fois SSH fonctionnel, il faut test un PING des machines physiques au Coeur de r\u00e9seau, des diff\u00e9rentes VM Nutanix Coeur de r\u00e9seau.</p> <p>\u26a0\ufe0f Si le ping depuis la machine physique vers la VM Windows ne fonctionne pas : activer une r\u00e8gle dans les param\u00e8tres du Pare-Feu de Windows afin d'autoriser les pings entrants car il les bloque par d\u00e9faut.</p>"},{"location":"SWCore/reseau/#6-route-par-defaut","title":"6. Route par d\u00e9faut","text":""},{"location":"SWCore/reseau/#61-tapez-la-commande-pour-definir-la-route-par-defaut-qui-va-vers-le-routeur","title":"6.1 Tapez la commande pour d\u00e9finir la route par d\u00e9faut qui va vers le routeur :","text":"<pre><code>[HP] ip route-static 0.0.0.0 0.0.0.0 172.28.63.10\n</code></pre>"},{"location":"SWCore/reseau/#62-verifier-que-votre-route-fonctionne","title":"6.2 V\u00e9rifier que votre route fonctionne :","text":"<pre><code>[HP] ping 172.28.63.10\n</code></pre>"},{"location":"SWCore/reseau/#7-relay-dhcp","title":"7. Relay DHCP","text":"<p>\u2705 Commandes pour DHCP Relay sur A5500 / Comware 5 (v5.20)</p>"},{"location":"SWCore/reseau/#71-activer-le-service-dhcp-globalement-sur-le-switch","title":"7.1 Activer le service DHCP globalement sur le switch :","text":"<pre><code>system-view\ndhcp enable\n</code></pre>"},{"location":"SWCore/reseau/#72-creer-un-server-group-pour-les-serveurs-dhcp-que-tu-veux-utiliser","title":"7.2 Cr\u00e9er un \u201cserver group\u201d pour les serveurs DHCP que tu veux utiliser :","text":"<pre><code>dhcp relay server-group &lt;num_groupe&gt; ip &lt;adresse_IP_serveur_DHCP&gt;\n</code></pre>"},{"location":"SWCore/reseau/#73-pour-chaque-interface-vlan-ou-interface-l3-ou-se-trouvent-les-clients-dhcp-configurer","title":"7.3 Pour chaque interface VLAN (ou interface L3) o\u00f9 se trouvent les clients DHCP, configurer :","text":"<ul> <li>Donner une adresse IP \u00e0 l\u2019interface, si ce n\u2019est pas d\u00e9j\u00e0 fait : <pre><code>interface Vlan-interface &lt;num_vlan&gt;\nip address &lt;adresse_ip_interface&gt; &lt;masque&gt;\n</code></pre></li> <li>Activer le mode relais DHCP sur cette interface : <pre><code>dhcp select relay\n</code></pre></li> <li>Associer cette interface au server\u2010group que tu as d\u00e9fini : <pre><code>dhcp relay server-select &lt;num_groupe&gt;\n</code></pre></li> </ul>"},{"location":"SWCore/reseau/#74-verifier-la-configuration","title":"7.4 V\u00e9rifier la configuration :","text":"<pre><code>display dhcp relay server-group\ndisplay dhcp relay\n</code></pre>"},{"location":"Serveurs/Web/","title":"Serveur WEB","text":""},{"location":"Serveurs/Web/#1-objectifs","title":"1. Objectifs","text":"<p>H\u00e9berger un site web fais partie des services \"basiques\" d'une entreprise, dans notre cas nous allons impl\u00e9menter un premier site web sur un serveur Apache2 heberger sur une machine Debian 13.</p>"},{"location":"Serveurs/Web/#2-installation-dapache2","title":"2. Installation d'Apache2","text":"<p>Mettez a jour votre syst\u00e8me : <pre><code>sudo apt update \nsudo apt full-upgrade\n</code></pre> Installez les packages Apache2  <pre><code>sudo apt install apache2\n</code></pre></p>"},{"location":"Serveurs/Web/#3-configuration-dapache2","title":"3. Configuration d'Apache2","text":""},{"location":"Serveurs/Web/#31-besoins","title":"3.1 Besoins","text":"<p>Dans notre cas ce serveur vas a terme heberger plusieurs sites internets, nous aurons donc besoin des VirtualsHosts. (1)</p> <ol> <li>Toute la documentation sur les VirtualsHosts est contenue sur it-connect</li> </ol>"},{"location":"Serveurs/Web/#32-creation-de-la-page","title":"3.2 Cr\u00e9ation de la page","text":"<p>Nous allons tout dabord cr\u00e9e un nouveau r\u00e9pertoire et lui donner les bonnes permissions dans le dossier <code>/var/www/</code> afin que le VHost puisse avoir un Symlink qui pointe vers un site. <pre><code>sudo mkdir /var/www/chartres\nsudo chown -R www-data:www-data /var/www/ville\nsudo chmod -R 755 /var/www/ville\n</code></pre></p> <p>Ensuite il nous faut cr\u00e9e le fichier index.html qui seras la page de base de notre site. <pre><code>sudo nano /var/www/ville/index.html\n</code></pre></p> <p>Dans ce fichier nous allons cr\u00e9e une page des plus basiques juste pour pouvoir tester notre VHost par la suite.  <pre><code>&lt;html&gt;\n&lt;head&gt;\n    &lt;title&gt;Bienvenue sur Chartres.sportludique&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;h1&gt;Bienvenue sur chartres.sportludique&lt;/h1&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre></p>"},{"location":"Serveurs/Web/#33-creation-du-fichier-vhost","title":"3.3 Cr\u00e9ation du fichier VHost","text":"<p>Nous allons cr\u00e9e le fichier de configuration VHost dans le dossier <code>/etc/apache2/sites-available</code> : <pre><code>sudo nano /etc/apache2/sites-available/www.chartres.sportludique.fr.conf\n</code></pre></p> <p>Dans ce fichier de configuration nous avons copier et adapter la configuration du fichier 000-default.conf</p> <pre><code>&lt;VirtualHost 172.28.62.2:80&gt;\n    # The ServerName directive sets the request scheme, hostname and port that\n    # the server uses to identify itself. This is used when creating\n    # redirection URLs. In the context of virtual hosts, the ServerName\n    # specifies what hostname must appear in the request's Host: header to\n    # match this virtual host. For the default virtual host (this file) this\n    # value is not decisive as it is used as a last resort host regardless.\n    # However, you must set it for any further virtual host explicitly.\n    #ServerName www.example.com\n\n    ServerAdmin admin@chartres.sportludique.fr\n    DocumentRoot /var/www/chartres----------------------------------------------------------\n\n    # Available loglevels: trace8, ..., trace1, debug, info, notice, warn,\n    # error, crit, alert, emerg.\n    # It is also possible to configure the loglevel for particular\n    # modules, e.g.\n    #LogLevel info ssl:warn\n\n    ErrorLog ${APACHE_LOG_DIR}/error.log\n    CustomLog ${APACHE_LOG_DIR}/access.log combined\n\n    # For most configuration files from conf-available/, which are\n    # enabled or disabled at a global level, it is possible to\n    # include a line for only one particular virtual host. For example the\n    # following line enables the CGI configuration for this host only\n    # after it has been globally disabled with \"a2disconf\".\n    #Include conf-available/serve-cgi-bin.conf\n&lt;/VirtualHost&gt;\n</code></pre> <p>Dans notre cas nous modifions l'adresse sur laquel notre service \u00e9coute sois l'interface DMZ, l'adresse mail du responsable du site et enfin le chemin vers le site.</p>"},{"location":"Serveurs/Web/#34-ajout-du-lien-symlink","title":"3.4 Ajout du lien Symlink","text":"<p>Ce lien qui est l'equivalent d'un racourcis permet d'aller directement vers le site r\u00e9pertorier dans le fichier de configuration du VHost, le VHost iras directement cherche le site dans le bon r\u00e9pertoire. </p> <pre><code>sudo a2ensite www.chartres.sportludique.fr.conf\nsudo systemctl reload apache2\n</code></pre> <p>Le VHost est maintenant configurer et pr\u00eat \u00e0 fonctionner.</p>"},{"location":"Serveurs/Web/#4-route-statique","title":"4. Route statique","text":""},{"location":"Serveurs/Web/#41-pourquoi","title":"4.1 Pourquoi","text":"<p>L'ajout de routes statiques au sein de notre DNS est obligatoire \u00e0 cause de notre pare-feu Stormshield (PFW) et de la conception de notre r\u00e9seau. En effet, comme expliqu\u00e9 ici le Stormshield et son Statefull Inspection bloquent le flux TCP, car le handshake ne s'effectue pas correctement.</p>"},{"location":"Serveurs/Web/#42-ajout-des-routes","title":"4.2 Ajout des routes","text":"<p>Il nous faut donc ajouter manuellement des routes statiques afin de passer directement par le VFW pour rejoindre notre LAN. <pre><code>sudo nano /etc/network/interfaces\n</code></pre></p> <p>Ajouter ensuite ces lignes :</p> <pre><code># Exemple de route : up ip route add 'r\u00e9seau \u00e0 joindre' via 'passerelle' dev 'interface sortante'\nup ip route add 172.28.32.0/24 via 172.28.62.253 dev ens3\nup ip route add 172.28.33.0/24 via 172.28.62.253 dev ens3\nup ip route add 172.28.35.0/24 via 172.28.62.253 dev ens3\n</code></pre> <p>Gr\u00e2ce \u00e0 ces lignes, notre DNS passera directement par le VFW et non par le PFW (Stormshield).</p>"},{"location":"Serveurs/ansible/","title":"Installation et configuration de Ansible","text":""},{"location":"Serveurs/ansible/#contexte","title":"Contexte","text":"<p>Ansible est un outil d\u2019automatisation qui permet de g\u00e9rer et configurer plusieurs machines \u00e0 distance sans installer d\u2019agent suppl\u00e9mentaire. Dans notre cas, il sera utilis\u00e9 pour d\u00e9ployer automatiquement l\u2019agent GLPI sur toutes tes VM Linux, ce qui permettra de centraliser facilement l\u2019inventaire mat\u00e9riel et logiciel dans GLPI, sans avoir \u00e0 intervenir manuellement sur chaque machine.</p>"},{"location":"Serveurs/ansible/#1-installation","title":"1. Installation","text":"<p>Depuis une machine Linux / Debian, mettre \u00e0 jour le syst\u00e8me :</p> <pre><code>sudo apt update\nsudo apt upgrade -y\n</code></pre> <p>Installer Ansible. </p> <p>Ubuntu propose maintenant Ansible via le d\u00e9p\u00f4t officiel ou via apt directement. Pour la version stable on utilisera alors la version <code>apt</code></p> <pre><code>sudo apt install ansible -y\n</code></pre> <p>V\u00e9rifier l\u2019installation</p> <pre><code>ansible --version\n</code></pre> <p>Tu devrais voir la version install\u00e9e, par exemple ansible 2.14.</p>"},{"location":"Serveurs/ansible/#2-configuration-de-base-pour-test","title":"2. Configuration de base pour test","text":"<p>Cr\u00e9er le fichier d\u2019inventaire :</p> <pre><code>sudo mkdir -p /etc/ansible\nsudo nano /etc/ansible/hosts\n</code></pre> <p>Exemple simple de contenu pour tester sur la machine locale :</p> <pre><code>[local]\n127.0.0.1 ansible_connection=local\n</code></pre>"},{"location":"Serveurs/ansible/#connexion-uniquement-avec-cle-recommandee-pour-ansible","title":"Connexion uniquement avec cl\u00e9 (Recommand\u00e9e pour Ansible)","text":"<p>Se rendre dans le fichier :  <pre><code>sudo visudo \n</code></pre></p> <p>Ajoute en dessous de Root en bas de page :</p> <pre><code>ansible ALL=(ALL) ALL\n</code></pre> <p>Ou sans mot de passe (id\u00e9al pour Ansible) : <pre><code>ansible ALL=(ALL) NOPASSWD: ALL\n</code></pre></p> <p>Tester la connexion :</p> <pre><code>ansible all -m ping\n</code></pre> <p>Si tout est OK, tu verras pong.</p>"},{"location":"Serveurs/ansible/#3-configuration-finale","title":"3. Configuration finale","text":"<p>Se rendre dans le fichier suivant : </p> <pre><code>sudo nano /etc/ansible/hosts\n</code></pre> <p>Voici la configuration n\u00e9cessaire pour notre infrastructure : </p> <p>\u00c0 chaque fois qu'on mettra en place une nouvelle VM Serveur, il faudra l'ajouter dans ce fichier de configuration afin que l'inventaire soit \u00e0 jour par la suite dans le GLPI.</p> <pre><code>[local]\n127.0.0.1 ansible_connection=local\n\n[serveurs]\nbdd ansible_host=10.10.120.7 ansible_user=bdd     \nreverse-proxy ansible_host=10.10.120.80 ansible_user=user\nreverse-proxy-sec ansible_host=10.10.120.90 ansible_user=user\nweb ansible_host=10.10.120.11 ansible_user=user\ndns-autorite ansible_host=10.10.120.8 ansible_user=user\ndns-autorite-sec ansible_host=10.10.120.18 ansible_user=user\ndns-resolver ansible_host=10.10.120.9 ansible_user=user\ndns-resolver-sec ansible_host=10.10.120.19 ansible_user=user\nca-autorite ansible_host=10.10.120.12 ansible_user=certificat\ndocker ansible_host=10.10.120.15 ansible_user=user\nansible ansible_host=10.10.120.14 ansible_user=ansible\n\n[all_linux:children]\nserveurs\n</code></pre>"},{"location":"Serveurs/ansible/#4-generation-de-la-cle-publique","title":"4. Generation de la cl\u00e9 publique","text":"<p>Il n'est pas possible d'utiliser une connexion SSH via mot de passe car le serveur Ansible ne les conna\u00eet pas, il faut donc mettre en place une authentification via cl\u00e9 publique, donc on va g\u00e9n\u00e9rer une cl\u00e9 publique pour le serveur Ansible :</p> <pre><code>ssh-keygen -t ed25519\n</code></pre> <p>On ne met pas en place de PassPhrase, car le serveur ne les conna\u00eetra pas non plus donc \u00e7a revient au m\u00eame que le mot de passe !</p>"},{"location":"Serveurs/ansible/#5-copie-de-la-cle-publique-sur-les-vm-serveurs-de-linfrastructure","title":"5. Copie de la cl\u00e9 publique sur les VM Serveurs de l'infrastructure","text":"<p>On va copier la cl\u00e9 publique sur toutes les VM que l'on veut r\u00e9pertorier dans l'inventaire \u00e0 l'aide d'une commande (scp auto) :</p> <pre><code>ssh-copy-id *utilisateur*@10.10.120.?\n</code></pre> <p>On y pr\u00e9cisera le M\u00caME utilisateur utilis\u00e9 dans <code>ansible_user</code> dans la configuration de l'inventaire via <code>sudo nano /etc/ansible/hosts</code>  Faire cela pour toutes les VM pr\u00e9sentes dans la configuration, une par une, m\u00eame s'il y en a un grand nombre.</p>"},{"location":"Serveurs/ansible/#6-test-de-connexion","title":"6. Test de connexion","text":"<p>Une fois les \u00e9tapes pr\u00e9c\u00e9dentes correctement mises en place, nous ferons un test via la commande suivante :</p> <pre><code>ansible all -m ping \n</code></pre> <p>Le r\u00e9sultat retourn\u00e9 doit \u00eatre le suivant (ceci est un exemple):</p> <pre><code>[WARNING]: Host 'dns-resolver-sec' is using the discovered Python interpreter at '/usr/bin/python3.13', but future installation of another Python interpreter could cause a different interpreter to be discovered. See https://docs.ansible.com/ansible-core/2.19/reference_appendices/interpreter_discovery.html for more information.\ndns-resolver-sec | SUCCESS =&gt; {\n    \"ansible_facts\": {\n        \"discovered_interpreter_python\": \"/usr/bin/python3.13\"\n    },\n    \"changed\": false,\n    \"ping\": \"pong\"\n}\n</code></pre>"},{"location":"Serveurs/ansible/#7-mise-en-place-agent-glpi","title":"7. Mise en place Agent GLPI","text":"<p>Nous allons pousser un Agent GLPI sur toutes les machines Linux dans la documentation de la Mise en place de l'Inventaire GLPI</p>"},{"location":"Serveurs/bdd/","title":"Base De Donn\u00e9es","text":""},{"location":"Serveurs/bdd/#installation","title":"Installation","text":"<p>Pour commencer, mettez \u00e0 jour votre syst\u00e8me : <pre><code>sudo apt update\nsudo apt full-upgrade\n</code></pre> Installez le service MariaDB : <pre><code>sudo apt install mariadb-server mariadb-client \n</code></pre> V\u00e9rifiez que le service est actif :  <pre><code>sytemctl status mariadb\n</code></pre></p> <p>Si le service n'es pas actif (1)</p> <ol> <li><code>systemctl enable mariadb  systemctl start mariadb</code></li> </ol>"},{"location":"Serveurs/bdd/#securisation-basique","title":"S\u00e9curisation basique","text":"<p>Nous allons s\u00e9curiser l'acces a la base de donn\u00e9e gr\u00e2ce aux syst\u00e8me int\u00e9gr\u00e9es a mariaDB <pre><code>sudo mysql_secure_installation \n    NOTE: RUNNING ALL PARTS OF THIS SCRIPT IS RECOMMENDED FOR ALL MariaDB SERVERS IN PRODUCTION USE! PLEASE READ EACH STEP CAREFULLYI\n\nIn order to log into MariaDB to secure it, we'll need the current password for the root user. If you've just installed MariaDB, and haven't set the root password yet, you should just press enter here,\n\nEnter current password for root (enter for none):\n</code></pre> Choisiez si vous voulez changer le socket d'authentification pour unix : <pre><code>Enter current password for root (enter for none); OK, successfully used password, moving on.\n\nSetting the root password or using the unix_socket ensures that nobody can log into the MariaDB root user without the proper authorisation,\n\nYou already have your root account protected, so you can safely answer\n\nSwitch to unix socket authentication [Y/n] : n\n</code></pre></p> <p>Info (1)</p> <ol> <li>Dans notre cas, comme indiqu\u00e9 sur la ligne de commande, le compte root est d\u00e9ja s\u00e9curis\u00e9, nul besoin d'activer ce socket d'authentification</li> </ol> <p>Changer le mot de passe root si besoin :  <pre><code>you already have your root account protected, so you can safely answer 'n'\n\nChange the root password? [Y/n]: n\n</code></pre></p> <p>Suprimmer les utilisateurs anonymes : </p> <pre><code>By default, a MariaDB installation has an anonymous user, allowing anyone to log into MariaDB without having to have a user account created for them. This is intended only for testing, and to make the installation go a bit smoother. You should remove them before moving into a\n\nproduction environment.\n\nRemove anonymous users? [Y/n]: y\n</code></pre> <p>D\u00e9sactivez le login a distance via le compte root si besoin (1)</p> <ol> <li>Dans notre cas, tout les acc\u00e8s se feront via SSH donc nous laisserons l'option active</li> </ol> <p>Suprimez la base de donn\u00e9e test : </p> <pre><code>By default, MariaDB comes with a database named 'test' that anyone can access, This is also intended only for testing, and should be removed before moving into a production environment,\n\nRemove test database and access to it? [Y/n] y\n</code></pre> <p>Pour finir, metez la table des privileges a jour pour appliquer vos modifications :  <pre><code>Reloading the privilege tables will ensure that all changes made so far will take effect immediately,\n\nReload privilege tables now? [Y/n] y ... Success!\n\nCleaning up...\n\nAll done! If you've completed all of the above steps, your MariaDB installation should now be secure.\n\nThanks for using MariaDBI bdd@CHA-BDD:\"$\n</code></pre></p>"},{"location":"Serveurs/docker/","title":"Installation et Configuration d'un Docker","text":""},{"location":"Serveurs/docker/#1-principe-du-conteneur","title":"1. Principe du conteneur","text":"<p>Un conteneur est un espace isol\u00e9 de la machine qui sers a faire tourner des applications,il partage le m\u00eame noyau d'OS que l'h\u00f4te tout en ne fesant tourner uniquement les insatnces necessaires au bon fonctionnement de l'application conteneuris\u00e9. </p> <p>Au lieu d'avoir plusieurs application qui utilisent la m\u00eame instance d'un programme exemple : plusisuers services Web qui utilisent la m\u00eame instance d'apache, la contenairisation permet d'isoler chaque service Web dans un conteneur d\u00e9dier, chaque conteneur a sa propre instance d'Apache et sa propre arborescence de fichier limitant les bugs. La conteneurisation evite donc de devoir cr\u00e9e une machine virtuel par application.</p> <p>Toute la documentation de docker est disponible sur le GitHub de Mr Mery.</p>"},{"location":"Serveurs/docker/#2-pourquoi-utiliser-docker","title":"2. Pourquoi utiliser Docker ?","text":"<ol> <li> <p>Isolation : chaque application fonctionne dans son conteneur, s\u00e9par\u00e9e des autres, ce qui r\u00e9duit les conflits de d\u00e9pendances et les bugs.</p> </li> <li> <p>Portabilit\u00e9 : un conteneur fonctionne de la m\u00eame mani\u00e8re partout (PC, serveur, cloud), pas de \u201c\u00e7a marche chez moi mais pas ailleurs\u201d.</p> </li> <li> <p>L\u00e9g\u00e8ret\u00e9 : contrairement aux machines virtuelles, les conteneurs partagent le noyau de l\u2019OS, donc moins de ressources utilis\u00e9es.</p> </li> <li> <p>D\u00e9ploiement rapide : cr\u00e9er, lancer ou arr\u00eater un conteneur est beaucoup plus rapide qu\u2019une VM.</p> </li> <li> <p>Scalabilit\u00e9 : facile de lancer plusieurs instances du m\u00eame conteneur pour g\u00e9rer la charge.</p> </li> <li> <p>Coh\u00e9rence des environnements : d\u00e9veloppeurs, testeurs et production utilisent exactement le m\u00eame environnement.</p> </li> <li> <p>Gestion simplifi\u00e9e : Docker et ses outils permettent d\u2019automatiser le d\u00e9ploiement et la mise \u00e0 jour des applications.</p> </li> </ol>"},{"location":"Serveurs/docker/#3-mise-en-place-de-docker","title":"3. Mise en place de Docker","text":""},{"location":"Serveurs/docker/#31-instalation-et-configuration-primaire","title":"3.1 Instalation et configuration primaire","text":"<p>L'installation de docker est l\u00e9g\u00e8rement diff\u00e9rente des installation de paquets habituels sur linux, en effet docker necessite de r\u00e9cup\u00e9rer une clef GPG et plussuers autres manipulations pour que l'installation se passe au mieux.</p> <p>Ce tutoriel vous montreras pas \u00e0 pas comment installer docker sur un environement linux Debian 13. </p>"},{"location":"Serveurs/docker/#32-creation-dun-conteneur","title":"3.2 Cr\u00e9ation d'un conteneur","text":"<p>Chaque conteneur travaille dans son propre dossier, pour cet exemple nous allons cr\u00e9e le conteneur de notre serveur GLPI. </p> <p>Il nous faut donc trvavailler dans un dossier a part <code>mkdir glpi</code>, il faut ensuite cr\u00e9e le fichier Docker Compose, fichier docker qui permet de g\u00e9rer des applications multi-conteneurs.</p> <p><code>nano docker-compose.yml</code></p> <p><pre><code>services:\n  glpi:\n    image: diouxx/glpi:latest\n    container_name: glpi_app \n    restart: always \n    ports: \n      -  \"2000:80\"   # LAN\n    environment:\n      GLPI_DB_HOST: ${DB_HOST}\n      GLPI_DB_NAME: ${DB_NAME}\n      GLPI_DB_USER: ${DB_USER}\n      GLPI_DB_PASSWORD: ${DB_PASSWORD}\n    volumes:\n      - ./glpi:/var/www/html/glpi\n    networks:\n      - glpi_net\n\nnetworks:\n  glpi_net:\n    driver: bridge\n</code></pre> Les informations propres a ce fichier Docker sont disponibles sur la page d\u00e9di\u00e9e a glpi.</p>"},{"location":"Serveurs/docker/#33-lancement-dun-conteneur","title":"3.3 Lancement d'un conteneur","text":"<p>La commande <code>docker compose up -d</code> \u00e0 \u00e9xecuter dans le dossier de votre conteneur permet de lancer les instances pr\u00e9sentes dnas votre fichier docker-compose.yml en arri\u00e8re plan. </p> <p>Il est possible de v\u00e9rifier les les services lanc\u00e9es gr\u00e2ce a la commande <code>docker compose ps</code>.</p> <p>Enfin pour arreter un conteneur il suffit d'executer la commande <code>docker compose down</code> toujours dans le r\u00e9pertoire de votre conteneur.</p>"},{"location":"Serveurs/mail/","title":"Installation &amp; Configuration du Serveur Mail","text":""},{"location":"Serveurs/mail/#contexte","title":"Contexte","text":"<p>Comme dans toute entreprise, la communication est vitale, qu'elle soit interne au sein du site de Chartres ou externe entre les diff\u00e9rents sites. Dans ce but, nous avons configur\u00e9 un serveur de messagerie afin d'envoyer des mails qui utilise les protocoles SMTP et IMAP.</p>"},{"location":"Serveurs/mail/#1-installation","title":"1. Installation","text":"<p>Nous avons utilis\u00e9 le service \"Hmail\" sur Windows, nous l'utiliserons sur une VM Windows 10 h\u00e9berg\u00e9e sur notre hyperviseur Proxmox.</p>"},{"location":"Serveurs/mail/#11-hmail","title":"1.1 Hmail","text":"<p>La configuration d'installation de HMail est relativement simple : il suffit de lancer le programme d'installation du service disponible ICI, de cr\u00e9er un mot de passe pour le service, \u00e9ventuellement de modifier les dossiers de l'application, puis de terminer l'installation.</p>"},{"location":"Serveurs/mail/#2-configuration","title":"2. Configuration","text":""},{"location":"Serveurs/mail/#21-domaine-et-utilisateurs","title":"2.1 Domaine et Utilisateurs","text":"<p>La premi\u00e8re \u00e9tape consiste \u00e0 d\u00e9finir le nom de domaine, dans notre cas : <code>chartres.sportludique.fr</code>.</p> <p>Concernant les utilisateurs, HMail ne dispose pas d\u2019un module de synchronisation LDAP. Deux options sont donc possibles : - Cr\u00e9er chaque utilisateur manuellement. - Cr\u00e9er automatiquement les utilisateurs via un script PowerShell utilisant LDAP.</p> <p>Nous avons naturellement choisi d\u2019automatiser la cr\u00e9ation via un script PowerShell. Pour cela, il faut cr\u00e9er dans l\u2019AD un compte disposant des droits de lecture sur les objets \u201cutilisateurs\u201d du domaine.</p> <p>Voici le script PowerShell utilis\u00e9 :</p> <pre><code># Script de synchronisation Active Directory vers hMailServer\n# Support AD distant avec authentification\n\n# ========== CONFIGURATION ==========\n# Configuration hMailServer\n$hMailAdminPassword = \"ADMMAIL873!\"\n$defaultDomain = \"chartres.sportludique.fr\"\n$defaultPassword = \"azerty\" # Mot de passe par d\u00e9faut pour nouveaux comptes\n\n# Configuration Active Directory DISTANT\n$adServer = \"10.10.120.2\"  # Nom ou IP du serveur AD\n$adDomain = \"cha.chatres.sportludique.fr\"  # Domaine AD\n$adUsername = \"ldap@cha.chartres.sportludique.fr\"  # Utilisateur avec droits de lecture AD\n$adPassword = \"adm123!\"  # Mot de passe pour l'AD\n\n# Construction du chemin LDAP\n$ldapPath = \"LDAP://$adServer/DC=cha,DC=chartres,DC=sportludique,DC=fr\"\n\n# Options\n$createNewAccounts = $true\n$updateExistingAccounts = $true\n$accountMaxSize = 1024  # Taille max en MB\n$enableAccountsByDefault = $true\n\nWrite-Host \"========================================\" -ForegroundColor Cyan\nWrite-Host \"Synchronisation AD -&gt; hMailServer\" -ForegroundColor Cyan\nWrite-Host \"========================================\" -ForegroundColor Cyan\n\n# ========== TEST CONNECTIVIT\u00c9 AD ==========\nWrite-Host \"`n[Pr\u00e9paration] Test de connectivit\u00e9 AD...\" -ForegroundColor Yellow\n\ntry {\n    Write-Host \"  \u2192 Test ping vers $adServer...\" -ForegroundColor Gray\n    $pingResult = Test-Connection -ComputerName $adServer -Count 1 -Quiet -ErrorAction SilentlyContinue\n\n    if ($pingResult) {\n        Write-Host \"  \u2713 Serveur AD accessible\" -ForegroundColor Green\n    } else {\n        Write-Host \"  \u26a0 Serveur AD non pingable (peut \u00eatre normal si ICMP bloqu\u00e9)\" -ForegroundColor Yellow\n    }\n\n    Write-Host \"  \u2192 Test port LDAP 389...\" -ForegroundColor Gray\n    $tcpClient = New-Object System.Net.Sockets.TcpClient\n    $asyncResult = $tcpClient.BeginConnect($adServer, 389, $null, $null)\n    $wait = $asyncResult.AsyncWaitHandle.WaitOne(3000, $false)\n\n    if ($wait) {\n        $tcpClient.EndConnect($asyncResult)\n        $tcpClient.Close()\n        Write-Host \"  \u2713 Port LDAP 389 accessible\" -ForegroundColor Green\n    } else {\n        Write-Host \"  \u2717 Port LDAP 389 non accessible\" -ForegroundColor Red\n        Write-Host \"    V\u00e9rifiez le pare-feu et la connectivit\u00e9 r\u00e9seau\" -ForegroundColor Yellow\n    }\n}\ncatch {\n    Write-Host \"  \u26a0 Erreur de test r\u00e9seau: $_\" -ForegroundColor Yellow\n}\n\n# ========== CONNEXION HMAILSERVER ==========\nWrite-Host \"`n[1/4] Connexion \u00e0 hMailServer...\" -ForegroundColor Yellow\n\n$hMailApp = $null\n$domain = $null\n\ntry {\n    Write-Host \"  \u2192 Cr\u00e9ation de l'objet COM hMailServer.Application...\" -ForegroundColor Gray\n    $hMailApp = New-Object -ComObject hMailServer.Application\n\n    if ($hMailApp -eq $null) {\n        throw \"L'objet hMailServer.Application est null\"\n    }\n\n    Write-Host \"  \u2192 Authentification...\" -ForegroundColor Gray\n    $authResult = $hMailApp.Authenticate(\"Administrator\", $hMailAdminPassword)\n\n    if (-not $authResult) {\n        throw \"\u00c9chec de l'authentification hMailServer. V\u00e9rifiez le mot de passe.\"\n    }\n\n    Write-Host \"  \u2192 R\u00e9cup\u00e9ration du domaine $defaultDomain...\" -ForegroundColor Gray\n    $domain = $hMailApp.Domains.ItemByName($defaultDomain)\n\n    if ($domain -eq $null) {\n        Write-Host \"`n\u2717 Domaine '$defaultDomain' non trouv\u00e9!\" -ForegroundColor Red\n        Write-Host \"`nDomaines disponibles:\" -ForegroundColor Yellow\n        for ($i = 0; $i -lt $hMailApp.Domains.Count; $i++) {\n            $d = $hMailApp.Domains.Item($i)\n            Write-Host \"  - $($d.Name)\" -ForegroundColor Cyan\n        }\n        exit\n    }\n\n    Write-Host \"\u2713 Connect\u00e9 \u00e0 hMailServer - Domaine: $defaultDomain\" -ForegroundColor Green\n}\ncatch {\n    Write-Host \"`n\u2717 ERREUR de connexion hMailServer:\" -ForegroundColor Red\n    Write-Host $_.Exception.Message -ForegroundColor Red\n    Write-Host \"`nV\u00e9rifications:\" -ForegroundColor Yellow\n    Write-Host \"1. Service hMailServer d\u00e9marr\u00e9 ?\" -ForegroundColor White\n    Write-Host \"2. PowerShell ex\u00e9cut\u00e9 en Administrateur ?\" -ForegroundColor White\n    Write-Host \"3. Mot de passe administrateur correct ?\" -ForegroundColor White\n}\n\n# ========== R\u00c9CUP\u00c9RATION DES COMPTES HMAILSERVER ==========\nWrite-Host \"`n[2/4] R\u00e9cup\u00e9ration des comptes hMailServer existants...\" -ForegroundColor Yellow\n\n$hmailAccounts = @{}\ntry {\n    for ($i = 0; $i -lt $domain.Accounts.Count; $i++) {\n        $account = $domain.Accounts.Item($i)\n        $hmailAccounts[$account.Address.ToLower()] = $account\n    }\n    Write-Host \"\u2713 $($hmailAccounts.Count) comptes trouv\u00e9s\" -ForegroundColor Green\n}\ncatch {\n    Write-Host \"\u2717 Erreur: $_\" -ForegroundColor Red\n}\n\n# ========== CONNEXION \u00c0 L'AD DISTANT ==========\nWrite-Host \"`n[3/4] Connexion \u00e0 l'Active Directory distant...\" -ForegroundColor Yellow\nWrite-Host \"  Serveur: $adServer\" -ForegroundColor Gray\nWrite-Host \"  Chemin LDAP: $ldapPath\" -ForegroundColor Gray\n\ntry {\n    # Cr\u00e9er des credentials pour l'AD distant\n    $secPassword = ConvertTo-SecureString $adPassword -AsPlainText -Force\n    $credential = New-Object System.Management.Automation.PSCredential($adUsername, $secPassword)\n\n    # Cr\u00e9er la connexion LDAP avec authentification\n    Write-Host \"  \u2192 Authentification sur l'AD...\" -ForegroundColor Gray\n\n    $directoryEntry = New-Object System.DirectoryServices.DirectoryEntry(\n        $ldapPath,\n        $adUsername,\n        $adPassword,\n        [System.DirectoryServices.AuthenticationTypes]::Secure\n    )\n\n    # Test de la connexion\n    $testBind = $directoryEntry.Name\n    if ([string]::IsNullOrEmpty($testBind) -and $directoryEntry.NativeObject -eq $null) {\n        throw \"Impossible de se connecter \u00e0 l'AD. V\u00e9rifiez les credentials et le chemin LDAP.\"\n    }\n\n    Write-Host \"  \u2713 Authentifi\u00e9 sur l'AD\" -ForegroundColor Green\n\n    # Cr\u00e9er le searcher\n    Write-Host \"  \u2192 Recherche des utilisateurs...\" -ForegroundColor Gray\n    $searcher = New-Object System.DirectoryServices.DirectorySearcher\n    $searcher.SearchRoot = $directoryEntry\n\n    # Filtre pour les utilisateurs avec email\n    $searcher.Filter = \"(&amp;(objectClass=user)(objectCategory=person)(mail=*))\"\n\n    # Propri\u00e9t\u00e9s \u00e0 r\u00e9cup\u00e9rer\n    $searcher.PropertiesToLoad.AddRange(@(\n        \"sAMAccountName\",\n        \"mail\",\n        \"givenName\",\n        \"sn\",\n        \"displayName\",\n        \"userAccountControl\"\n    ))\n\n    $searcher.PageSize = 1000\n    $searcher.SearchScope = [System.DirectoryServices.SearchScope]::Subtree\n\n    $results = $searcher.FindAll()\n\n    Write-Host \"\u2713 $($results.Count) utilisateurs trouv\u00e9s dans AD\" -ForegroundColor Green\n}\ncatch {\n    Write-Host \"`n\u2717 ERREUR de connexion AD:\" -ForegroundColor Red\n    Write-Host $_.Exception.Message -ForegroundColor Red\n    Write-Host \"`nV\u00e9rifications:\" -ForegroundColor Yellow\n    Write-Host \"1. Le serveur AD '$adServer' est-il accessible ?\" -ForegroundColor White\n    Write-Host \"2. Les credentials AD sont-ils corrects ?\" -ForegroundColor White\n    Write-Host \"   Username: $adUsername\" -ForegroundColor Gray\n    Write-Host \"3. Le chemin LDAP est-il correct ?\" -ForegroundColor White\n    Write-Host \"   $ldapPath\" -ForegroundColor Gray\n    Write-Host \"4. Le port 389 (LDAP) est-il ouvert ?\" -ForegroundColor White\n    Write-Host \"5. Essayez avec LDAPS (port 636) si disponible\" -ForegroundColor White\n}\n\n# ========== SYNCHRONISATION ==========\nWrite-Host \"`n[4/4] Synchronisation en cours...\" -ForegroundColor Yellow\nWrite-Host \"\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\" -ForegroundColor Gray\n\n$stats = @{\n    Created = 0\n    Updated = 0\n    Skipped = 0\n    Errors = 0\n}\n\nforeach ($result in $results) {\n    $props = $result.Properties\n\n    # R\u00e9cup\u00e9rer les informations\n    $samAccount = if ($props[\"samaccountname\"].Count -gt 0) { $props[\"samaccountname\"][0] } else { \"Inconnu\" }\n    $email = if ($props[\"mail\"].Count -gt 0) { $props[\"mail\"][0] } else { $null }\n    $firstName = if ($props[\"givenname\"].Count -gt 0) { $props[\"givenname\"][0] } else { \"\" }\n    $lastName = if ($props[\"sn\"].Count -gt 0) { $props[\"sn\"][0] } else { \"\" }\n    $displayName = if ($props[\"displayname\"].Count -gt 0) { $props[\"displayname\"][0] } else { $samAccount }\n\n    # V\u00e9rifier si le compte est actif dans AD\n    $userAccountControl = if ($props[\"useraccountcontrol\"].Count -gt 0) { $props[\"useraccountcontrol\"][0] } else { 0 }\n    $isEnabled = -not ($userAccountControl -band 0x2)  # 0x2 = ACCOUNTDISABLE\n\n    # V\u00e9rifier l'adresse email\n    if ([string]::IsNullOrWhiteSpace($email)) {\n        Write-Host \"\u2298 $displayName - Pas d'email\" -ForegroundColor DarkGray\n        $stats.Skipped++\n        continue\n    }\n\n    # Forcer le domaine mail si l'email AD ne correspond pas\n    if (-not $email.EndsWith(\"@$defaultDomain\")) {\n        $emailParts = $email.Split('@')\n        $email = \"$($emailParts[0])@$defaultDomain\"\n        Write-Host \"\u2139 $displayName - Email modifi\u00e9: $email\" -ForegroundColor Cyan\n    }\n\n    $emailLower = $email.ToLower()\n\n    try {\n        # V\u00e9rifier si le compte existe dans hMailServer\n        if ($hmailAccounts.ContainsKey($emailLower)) {\n            # MISE \u00c0 JOUR\n            if ($updateExistingAccounts) {\n                $account = $hmailAccounts[$emailLower]\n\n                $account.PersonF---irstName = $firstName\n                $account.PersonLastName = $lastName\n                $account.Active = $isEnabled\n                $account.Save()\n\n                Write-Host \"\u21bb $email - Mis \u00e0 jour\" -ForegroundColor Cyan\n                $stats.Updated++\n            }\n            else {\n                Write-Host \"\u2192 $email - Existe d\u00e9j\u00e0\" -ForegroundColor Gray\n                $stats.Skipped++\n            }\n        }\n        else {\n            # CR\u00c9ATION\n            if ($createNewAccounts) {\n                $newAccount = $domain.Accounts.Add()\n                $newAccount.Address = $email\n                $newAccount.Password = $defaultPassword\n                $newAccount.Active = if ($enableAccountsByDefault) { $isEnabled } else { $false }\n                $newAccount.PersonFirstName = $firstName\n                $newAccount.PersonLastName = $lastName\n                $newAccount.MaxSize = $accountMaxSize\n                $newAccount.Save()\n\n                Write-Host \"\u2713 $email - Cr\u00e9\u00e9\" -ForegroundColor Green\n                $stats.Created++\n            }\n            else {\n                Write-Host \"\u2298 $email - Nouveau (cr\u00e9ation d\u00e9sactiv\u00e9e)\" -ForegroundColor DarkGray\n                $stats.Skipped++\n            }\n        }\n    }\n    catch {\n        Write-Host \"\u2717 $email - ERREUR: $_\" -ForegroundColor Red\n        $stats.Errors++\n    }\n}\n\n# ========== R\u00c9SULTATS ==========\nWrite-Host \"`n========================================\" -ForegroundColor Cyan\nWrite-Host \"R\u00c9SUM\u00c9 DE LA SYNCHRONISATION\" -ForegroundColor Cyan\nWrite-Host \"========================================\" -ForegroundColor Cyan\nWrite-Host \"Comptes cr\u00e9\u00e9s    : $($stats.Created)\" -ForegroundColor Green\nWrite-Host \"Comptes mis \u00e0 jour: $($stats.Updated)\" -ForegroundColor Cyan\nWrite-Host \"Comptes ignor\u00e9s  : $($stats.Skipped)\" -ForegroundColor Gray\nWrite-Host \"Erreurs          : $($stats.Errors)\" -ForegroundColor Red\nWrite-Host \"\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\" -ForegroundColor Gray\nWrite-Host \"Total hMailServer: $($domain.Accounts.Count) comptes\" -ForegroundColor White\nWrite-Host \"========================================`n\" -ForegroundColor Cyan\n\n# ========== NETTOYAGE ==========\nif ($results) { $results.Dispose() }\nif ($searcher) { $searcher.Dispose() }\nif ($directoryEntry) { $directoryEntry.Dispose() }\nif ($domain -ne $null) {\n    [System.Runtime.Interopservices.Marshal]::ReleaseComObject($domain) | Out-Null\n}\nif ($hMailApp -ne $null) {\n    [System.Runtime.Interopservices.Marshal]::ReleaseComObject($hMailApp) | Out-Null\n}\n[System.GC]::Collect()\n[System.GC]::WaitForPendingFinalizers()\n\nWrite-Host \"Synchronisation termin\u00e9e!\" -ForegroundColor Green\n</code></pre> <p>Ce script se connecte \u00e0 l\u2019AD en LDAP en utilisant le compte <code>ldap</code>. Il lit tous les utilisateurs ainsi que leur adresse mail, puis cr\u00e9e les comptes correspondants sur le serveur HMail. Le script supprime \u00e9galement les comptes qui ne sont plus pr\u00e9sents dans l\u2019AD. Il peut \u00eatre int\u00e9gr\u00e9 au Planificateur de t\u00e2ches Windows pour une ex\u00e9cution automatique \u00e0 intervalles r\u00e9guliers, afin de maintenir la liste des utilisateurs \u00e0 jour (1).</p> <ol> <li>\u00c0 noter que ce script attribue le mot de passe \"azerty\" \u00e0 tous les comptes mail. Ce mot de passe peut \u00e9videmment \u00eatre synchronis\u00e9 avec les mots de passe de l\u2019Active Directory.</li> </ol>"},{"location":"Serveurs/mail/#22-parametrage-reseau","title":"2.2 Param\u00e9trage r\u00e9seau","text":"<p>Afin que le serveur SMTP et IMAP puissent joindre et r\u00e9pondre aux connexions des autres r\u00e9seaux ainsi que des connexions Internet, il faut mettre en place plusieurs choses : - Routes de retour sur le serveur HMail - PAT sur les routeurs R1 et R2 - Enregistrements DNS imap et smtp - Ajout des r\u00e9seaux dans la configuration HMail</p>"},{"location":"Serveurs/mail/#221-routes-de-retour-sur-le-serveur-hmail","title":"2.2.1 Routes de retour sur le serveur Hmail","text":"<p>Toujours \u00e0 cause du stateful inspection, nous devons ajouter des routes de retour sur tout \u00e9quipement ayant besoin de joindre le LAN.</p> <pre><code>===========================================================================\nItin\u00e9raires persistants\u00a0:\n  Adresse r\u00e9seau    Masque r\u00e9seau  Adresse passerelle M\u00e9trique\n      172.28.35.0    255.255.255.0    172.28.62.253       1\n    172.28.63.128  255.255.255.128    172.28.62.253       1\n      172.28.33.0    255.255.255.0    172.28.62.253       1\n          0.0.0.0          0.0.0.0    172.28.62.254  Par d\u00e9faut\n===========================================================================\n</code></pre>"},{"location":"Serveurs/mail/#222-pat-sur-r1-r2","title":"2.2.2 PAT sur R1 &amp; R2","text":"<pre><code>ip nat inside source static tcp 172.28.62.2 25 183.44.28.1 25 #R\u00e8gle SMTP\nip nat inside source static tcp 172.28.62.2 143 183.44.28.1 143 #R\u00e8gle IMAP\n</code></pre>"},{"location":"Serveurs/mail/#223-enregistrements-dns","title":"2.2.3 Enregistrements DNS","text":"<p>Sur la zone externe de notre DNS autorit\u00e9 (1)</p> <ol> <li>\u00c0 savoir que les enregistrements sont les m\u00eames sur le DNS d\u2019autorit\u00e9 secondaire, car nous n\u2019avons pas de serveur mail secondaire.</li> </ol> <pre><code>smtp IN A 183.44.28.1  #Redirection requ\u00eates SMTP\nimap IN A 183.44.28.1 #Redirection requ\u00eates IMAP\nchartres.sportludique.fr. IN MX 10 smtp.chartres.sportludique.fr. #Redirection des requ\u00eates SMTP depuis l'ext\u00e9rieur\n</code></pre> <p>Sur la zone interne de notre DNS d\u2019autorit\u00e9 (les zones internes sont synchronis\u00e9es entre le primaire et le secondaire).</p> <pre><code>#Services\nhelpdesk IN A 172.28.62.5\n#Mail\nsmtp IN A 172.28.62.2\nimap IN A 172.28.62.2\nchartres.sportludique.fr. IN MX 10 smtp.chartres.sportludique.fr.\n</code></pre>"},{"location":"Serveurs/mail/#224-ajout-des-reseaux-dans-hmail","title":"2.2.4 Ajout des r\u00e9seaux dans Hmail","text":"<p>Il faut ajouter les r\u00e9seaux autoris\u00e9s \u00e0 communiquer avec le serveur directement dans la configuration de celui-ci :</p> <p><code>Settings &gt; Advanced &gt; IP Ranges &gt; Add</code></p> <p>Il suffit ensuite d\u2019ajouter le r\u00e9seau client : 172.28.35.0 \u2192 172.28.35.254 et d\u2019augmenter la priorit\u00e9 pour que cette \u00e9tendue passe au-dessus des autres. Pensez bien \u00e0 d\u00e9sactiver le SSL/TLS s\u2019il n\u2019est pas utilis\u00e9.</p>"},{"location":"Serveurs/mail/#3-utilisation","title":"3. Utilisation","text":"<p>C\u00f4t\u00e9 utilisateur, il suffit de se connecter depuis un client de messagerie, de s\u2019authentifier avec ses identifiants du domaine et d\u2019envoyer des mails !</p>"},{"location":"Serveurs/Logs/Datanode/","title":"Datanode","text":"<p>En cours...</p>"},{"location":"Serveurs/Logs/Graylog/","title":"Graylog","text":"<p>En cours...</p>"},{"location":"Serveurs/Logs/Rsyslog/","title":"Configuration des VM pour envoyer les logs vers Graylog en UDP","text":""},{"location":"Serveurs/Logs/Rsyslog/#objectif","title":"Objectif :","text":"<p>L\u2019objectif est de configurer toutes les VM Linux/Debian de l'infrastructure afin qu\u2019elles envoient leurs logs vers le serveur Graylog via UDP. Cela permet de centraliser la collecte et la visualisation des logs, d\u2019identifier rapidement les probl\u00e8mes et de suivre les activit\u00e9s de toutes les VM. Nous utilisons Ansible pour automatiser l\u2019installation et la configuration, garantissant que toutes les machines sont configur\u00e9es de mani\u00e8re coh\u00e9rente.</p>"},{"location":"Serveurs/Logs/Rsyslog/#1-installer-rsyslog-sur-la-vm-ansible","title":"1 : Installer rsyslog sur la VM Ansible","text":"<pre><code>sudo apt install rsyslog\n</code></pre>"},{"location":"Serveurs/Logs/Rsyslog/#2-creer-le-playbook","title":"2 : Cr\u00e9er le playbook","text":"<p>\u00c9diter le fichier :</p> <pre><code>sudo nano /etc/ansible/playbooks/rsyslog_graylog.yml\n</code></pre> <p>Mettre le contenu suivant\u202f:</p> <pre><code>- name: Configurer toutes les VM pour envoyer les logs vers Graylog en UDP\n  hosts: all\n  become: true\n  vars:\n    graylog_server_ip: \"10.10.120.16\"\n    graylog_udp_port: 514\n\n  tasks:\n    - name: Forcer apt \u00e0 utiliser IPv4\n      lineinfile:\n        path: /etc/apt/apt.conf.d/99force-ipv4\n        line: 'Acquire::ForceIPv4 \"true\";'\n\n    - name: Mettre \u00e0 jour le cache apt\n      apt:\n        update_cache: yes\n        cache_valid_time: 3600\n\n    - name: Installer rsyslog \n      apt:\n        name:\n          - rsyslog\n        state: present\n\n    - name: Cr\u00e9er le dossier rsyslog.d si n\u00e9cessaire\n      file:\n        path: /etc/rsyslog.d\n        state: directory\n        mode: '0755'\n\n    - name: D\u00e9ployer le fichier de configuration rsyslog pour Graylog (UDP) avec hostname\n    copy:\n        dest: /etc/rsyslog.d/90-graylog.conf\n        content: |\n        *.* @{{ graylog_server_ip }}:{{ graylog_udp_port }};RSYSLOG_ForwardFormat\n        owner: root\n        group: root\n        mode: '0644'\n\n    - name: Red\u00e9marrer rsyslog pour appliquer la nouvelle config\n    service:\n        name: rsyslog\n        state: restarted\n        enabled: yes\n\n    - name: Envoyer un log de test pour appara\u00eetre dans Graylog\n      shell: logger \"Test log initial depuis {{ inventory_hostname }}\"\n</code></pre>"},{"location":"Serveurs/Logs/Rsyslog/#3-executer-le-playbook","title":"3 : Ex\u00e9cuter le playbook","text":"<pre><code>ansible-playbook -i /etc/ansible/hosts /etc/ansible/playbooks/rsyslog_graylog.yml\n</code></pre>"},{"location":"Serveurs/Logs/Rsyslog/#4-verifier-la-configuration","title":"4 : V\u00e9rifier la configuration","text":"<pre><code>ansible all_linux -m shell -a 'logger \"Test Graylog UDP depuis {{ inventory_hostname }}\"'\n</code></pre> <p>Apr\u00e8s avoir lanc\u00e9 cette commande sur Ansible, v\u00e9rifiez sur le Graylog si les logs apparaissent.</p>"},{"location":"Serveurs/ReverseProxy/Rp/","title":"Installation &amp; Configuration d'un Reverse Proxy","text":""},{"location":"Serveurs/ReverseProxy/Rp/#objectif","title":"Objectif :","text":"<p>Un reverse proxy est un serveur interm\u00e9diaire positionn\u00e9 devant un ou plusieurs serveurs d'application. Il re\u00e7oit les requ\u00eates des clients (navigateurs web) et les transmet au serveur interne appropri\u00e9, puis retourne la r\u00e9ponse du serveur au client, agissant comme le point d'entr\u00e9e unique.</p>"},{"location":"Serveurs/ReverseProxy/Rp/#1-installation-de-nginx","title":"1. Installation de Nginx","text":"<p>Sur Debian/Ubuntu :</p> <pre><code>sudo apt update\nsudo apt install nginx\n</code></pre>"},{"location":"Serveurs/ReverseProxy/Rp/#2-activation-de-la-configuration","title":"2. Activation de la configuration","text":"<p>Cr\u00e9ez le fichier :</p> <pre><code>sudo nano /etc/nginx/sites-available/chartres.sportludique.fr\n</code></pre> <p>Mettre cette conf pour un acc\u00e8s en http :</p> <pre><code>server {\n    listen 80;\n    server_name www.chartres.sportludique.fr;\n\n    location / {\n        proxy_pass http://172.28.62.3;   \n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n    }\n}\n</code></pre> <p>Activez-le :</p> <p><pre><code>sudo ln -s /etc/nginx/sites-available/chartres.sportludique.fr /etc/nginx/sites-enabled/\nsudo nginx -t\nsudo systemctl restart nginx\n</code></pre> Puis v\u00e9rifier si depuis l'interne et l'externe le site est accessible.</p>"},{"location":"Serveurs/ReverseProxy/Rp/#3-mise-en-place-des-certificats-pour-https","title":"3. Mise en place des certificats pour HTTPS","text":"<p>Il faut importer le certificat autorit\u00e9, le certificat auto-sign\u00e9 et la cl\u00e9 priv\u00e9e qui sont li\u00e9 au nom de domaine du site. Les certificats se situe sur la vm Openssl :</p> <p><pre><code>scp www.chartres.sportludique.fr.cert.pem user@10.10.120.80:/tmp/\nscp ca.cert.pem user@10.10.120.80:/tmp/\nscp www.chartres.sportludique.fr.key.pem user@10.10.120.80:/tmp/\n</code></pre> Puis il faut les d\u00e9placer au bon endroit dans la vm et leur accorder des droits :</p> <pre><code>sudo mv /tmp/www.chartres.sportludique.fr.cert.pem /etc/ssl/certs/\nsudo mv /tmp/ca.cert.pem /etc/ssl/certs/\nsudo mv /tmp/www.chartres.sportludique.fr.key.pem /etc/ssl/private/\n\nsudo chmod 644 /etc/ssl/certs/www.chartres.sportludique.fr.cert.pem\nsudo chmod 644 /etc/ssl/certs/ca.cert.pem\nsudo chmod 600 /etc/ssl/private/www.chartres.sportludique.fr.key.pem\nsudo chown root:root /etc/ssl/certs/www.chartres.sportludique.fr.cert.pem\nsudo chown root:root /etc/ssl/certs/ca.cert.pem\nsudo chown root:root /etc/ssl/private/www.chartres.sportludique.fr.key.pem\n</code></pre> <p>Ensuite il faut v\u00e9rifier que les fichier \"www.chartres.sportludique.fr.cert.pem\" et \"www.chartres.sportludique.fr.key.pem\" soit bien li\u00e9e :</p> <pre><code>openssl x509 -noout -modulus -in /etc/ssl/certs/chartres.sportludique.fr.crt.pem | openssl md5\nopenssl rsa -noout -modulus -in /etc/ssl/private/chartres.sportludique.fr.key.pem | openssl md5\n</code></pre> <p>Si ils ont le m\u00eame hash alors les fichier sont bien li\u00e9e, sinon il faut recommencer toute l'\u00e9tape car il faut absolument qu'ils soit li\u00e9e sinon le HTTPS ne fonctionnera jamais.</p>"},{"location":"Serveurs/ReverseProxy/Rp/#4-combiner-certificat-autorite-auto-signe-dans-le-meme-fichier","title":"4. Combiner certificat autorit\u00e9 + auto-sign\u00e9 dans le m\u00eame fichier","text":"<p>Nginx ne permet pas dans sa configuration d'aller chercher 2 certificats, il faut donc assembler les deux dans un seul et m\u00eame fichier:</p> <pre><code>sudo -i\n\ncat /etc/ssl/certs/www.chartres.sportludique.fr.cert.pem /etc/ssl/certs/ca.cert.pem &gt; /etc/ssl/certs/www.chartres.sportludique.fr.fullchain.pem\n</code></pre>"},{"location":"Serveurs/ReverseProxy/Rp/#5-configuration-https","title":"5. Configuration HTTPS","text":"<p>Modifi\u00e9 la conf pour que le site fonctionne en HTTPS:</p> <pre><code>sudo nano /etc/nginx/sites-available/chartres.sportludique.fr\n</code></pre> <pre><code>server {\n    listen 80;\n    server_name www.chartres.sportludique.fr;\n\n    # Redirection HTTP \u2192 HTTPS\n    return 301 https://$host$request_uri;\n}\n\nserver {\n    listen 443 ssl;\n    server_name www.chartres.sportludique.fr;\n\n    # Certificat SSL du reverse proxy (public)\n    ssl_certificate /etc/ssl/certs/www.chartres.sportludique.fr.fullchain.pem;\n    ssl_certificate_key /etc/ssl/private/www.chartres.sportludique.fr.key.pem;\n\n    # (Optionnel) param\u00e8tres SSL recommand\u00e9s\n    proxy_ssl_protocols TLSv1.2 TLSv1.3;\n    proxy_ssl_ciphers HIGH:!aNULL:!MD5;\n\n    location / {\n        # Redirection vers ton site interne HTTPS (ta VM)\n        proxy_pass https://172.28.62.3;\n\n        proxy_ssl_server_name on;\n        proxy_ssl_verify off;  # si ton certificat interne n\u2019est pas sign\u00e9 par une autorit\u00e9 publique\n\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto https;\n    }\n}\n</code></pre>"},{"location":"Serveurs/ReverseProxy/Rp/#6-verification","title":"6. V\u00e9rification","text":"<p>V\u00e9rifier qu'il n'y a pas d'erreur et red\u00e9marrer le service:</p> <pre><code>sudo nginx -t\nsudo systemctl restart nginx\n</code></pre> <p>Puis v\u00e9rifier si depuis l'interne et l'externe le site est accessible.</p>"},{"location":"Serveurs/ReverseProxy/RpSec/","title":"Reverse Proxy Secondaire","text":""},{"location":"Serveurs/ReverseProxy/RpSec/#1-installation-de-nginx","title":"1. Installation de Nginx","text":"<p>Vous pouvez aller voir la documention pour l'installation.</p>"},{"location":"Serveurs/ReverseProxy/RpSec/#2-synchronisation-des-2-reverse-proxy","title":"2. Synchronisation des 2 Reverse Proxy","text":""},{"location":"Serveurs/ReverseProxy/RpSec/#21-creation-de-la-cle-ssh-sur-le-reverse-proxy-primaire","title":"2.1 Cr\u00e9ation de la cl\u00e9 SSH sur le Reverse Proxy Primaire","text":"<pre><code>ssh-keygen -t ed25519\n</code></pre> <p>La cl\u00e9 se cr\u00e9ee dans le repertoire /root/.ssh/id_ed25519.</p> <p>Elle servira pour la connexion automatique vers le Reverse Proxy Secondaire.</p>"},{"location":"Serveurs/ReverseProxy/RpSec/#22-copie-de-la-cle-publique-vers-le-reverse-proxy-secondaire","title":"2.2 Copie de la cl\u00e9 publique vers le Reverse Proxy Secondaire","text":"<pre><code>ssh-copy-id -i /root/.ssh/id_ed25519.pub root@172.28.62.10\n</code></pre> <p>Comme sa le Reverse Proxy Primaire pourra se connecter en SSH sans mot de passe vers le Reverse Proxy Secondaire.</p>"},{"location":"Serveurs/ReverseProxy/RpSec/#23-installation-de-rsync-et-lsyncd","title":"2.3 Installation de rsync et lsyncd","text":"<p>Il faut les installer sur les deux Reverse Proxy.</p> <pre><code>sudo apt install rsync lsyncd\n</code></pre>"},{"location":"Serveurs/ReverseProxy/RpSec/#24-configuration-de-lsyncd","title":"2.4 Configuration de lsyncd","text":"<p><pre><code>settings {\n    logfile    = \"/var/log/lsyncd.log\",\n    statusFile = \"/var/log/lsyncd.status\",\n    statusInterval = 20,\n}\n\nsync {\n    default.rsync,\n    source = \"/etc/nginx/\",\n    target = \"root@172.28.62.10:/etc/nginx/\",\n    rsync = {\n        archive = true,\n        compress = false,\n        verbose = true,\n    }\n}\n</code></pre> Puis red\u00e9marrer le service :</p> <pre><code>systemctl restart lsyncd\nsystemctl enable lsyncd\n</code></pre>"},{"location":"Serveurs/ReverseProxy/RpSec/#25-verification","title":"2.5 V\u00e9rification","text":"<p>V\u00e9rifi\u00e9 les logs pour voir si il n'y a pas d'erreur :</p> <pre><code>tail -f /var/log/lsyncd.log\n</code></pre> <p>Si il n'y a rien et qu'il y a se message \"Normal: Startup of /etc/nginx -&gt; root@172.28.62.10:/etc/nginx/ finished.\", alors la synchronisation est op\u00e9rationnelle.</p> <p>Sinon il faut regarder le message d'erreur et le r\u00e9soudre.</p>"},{"location":"Serveurs/ReverseProxy/RpSec/#3-test","title":"3. Test","text":"<p>Sur le Reverse Proxy Primaire :</p> <pre><code>sudo touch /etc/nginx/test-sync.txt\n</code></pre> <p>Puis sur le Reverse Proxy Secondaire :</p> <pre><code>ls -l /etc/nginx/\n</code></pre> <p>Si le fichier \"test-sync.txt\" y est alors la synchronisation est fonctionnelle.</p>"},{"location":"Serveurs/ReverseProxy/RpSec/#4-important","title":"4. Important","text":"<p>Si il y a des sites en https il ne faudra pas oublier d'importer les certificats du site car la synchronisation ne le g\u00e8re pas.</p> <p>Pour savoir comment faire voir ici.</p>"},{"location":"Service%20AD/ad/","title":"Installer et configurer Active Directory sur Windows Server.","text":""},{"location":"Service%20AD/ad/#objectif","title":"Objectif","text":"<p>L\u2019Active Directory (AD) est une fonctionnalit\u00e9 essentielle dans les environnements Windows Server, permettant la gestion centralis\u00e9e des utilisateurs, des ordinateurs et des ressources r\u00e9seau. Dans cet article, nous allons vous guider pas \u00e0 pas pour installer le r\u00f4le Active Directory et promouvoir votre serveur en tant que contr\u00f4leur de domaine. Pr\u00e9-requis</p> <p>Avant de commencer, assurez-vous de remplir les pr\u00e9requis suivants :</p> <pre><code>Syst\u00e8me d\u2019exploitation : Un serveur Windows (Windows Server 2016/2019 minimum recommand\u00e9 ou 2022 ou 2025).\nConfiguration r\u00e9seau :\n    - Une adresse IP fixe configur\u00e9e.\n    - Un nom d\u2019h\u00f4te clairement d\u00e9fini.\nAcc\u00e8s administrateur : Les droits d\u2019administrateur local sur le serveur.\nMise \u00e0 jour : Le serveur est \u00e0 jour avec les derniers correctifs de s\u00e9curit\u00e9.\n</code></pre>"},{"location":"Service%20AD/ad/#1-preparer-votre-serveur","title":"1. Pr\u00e9parer votre serveur","text":""},{"location":"Service%20AD/ad/#11-configurer-une-adresse-ip-fixe","title":"1.1 Configurer une adresse IP fixe :","text":"<p>Se rendre dans \u00ab Panneau de configuration -&gt; R\u00e9seau et internet -&gt; Centre r\u00e9seau et partage -&gt; Cliquer sur votre carte r\u00e9seau -&gt; Propri\u00e9t\u00e9 :</p> <p></p> <p>D\u00e9finissez une adresse IP, un masque de sous-r\u00e9seau et une passerelle.</p>"},{"location":"Service%20AD/ad/#12-renommer-le-serveur","title":"1.2 Renommer le serveur :","text":"<p>Allez dans Param\u00e8tres &gt; Syst\u00e8me &gt; Informations syst\u00e8me &gt; Renommer ce PC.</p> <p></p> <p>Donnez-lui un nom descriptif, comici c'est <code>CHA_DC_01</code> pour le premier contr\u00f4leur de domaine.</p> <p></p> <p>Puis Red\u00e9marrez le serveur.</p>"},{"location":"Service%20AD/ad/#2-ajouter-le-role-active-directory","title":"2. Ajouter le r\u00f4le Active Directory","text":""},{"location":"Service%20AD/ad/#21-ouvrir-le-gestionnaire-de-serveur","title":"2.1 Ouvrir le Gestionnaire de Serveur :","text":"<p>Cliquez sur G\u00e9rer &gt; Ajouter des r\u00f4les et fonctionnalit\u00e9s.</p> <p></p>"},{"location":"Service%20AD/ad/#22-selectionner-le-type-dinstallation","title":"2.2 S\u00e9lectionner le type d\u2019installation :","text":"<p>Choisissez Installation bas\u00e9e sur un r\u00f4le ou une fonctionnalit\u00e9 et cliquez sur Suivant.</p> <p></p>"},{"location":"Service%20AD/ad/#23-choisir-le-serveur-cible","title":"2.3 Choisir le serveur cible :","text":"<p>S\u00e9lectionnez le serveur sur lequel installer le r\u00f4le.</p> <p></p>"},{"location":"Service%20AD/ad/#24-selectionner-le-role-active-directory","title":"2.4 S\u00e9lectionner le r\u00f4le Active Directory :","text":"<p>Dans la liste, cochez Services de domaine Active Directory (AD DS).</p> <p>Confirmez l\u2019ajout des fonctionnalit\u00e9s n\u00e9cessaires.</p> <p></p>"},{"location":"Service%20AD/ad/#25-finaliser-linstallation","title":"2.5 Finaliser l\u2019installation :","text":"<p>Cliquez sur Installer.</p> <p>Une fois termin\u00e9, ne red\u00e9marrez pas imm\u00e9diatement, car vous devrez promouvoir le serveur en tant que contr\u00f4leur de domaine.</p> <p></p>"},{"location":"Service%20AD/ad/#3-promouvoir-le-serveur-en-controleur-de-domaine","title":"3. Promouvoir le Serveur en Contr\u00f4leur de Domaine","text":""},{"location":"Service%20AD/ad/#31-lancer-lassistant","title":"3.1 Lancer l\u2019assistant :","text":"<p>Dans le Gestionnaire de Serveur, cliquez sur la notification indiquant que la configuration post-installation est n\u00e9cessaire.</p> <p>Cliquez sur Promouvoir ce serveur en contr\u00f4leur de domaine.</p> <p></p>"},{"location":"Service%20AD/ad/#32-creer-un-nouveau-domaine","title":"3.2 Cr\u00e9er un nouveau domaine :","text":"<p>Choisissez Ajouter une nouvelle for\u00eat. Entrez le nom de domaine racine, ici c'est <code>cha.chartres.sportludique.fr</code> pour les pages  </p>"},{"location":"Service%20AD/ad/#33-configurer-les-options-du-domaine","title":"3.3 Configurer les options du domaine :","text":"<p>S\u00e9lectionnez le niveau fonctionnel de la for\u00eat et du domaine (Windows Server 2016 ou plus r\u00e9cent).</p> <p>Configurez un mot de passe pour le mode de restauration des services d\u2019annuaire (DSRM).</p> <p></p>"},{"location":"Service%20AD/ad/#34-verification-dns-et-netbios","title":"3.4 V\u00e9rification DNS et NetBIOS :","text":"<p>V\u00e9rifiez le nom NetBIOS propos\u00e9 et ajustez-le si n\u00e9cessaire.</p> <p></p>"},{"location":"Service%20AD/ad/#35-valider-et-installer","title":"3.5 Valider et installer :","text":"<p>Laissez l\u2019assistant valider la configuration.</p> <p>Cliquez sur Installer. Le serveur red\u00e9marrera automatiquement.</p> <p></p>"},{"location":"Service%20AD/ad/#4-verifier-linstallation","title":"4. V\u00e9rifier l\u2019installation","text":""},{"location":"Service%20AD/ad/#41-confirmer-le-role-active-directory","title":"4.1 Confirmer le r\u00f4le Active Directory :","text":"<p>Apr\u00e8s le red\u00e9marrage, connectez-vous et ouvrez le Gestionnaire de Serveur. V\u00e9rifiez que le r\u00f4le AD DS est install\u00e9 et fonctionne correctement.</p>"},{"location":"Service%20AD/ad/#42-tester-le-domaine","title":"4.2 Tester le domaine :","text":"<p>Ouvrez l\u2019outil Active Directory Users and Computers.</p> <p></p> <p>Assurez-vous que votre domaine appara\u00eet et que les objets par d\u00e9faut (comme <code>Users</code> et <code>Computers</code>) sont pr\u00e9sents.</p>"},{"location":"Service%20AD/ad/#5-conclusion","title":"5. Conclusion","text":"<p>Vous avez maintenant un serveur configur\u00e9 comme contr\u00f4leur de domaine. Les prochaines \u00e9tapes incluront :</p> <ol> <li>Cr\u00e9er des unit\u00e9s organisationnelles (OU) : Pour organiser les utilisateurs et les ordinateurs.</li> <li>Ajouter des utilisateurs au domaine : Cr\u00e9ez des comptes pour les utilisateurs.</li> <li>Joindre un ordinateur au domaine : Pour int\u00e9grer des machines au r\u00e9seau Active Directory.</li> </ol>"},{"location":"Service%20AD/adbackup/","title":"Mise en place &amp; Installation d'un AD BACK UP","text":""},{"location":"Service%20AD/adbackup/#1-installation-de-lad","title":"1. Installation de L'AD","text":"<p>Suivre cette documentation pour configuer l'AD Backup en adaptant pour lui : Installe AD</p>"},{"location":"Service%20AD/adbackup/#2-redondance-ad1-et-ad2","title":"2. Redondance AD1 et AD2","text":""},{"location":"Service%20AD/adbackup/#21-redondance-ad-principal-et-ad-secondaire","title":"2.1 Redondance AD Principal et AD Secondaire","text":"<ul> <li>AD Principal : 172.28.33.2nom : CHA-DC-01.cha.chartres.sportludique.fr</li> <li>AD Secondaire : 172.28.33.3nom : CHA_DC_02.cha.chartres.sportludique.fr</li> <li>Domaine : cha.chartres.sportludique.fr</li> </ul> <p>Les deux h\u00e9bergent :</p> <ul> <li>Active Directory Domain Services (AD DS)</li> <li>DNS int\u00e9gr\u00e9 \u00e0 Active Directory</li> </ul> <p>Ainsi, si l'AD Principal tombe, les utilisateurs et ordinateurs peuvent encore :</p> <ul> <li>s'authentifer sur le domaine</li> <li>r\u00e9soudre les noms via DNS</li> </ul>"},{"location":"Service%20AD/adbackup/#22-mettre-lad-secondaire-en-controleur-de-domaine-secondaire","title":"2.2 Mettre l'AD Secondaire en contr\u00f4leur de domaine secondaire","text":""},{"location":"Service%20AD/adbackup/#221-installer-les-roles-necessaires","title":"2.2.1 Installer les r\u00f4les n\u00e9cessaires","text":"<p>Dessus en PowerShell : <pre><code>Install-WindowsFeature AD-Domain-Services, DNS -IncludeManagementTools\n</code></pre></p>"},{"location":"Service%20AD/adbackup/#222-promouvoir-en-controleur-de-domaine","title":"2.2.2 Promouvoir en contr\u00f4leur de domaine","text":"<pre><code>Install-ADDSDomainController `\n    -DomainName \"cha.chartres.sportludique.fr\" `\n    -InstallDns:$true `\n    -Credential (Get-Credential) `\n    -SiteName \"Default-First-Site-Name\" `\n    -ReplicationSourceDC \"CHA_DC_01.cha.chartres.sportludique.fr\"\n</code></pre> <p>\ud83d\udca1 Une fen\u00eatre d\u2019authentification s\u2019ouvre \u2192 entre un compte du domaine ayant les droits d\u2019administrateur et red\u00e9marrer \u00e0 la fin.</p>"},{"location":"Service%20AD/adbackup/#23-verification-de-la-replication-ad","title":"2.3 V\u00e9rification de la r\u00e9plication AD","text":"<p>Sur Powershell : <pre><code>repadmin /replsummary\n</code></pre></p> <p>Si les deux AD s'affiche et qu'il n'y a aucune erreur alors la r\u00e9plication fonctionne.</p>"},{"location":"Service%20AD/adbackup/#24-configuration-dns-croisee","title":"2.4 Configuration DNS crois\u00e9e","text":"<p>Sur AD Principal, configure : <pre><code>DNS pr\u00e9f\u00e9r\u00e9 : 172.28.33.2\nDNS secondaire : 172.28.33.3\n</code></pre></p> <p>Sur AD Secondaire : <pre><code>DNS pr\u00e9f\u00e9r\u00e9 : 172.28.33.3\nDNS secondaire : 172.28.33.2\n</code></pre></p>"},{"location":"Service%20AD/adbackup/#25-verification-de-la-replication-dns","title":"2.5 V\u00e9rification de la r\u00e9plication DNS","text":"<p>Sur AD Secondaire, ouvre :</p> <ul> <li>Gestionnaire DNS \u2192 Zones de recherche directe \u2192 cha.chartres.sportludique.fr</li> </ul> <p>Tu devrais y voir exactement les m\u00eames enregistrements que sur AD Principal. Si oui, la r\u00e9plication DNS fonctionne (gr\u00e2ce \u00e0 AD).</p>"},{"location":"Service%20AD/adbackup/#3-verification-finale","title":"3. V\u00e9rification finale","text":""},{"location":"Service%20AD/adbackup/#31-eteins-lad-principal","title":"3.1 \u00c9teins l'AD Principal.","text":""},{"location":"Service%20AD/adbackup/#32-sur-le-client-verifie-la-resolution-dns","title":"3.2 Sur le client, v\u00e9rifie la r\u00e9solution DNS :","text":"<p><pre><code>nslookup cha.chartres.sportludique.fr\n</code></pre> Si il y a une r\u00e9ponse sa veut dire que le DNS est bien redondant.</p>"},{"location":"Service%20AD/adbackup/#33-connecte-toi-a-ton-domaine","title":"3.3 Connecte-toi \u00e0 ton domaine :","text":"<p>Si l'authentification fonctionne alors l'AD est redondant aussi. Si ces deux test fonctionne alors notre AD Secondaire et bien en backup de l'AD Principal.</p>"},{"location":"Service%20AD/adcs/","title":"Mise en place AD CS (Active Directory Certificate Services)","text":""},{"location":"Service%20AD/adcs/#1-a-quoi-ca-sert","title":"1. \u00c0 quoi \u00e7a sert ?","text":"<p>AD CS est un r\u00f4le de Windows Server qui permet de cr\u00e9er et de g\u00e9rer une infrastructure de gestion de certificats (PKI \u2014 Public Key Infrastructure).  Concr\u00e8tement, il sert \u00e0 \u00e9mettre, renouveler et r\u00e9voquer des certificats num\u00e9riques utilis\u00e9s pour s\u00e9curiser les communications et authentifier les utilisateurs, ordinateurs ou services dans un environnement Active Directory.</p>"},{"location":"Service%20AD/adcs/#2-a-quoi-ca-sert-dans-un-active-directory","title":"2. \u00c0 quoi \u00e7a sert dans un Active Directory","text":"<ul> <li>Authentification s\u00e9curis\u00e9e : permet d\u2019utiliser des certificats pour authentifier les utilisateurs et les machines (par exemple, avec les connexions Wi-Fi 802.1X ou VPN).</li> <li>Chiffrement : les certificats permettent de chiffrer les \u00e9changes (HTTPS, e-mails, fichiers\u2026).</li> <li>Signature num\u00e9rique : garantit l\u2019int\u00e9grit\u00e9 et la provenance des documents ou du code.</li> <li>Automatisation : dans un domaine AD, la d\u00e9livrance et le renouvellement des certificats peuvent \u00eatre automatis\u00e9s via les strat\u00e9gies de groupe (GPO).</li> </ul>"},{"location":"Service%20AD/adcs/#21-installer-le-role-ad-cs","title":"2.1 Installer le r\u00f4le \u00ab AD CS \u00bb","text":"<p>Allez dans \"Ajouter des r\u00f4les et des fonctionnalit\u00e9s\".</p> <p>Puis installer le service ci-dessous :</p> <p></p> <p>Finir l'intallation.</p>"},{"location":"Service%20AD/adcs/#22-telecharger-les-certificats-sur-la-machine-physique","title":"2.2 T\u00e9l\u00e9charger les certificats sur la machine physique","text":"<p>Allez dans le service et ouvrir L'autorit\u00e9 de certification :</p> <p></p> <p>Puis cliquez sur cha-CHA_DC_02-CA et allez dans les Propri\u00e9t\u00e9s :</p> <p></p> <p>Ensuite faite Afficher le certificat et allez dans D\u00e9tails :</p> <p></p> <p>Enfin cliquer sur Copier dans un fichier et suivre l'assistant d'exportation pour t\u00e9l\u00e9charger le fichier sur votre machine physique.</p>"},{"location":"Service%20AD/adcs/#23-certificat-sur-proxmox","title":"2.3 Certificat sur Proxmox","text":"<p>Afin de mettre en place le certificat sur Proxmox, allez voir la documentation suivante : LDAPS sur Proxmox</p>"},{"location":"Service%20AD/adusers/","title":"Script PowerShell \u2014 Cr\u00e9ation d'une Structure Active Directory","text":""},{"location":"Service%20AD/adusers/#objectif","title":"Objectif :","text":"<p>Ce script PowerShell automatise la cr\u00e9ation d\u2019une arborescence Active Directory pour le domaine : cha.chartres.sportludique.fr.  </p> <p>Le script permet de cr\u00e9er automatiquement : - Les Unit\u00e9s Organisationnelles (OU) des diff\u00e9rents services. - Les utilisateurs correspondant aux r\u00f4les du projet. - Les groupes de s\u00e9curit\u00e9 associ\u00e9s. - Et une v\u00e9rification finale pour s\u2019assurer du bon d\u00e9ploiement.</p>"},{"location":"Service%20AD/adusers/#2-presentation-generale","title":"2. Pr\u00e9sentation g\u00e9n\u00e9rale","text":"\u00c9l\u00e9ment D\u00e9tails Langage PowerShell Module requis <code>ActiveDirectory</code> Domaine <code>cha.chartres.sportludique.fr</code> Unit\u00e9 de base (root) <code>DC=cha,DC=chartres,DC=sportludique,DC=fr</code> OU cr\u00e9\u00e9es Direction, Marketing, Finances, Ressources Humaines, DSI Groupes cr\u00e9\u00e9s <code>G_DSI</code>, <code>G_RH</code> Utilisateurs cr\u00e9\u00e9s 5 (DSI + RH) Mot de passe par d\u00e9faut <code>P@ssword123</code> (modifiable dans la variable <code>$Password</code>)"},{"location":"Service%20AD/adusers/#3-contexte","title":"3. Contexte","text":"<ul> <li>Les utilisateurs Claude Postic (Directeur DSI) et Helen Paisley-Le Bihan (Directrice RH) ont \u00e9t\u00e9 cr\u00e9\u00e9s car le sc\u00e9nario du projet l\u2019exigeait, repr\u00e9sentant la direction de deux p\u00f4les essentiels de l\u2019entreprise.  </li> <li>Les utilisateurs David, Wassim et Simon repr\u00e9sentent les techniciens de la DSI.   <p>Ces trois comptes correspondent en r\u00e9alit\u00e9 aux administrateurs techniques et r\u00e9alisateurs du projet BTS SIO SISR.   Ils disposent de droits administratifs \u00e9tendus sur l\u2019infrastructure et servent \u00e0 la gestion et \u00e0 la maintenance du syst\u00e8me.</p> </li> </ul> <p>Ainsi, la structure refl\u00e8te \u00e0 la fois le besoin fonctionnel et le besoin technique (acc\u00e8s administrateur pour les concepteurs du projet).</p>"},{"location":"Service%20AD/adusers/#4-contenu-du-script","title":"4. Contenu du script","text":"<pre><code>powershell\nImport-Module ActiveDirectory\n\n# ============================\n# 1. Cr\u00e9ation des OU\n# ============================\nNew-ADOrganizationalUnit -Name \"Direction\" -Path \"DC=cha,DC=chartres,DC=sportludique,DC=fr\"\nNew-ADOrganizationalUnit -Name \"Marketing\" -Path \"DC=cha,DC=chartres,DC=sportludique,DC=fr\"\nNew-ADOrganizationalUnit -Name \"Finances\" -Path \"DC=cha,DC=chartres,DC=sportludique,DC=fr\"\nNew-ADOrganizationalUnit -Name \"Ressources Humaines\" -Path \"DC=cha,DC=chartres,DC=sportludique,DC=fr\"\nNew-ADOrganizationalUnit -Name \"DSI\" -Path \"DC=cha,DC=chartres,DC=sportludique,DC=fr\"\n\n# ============================\n# 2. Variables g\u00e9n\u00e9rales\n# ============================\n$Domaine = \"cha.chartres.sportludique.fr\"\n$Password = ConvertTo-SecureString \"P@ssword123\" -AsPlainText -Force\n\n# ============================\n# 3. Cr\u00e9ation des utilisateurs\n# ============================\n\n# --- DSI ---\nNew-ADUser -Name \"Claude Postic\" -GivenName \"Claude\" -Surname \"Postic\" `\n-DisplayName \"Claude Postic\" -SamAccountName \"claude.dsi\" `\n-UserPrincipalName \"claude.dsi@$Domaine\" `\n-Path \"OU=DSI,DC=cha,DC=chartres,DC=sportludique,DC=fr\" `\n-AccountPassword $Password -Enabled $true -Title \"Directeur DSI\"\n\nNew-ADUser -Name \"David\" -GivenName \"David\" -Surname \"Technicien\" `\n-DisplayName \"David\" -SamAccountName \"david.dsi\" `\n-UserPrincipalName \"david.dsi@$Domaine\" `\n-Path \"OU=DSI,DC=cha,DC=chartres,DC=sportludique,DC=fr\" `\n-AccountPassword $Password -Enabled $true -Title \"Technicien DSI\"\n\nNew-ADUser -Name \"Wassim\" -GivenName \"Wassim\" -Surname \"Technicien\" `\n-DisplayName \"Wassim\" -SamAccountName \"wassim.dsi\" `\n-UserPrincipalName \"wassim.dsi@$Domaine\" `\n-Path \"OU=DSI,DC=cha,DC=chartres,DC=sportludique,DC=fr\" `\n-AccountPassword $Password -Enabled $true -Title \"Technicien DSI\"\n\nNew-ADUser -Name \"Simon\" -GivenName \"Simon\" -Surname \"Technicien\" `\n-DisplayName \"Simon\" -SamAccountName \"simon.dsi\" `\n-UserPrincipalName \"simon.dsi@$Domaine\" `\n-Path \"OU=DSI,DC=cha,DC=chartres,DC=sportludique,DC=fr\" `\n-AccountPassword $Password -Enabled $true -Title \"Technicien DSI\"\n\n# --- Ressources Humaines ---\nNew-ADUser -Name \"Helen Paisley-Le Bihan\" -GivenName \"Helen\" -Surname \"Paisley-Le Bihan\" `\n-DisplayName \"Helen Paisley-Le Bihan\" -SamAccountName \"helen.rh\" `\n-UserPrincipalName \"helen.rh@$Domaine\" `\n-Path \"OU=Ressources Humaines,DC=cha,DC=chartres,DC=sportludique,DC=fr\" `\n-AccountPassword $Password -Enabled $true -Title \"Directrice RH\"\n\n# ============================\n# 4. (Optionnel) Cr\u00e9ation des groupes\n# ============================\nNew-ADGroup -Name \"G_DSI\" -GroupScope Global -Path \"OU=DSI,DC=cha,DC=chartres,DC=sportludique,DC=fr\"\nNew-ADGroup -Name \"G_RH\" -GroupScope Global -Path \"OU=Ressources Humaines,DC=cha,DC=chartres,DC=sportludique,DC=fr\"\n\nAdd-ADGroupMember -Identity \"G_DSI\" -Members \"claude.dsi\",\"david.dsi\",\"wassim.dsi\",\"simon.dsi\"\nAdd-ADGroupMember -Identity \"G_RH\" -Members \"helen.rh\"\n\n# ============================\n# 5. V\u00e9rification\n# ============================\nWrite-Host \"`n\u2705 Structure AD cr\u00e9\u00e9e avec succ\u00e8s !`n\"\nGet-ADOrganizationalUnit -Filter * | Select-Object Name\nGet-ADUser -Filter * | Select-Object Name, SamAccountName, DistinguishedName\n</code></pre>"},{"location":"Service%20AD/adusers/#5-attribution-des-droits-administrateurs-aux-utilisateurs-de-la-dsi","title":"5. Attribution des droits Administrateurs aux utilisateurs de la DSI","text":""},{"location":"Service%20AD/adusers/#51-le-groupe-admins-du-domaine","title":"5.1 Le groupe \u201cAdmins du domaine\u201d","text":""},{"location":"Service%20AD/adusers/#511-definition","title":"5.1.1 D\u00e9finition","text":"<p>Le groupe \u201cAdmins du domaine\u201d est un groupe de s\u00e9curit\u00e9 int\u00e9gr\u00e9 cr\u00e9\u00e9 automatiquement lors de l\u2019installation d\u2019un domaine Active Directory (\u00e9quivalent anglais : Domain Admins). Il est situ\u00e9 dans le conteneur :</p> <pre><code>CN=Users,DC=cha,DC=chartres,DC=sportludique,DC=fr\n</code></pre>"},{"location":"Service%20AD/adusers/#512-role","title":"5.1.2 R\u00f4le","text":"<p>Les membres du groupe Admins du domaine disposent de privil\u00e8ges complets sur :</p> <pre><code>- Tous les objets Active Directory (utilisateurs, ordinateurs, groupes, OU)\n- Les strat\u00e9gies de groupe (GPO)\n- Les serveurs et postes membres du domaine\n- Les droits d\u2019administration locale sur chaque machine du domaine\n</code></pre> <p>C\u2019est donc le plus haut niveau d\u2019administration au sein d\u2019un domaine AD.</p>"},{"location":"Service%20AD/adusers/#52-attribution-des-droits-aux-techniciens-dsi","title":"5.2 Attribution des droits aux techniciens DSI","text":"<p>L\u2019attribution s\u2019est faite \u00e0 l\u2019aide de la commande PowerShell suivante, ex\u00e9cut\u00e9e depuis une session administrateur sur un contr\u00f4leur de domaine :</p> <pre><code>Add-ADGroupMember -Identity \"Admins du domaine\" -Members \"david.dsi\",\"wassim.dsi\",\"simon.dsi\"\n</code></pre>"},{"location":"Service%20AD/adusers/#53-verification-de-lappartenance-au-groupe","title":"5.3 V\u00e9rification de l\u2019appartenance au groupe","text":"<p>Apr\u00e8s l\u2019ajout, la commande suivante a \u00e9t\u00e9 utilis\u00e9e pour v\u00e9rifier que les utilisateurs ont bien \u00e9t\u00e9 int\u00e9gr\u00e9s :</p> <pre><code>Get-ADGroupMember \"Admins du domaine\" | Select Name, SamAccountName\n</code></pre> <p>\ud83d\udccb R\u00e9sultat obtenu :</p> <pre><code>Name           SamAccountName\n----           ---------------\nAdministrator  administrator\nDavid          david.dsi\nWassim         wassim.dsi\nSimon          simon.dsi\n</code></pre>"},{"location":"Service%20AD/adusers/#6-script-creation-des-uo-utilisateurs-et-groupes-du-pole-chartre","title":"6. Script cr\u00e9ation des UO, Utilisateurs et Groupes du P\u00f4le Chartre.","text":"<p>\ud83e\uddfe Contexte</p> <p>Nous disposons d\u2019un fichier CSV nomm\u00e9 chartres.csv, contenant la liste des utilisateurs \u00e0 cr\u00e9er dans Active Directory. Chaque ligne du fichier indique :</p> <ul> <li>Le nom et pr\u00e9nom de l\u2019utilisateur,</li> <li>Le service auquel il appartient,</li> <li>Et \u00e9ventuellement le sous-service.</li> </ul> <p>L\u2019objectif est d\u2019automatiser la cr\u00e9ation de :</p> <ul> <li>Les Unit\u00e9s d\u2019Organisation (OU) correspondant aux services,</li> <li>Les sous-OU correspondant aux sous-services,</li> <li>Les groupes de s\u00e9curit\u00e9 associ\u00e9s \u00e0 chaque niveau (service et sous-service),</li> <li>Les utilisateurs, plac\u00e9s dans la bonne OU selon leur service/sous-service.</li> </ul> <p>\ud83d\udc65 Groupes de s\u00e9curit\u00e9</p> <p>Pour chaque service et sous-service, des groupes AD sont cr\u00e9\u00e9s afin de faciliter la gestion des droits. Les groupes suivent la convention de nommage suivante :</p> Niveau Exemple de nom de groupe Service global <code>GRP_&lt;Service&gt;</code> (exemple : <code>GRP_SAV</code>) Sous-service <code>GRP_&lt;Service&gt;_&lt;SousService&gt;</code> (exemples : <code>GRP_SAV_Responsable</code>, <code>GRP_Marketing_A</code>) <p>\ud83d\udc64 Utilisateurs</p> <p>Chaque utilisateur est cr\u00e9\u00e9 avec :</p> Champ Description Exemple Nom d\u2019affichage Combinaison du nom et du pr\u00e9nom de l\u2019utilisateur. <code>Dupont Jean</code> Identifiant de connexion (samAccountName) Format standardis\u00e9 : <code>nomdefamille.prenom</code>. <code>dupont.jean</code> Mot de passe initial Mot de passe g\u00e9n\u00e9rique attribu\u00e9 \u00e0 la cr\u00e9ation du compte. <code>Password</code> Changement de mot de passe obligatoire L\u2019utilisateur devra d\u00e9finir un nouveau mot de passe \u00e0 sa premi\u00e8re connexion. (Automatique) Gestion des doublons (collision) Si un samAccountName existe d\u00e9j\u00e0, un num\u00e9ro est ajout\u00e9 en suffixe pour garantir l\u2019unicit\u00e9. <code>dupont.jean2</code> <p>\ud83d\udcc1 Exemple de structure finale dans l\u2019AD : </p> <pre><code>OU=Users\n\u251c\u2500\u2500 OU=DIRECTION\n\u2502   \u2514\u2500\u2500 GRP_Direction\n\u251c\u2500\u2500 OU=DSI\n\u2502   \u2514\u2500\u2500 GRP_DSI\n\u251c\u2500\u2500 OU=RH\n\u2502   \u2514\u2500\u2500 GRP_RH\n\u251c\u2500\u2500 OU=COMPTABILITE\n\u2502   \u2514\u2500\u2500 GRP_Comptabilite\n\u251c\u2500\u2500 OU=SAV\n\u2502   \u251c\u2500\u2500 OU=Responsable\n\u2502   \u2514\u2500\u2500 OU=Operateur\n\u2502   \u251c\u2500\u2500 GRP_SAV\n\u2502   \u251c\u2500\u2500 GRP_SAV_Responsable\n\u2502   \u2514\u2500\u2500 GRP_SAV_Operateur\n\u251c\u2500\u2500 OU=Marketing\n\u2502   \u251c\u2500\u2500 OU=A\n\u2502   \u251c\u2500\u2500 OU=B\n\u2502   \u251c\u2500\u2500 OU=X\n\u2502   \u2514\u2500\u2500 OU=Y\n\u2502   \u251c\u2500\u2500 GRP_Marketing\n\u2502   \u251c\u2500\u2500 GRP_Marketing_A\n\u2502   \u251c\u2500\u2500 GRP_Marketing_B\n\u2502   \u251c\u2500\u2500 GRP_Marketing_X\n\u2502   \u2514\u2500\u2500 GRP_Marketing_Y\n\u2514\u2500\u2500 OU=Juridique\n    \u2514\u2500\u2500 GRP_Juridique\n</code></pre>"},{"location":"Service%20AD/adusers/#61-script-powershell-afin-de-mettre-en-place-les-consignes-ci-dessus","title":"6.1 Script Powershell afin de mettre en place les consignes ci-dessus.","text":"<pre><code># === Script cr\u00e9ation des UO, Utilisateurs et Groupes du P\u00f4le Chartres ===\n\nImport-Module ActiveDirectory\n\n$csvPath = \"C:\\Users\\Administrateur\\Documents\\chartres.csv\"\n$baseDN  = \"DC=cha,DC=chartres,DC=sportludique,DC=fr\"\n$domain  = \"cha.chartres.sportludique.fr\"\n$pw = ConvertTo-SecureString \"Password\" -AsPlainText -Force\n\n$subOUs = @{\n    \"SAV\"        = @(\"Responsable\",\"Operateur\")\n    \"Marketing\"  = @(\"A\",\"B\",\"X\",\"Y\")\n}\n\nfunction Remove-Accents($text){\n    $n = $text.Normalize([Text.NormalizationForm]::FormD)\n    -join ($n.ToCharArray() | Where-Object{[Globalization.CharUnicodeInfo]::GetUnicodeCategory($_) -ne \"NonSpacingMark\"})\n}\n\nfunction Unique-Sam($last,$first){\n    $b = ((Remove-Accents $last).ToLower() -replace \"\\s+\") + \".\" + ((Remove-Accents $first).ToLower() -replace \"\\s+\")\n    if($b.Length -gt 20){$b=$b.Substring(0,20)}\n    $s=$b;$i=1\n    while(Get-ADUser -Filter \"SamAccountName -eq '$s'\" -ErrorAction SilentlyContinue){$s=\"$b$i\";$i++}\n    return $s\n}\n\n$users = Import-Csv $csvPath -Delimiter ';' -Encoding Default\n\nforeach($u in $users){\n    $service = $u.service.Trim().ToUpper()\n    $sous = $u.'sous service'.Trim()\n    $nom = $u.NOM; $prenom = $u.PRENOM\n    if(!$nom -or !$prenom -or !$service){continue}\n\n    $ouService = \"OU=$service,$baseDN\"\n    if(-not (Get-ADOrganizationalUnit -Filter \"DistinguishedName -eq '$ouService'\" -ErrorAction SilentlyContinue)){\n        New-ADOrganizationalUnit -Name $service -Path $baseDN -ProtectedFromAccidentalDeletion $false\n    }\n\n    if($subOUs.ContainsKey($service)){\n        foreach($s in $subOUs[$service]){\n            $ouSous = \"OU=$s,OU=$service,$baseDN\"\n            if(-not (Get-ADOrganizationalUnit -Filter \"DistinguishedName -eq '$ouSous'\" -ErrorAction SilentlyContinue)){\n                New-ADOrganizationalUnit -Name $s -Path \"OU=$service,$baseDN\" -ProtectedFromAccidentalDeletion $false\n            }\n        }\n    }\n\n    $grpService = \"GRP_$service\"\n    if(-not (Get-ADGroup -Filter \"Name -eq '$grpService'\" -ErrorAction SilentlyContinue)){\n        New-ADGroup -Name $grpService -GroupScope Global -Path $ouService\n    }\n\n    if($sous -and $subOUs[$service] -contains $sous){\n        $grpSous = \"GRP_${service}_$sous\"\n        if(-not (Get-ADGroup -Filter \"Name -eq '$grpSous'\" -ErrorAction SilentlyContinue)){\n            New-ADGroup -Name $grpSous -GroupScope Global -Path \"OU=$sous,OU=$service,$baseDN\"\n        }\n        $targetOU = \"OU=$sous,OU=$service,$baseDN\"\n    } else {\n        $targetOU = $ouService\n    }\n\n    $sam = Unique-Sam $nom $prenom\n    $upn = \"$sam@$domain\"\n    $display = \"$nom $prenom\"\n\n    if(-not (Get-ADUser -Filter \"SamAccountName -eq '$sam'\" -ErrorAction SilentlyContinue)){\n        New-ADUser -Name $display -GivenName $prenom -Surname $nom -SamAccountName $sam -UserPrincipalName $upn -AccountPassword $pw -Enabled $true -ChangePasswordAtLogon $true -Path $targetOU\n    }\n\n    Add-ADGroupMember -Identity $grpService -Members $sam -ErrorAction SilentlyContinue\n    if($grpSous){Add-ADGroupMember -Identity $grpSous -Members $sam -ErrorAction SilentlyContinue}\n}\n</code></pre>"},{"location":"Service%20AD/dhcp/","title":"Installer et configurer un serveur DHCP sur Windows Server 2025.","text":""},{"location":"Service%20AD/dhcp/#1-installation-du-role-dhcp","title":"1. Installation du r\u00f4le DHCP","text":"<p>Ouvrir le Gestionnaire de serveur. Cliquer sur G\u00e9rer, puis sur Ajouter des r\u00f4les et fonctionnalit\u00e9s.</p> <p>Choisir : \u00ab Installation bas\u00e9e sur un r\u00f4le ou une fonctionnalit\u00e9 \u00bb.</p> <p></p> <p>S\u00e9lectionner le serveur local.</p> <p></p> <p>Cocher Serveur DHCP, ajouter les fonctionnalit\u00e9s propos\u00e9es.</p> <p></p> <p>Nous n\u2019allons pas ajout\u00e9 de fonctionnalit\u00e9, nous pouvons faire suivant : </p> <p></p> <p>D\u00e9rouler la petite fl\u00e8che pour acc\u00e9der aux options :</p> <p></p> <p>Faire une nouvelle \u00e9tendue : </p> <p></p> <p>Cliquer sur suivant pour passer \u00e0 la prochaine \u00e9tape : </p> <p></p> <p>Nommer l'\u00e9tendue et une description pour pr\u00e9ciser sa signification (La description est facultative)</p> <p></p> <p>Remplir l'entendue avec les adresses IP correspondantes aux besoins.</p> <p></p> <p>Remplir les adresses IP exclu des \u00e9tendues DHCP.</p> <p></p> <p>Ne pas toucher au bail, cliquer juste sur Suivant.</p> <p></p> <p>Confirmer la mise en place de l'etendue DHCP.</p> <p></p> <p>Ajouter une passerelle par d\u00e9faut pour le routeur qui permettra l'acc\u00e8s \u00e0 Internet.</p> <p></p> <p>Ajouter un nom de Domaine ainsi que l'adresse correspondante au serveur DNS.</p> <p></p> <p>On ne mettra pas de serveur WINS, cliquer sur Suivant.</p> <p></p> <p>Confirmer l'activation de l'etendue.</p> <p></p> <p>Cliquer sur Suivant.</p> <p></p> <p>D\u00e9rouler les fl\u00e8ches afin de v\u00e9rifier si les extensions apparaissent bien dans le menu DHCP.</p> <p></p>"},{"location":"Service%20AD/dns/","title":"Installer et configurer un serveur DNS sur Windows Server.","text":"<p>Dans l\u2019assistant, s\u00e9lectionnez Installation bas\u00e9e sur un r\u00f4le ou une fonctionnalit\u00e9 : </p> <p>Choisissez votre serveur dans la liste propos\u00e9e : </p> <p>Dans la section des r\u00f4les, s\u00e9lectionnez le r\u00f4le DNS : </p> <p>Passez ensuite \u00e0 la section Confirmation et cliquez sur Installer pour lancer l\u2019installation.</p>"},{"location":"Service%20AD/dns/#1-configuration-du-service-dns","title":"1. Configuration du service DNS","text":"<p>Dans l\u2019onglet Outils, s\u00e9lectionnez le service DNS : </p> <p>Effectuez un clic droit sur votre serveur puis cliquez sur Configurer un serveur DNS : </p> <p>Cr\u00e9ez une zone de recherche directe : </p> <p>Notre serveur g\u00e8re la zone enti\u00e8re et d\u00e9l\u00e8gue les requ\u00eates inconnues au DNS de notre FAI : </p> <p>Ajoutez le nom de la zone de recherche, dans notre cas chartres : </p> <p>Par mesure de s\u00e9curit\u00e9, seules les mises \u00e0 jour dynamiques s\u00e9curis\u00e9es seront autoris\u00e9es : </p> <p>Ajoutez l\u2019adresse IP du DNS public de votre choix. Dans notre cas, nous utilisons le serveur du r\u00e9seau Internet fictif : </p> <p>Enfin, enregistrez votre nouvelle zone de recherche DNS : </p>"},{"location":"Service%20AD/incidents/","title":"Incident Utilisateurs AD : Expiration massive des mots de passe utilisateurs dans Active Directory apr\u00e8s coupure de courant","text":""},{"location":"Service%20AD/incidents/#1-contexte","title":"1. Contexte","text":"<ul> <li>Environnement : Active Directory avec plusieurs Domain Controllers (DC), un principal et un secondaire (AD CS).</li> <li>Proxmox li\u00e9 \u00e0 l'AD pour authentification LDAP.</li> <li>Les utilisateurs du DSI (wassim.dsi, simon.dsi, david.dsi) \u00e9taient configur\u00e9s avec des mots de passe actifs et ne devaient pas expirer.</li> <li>Une coupure de courant a provoqu\u00e9 l'arr\u00eat brutal du DC Secondaire.</li> </ul>"},{"location":"Service%20AD/incidents/#2-symptomes-observes","title":"2. Sympt\u00f4mes observ\u00e9s","text":"<ul> <li>Les utilisateurs ont tous un mot de passe expir\u00e9s donc la connexion aux sessions est impossible.</li> <li>Logs Proxmox indiquant :</li> </ul> <pre><code>authentication failure; user=&lt;utilisateur&gt;@ad msg=80090308: LdapErr: DSID-0C090549, comment: AcceptSecurityContext error, data 532\n</code></pre> <ul> <li><code>data 532</code> signifie : Password expired.</li> </ul>"},{"location":"Service%20AD/incidents/#3-analyse-technique","title":"3. Analyse technique","text":"<ol> <li> <p>Chaque compte utilisateur AD poss\u00e8de les attributs :</p> </li> <li> <p><code>pwdLastSet</code> (date du dernier changement de mot de passe)</p> </li> <li><code>userAccountControl</code> (flags, dont PASSWORD_EXPIRED)</li> <li>La GPO du domaine indique :</li> </ol> <pre><code>MaxPasswordAge : 42 jours\nMinPasswordAge : 1 jour\nComplexityEnabled : True\n</code></pre> <ol> <li> <p>Apr\u00e8s la coupure de courant :</p> </li> <li> <p>Les DC ont red\u00e9marr\u00e9 brutalement, certains journaux NTDS non flush\u00e9s.</p> </li> <li>L'heure syst\u00e8me sur les DC a pu \u00eatre d\u00e9synchronis\u00e9e.</li> <li>Les DC ont r\u00e9\u00e9valu\u00e9 <code>pwdLastSet</code> pour tous les comptes.</li> <li> <p>Comme l'heure ou les USN \u00e9taient incoh\u00e9rents, AD a marqu\u00e9 tous les mots de passe comme expir\u00e9s.</p> </li> <li> <p>M\u00eame sans expiration forc\u00e9e dans la GPO pour certains comptes, AD peut appliquer <code>PASSWORD_EXPIRED</code> si :</p> </li> <li> <p><code>pwdLastSet + MaxPasswordAge</code> &gt; heure syst\u00e8me (calcul erron\u00e9)</p> </li> <li>ou si le DC consid\u00e8re que le compte n'a jamais eu son mot de passe d\u00e9fini correctement (corruption partielle NTDS)</li> </ol>"},{"location":"Service%20AD/incidents/#4-consequences","title":"4. Cons\u00e9quences","text":"<ul> <li>Tous les utilisateurs apparaissent comme ayant un mot de passe expir\u00e9.</li> <li>Proxmox renvoie des erreurs LDAP 532.</li> </ul>"},{"location":"Service%20AD/incidents/#5-solution-appliquee","title":"5. Solution appliqu\u00e9e","text":"<ol> <li>R\u00e9initialiser les mots de passe expir\u00e9s pour tous les utilisateurs du domaine (sauf DSI) :</li> </ol> <pre><code>$ExcludeUsers = @(\"wassim.dsi\",\"simon.dsi\",\"david.dsi\")\n$TempPassword = \"TempP@ssword123!\"\nGet-ADUser -Filter * -SearchBase \"DC=cha,DC=chartres,DC=sportludique,DC=fr\" | Where-Object {\n    $ExcludeUsers -notcontains $_.SamAccountName\n} | ForEach-Object {\n    Set-ADAccountPassword -Identity $_.DistinguishedName -Reset -NewPassword (ConvertTo-SecureString $TempPassword -AsPlainText -Force)\n    Set-ADUser -Identity $_.DistinguishedName -ChangePasswordAtLogon $true\n}\n</code></pre> <ol> <li>V\u00e9rifier les utilisateurs avec mots de passe expir\u00e9s :</li> </ol> <pre><code>Search-ADAccount -PasswordExpired | Select-Object Name, SamAccountName, DistinguishedName\n</code></pre> <ol> <li> <p>Pour \u00e9viter que le probl\u00e8me se reproduise :</p> </li> <li> <p>D\u00e9sactiver l'expiration globale si souhait\u00e9 : <code>MaximumPasswordAge = 0</code> dans la GPO <code>Default Domain Policy</code>.</p> </li> <li>Ou mettre des comptes sp\u00e9cifiques comme \"Password never expires\".</li> </ol> <pre><code>PS C:\\WINDOWS\\system32&gt; Get-ADUser -Filter * | Where-Object {$Exclude -notcontains $_.SamAccountName} | Set-ADUser -PasswordNeverExpires $true\n</code></pre>"},{"location":"Service%20AD/incidents/#6-recommandations","title":"6. Recommandations","text":"<ul> <li>Surveiller la synchronisation horaire des DC (<code>w32tm /query /status</code>).</li> <li>V\u00e9rifier r\u00e9guli\u00e8rement l'\u00e9tat des journaux NTDS apr\u00e8s red\u00e9marrage brutal.</li> <li>Maintenir des scripts pour r\u00e9initialiser les mots de passe expir\u00e9s rapidement apr\u00e8s un incident.</li> <li>Pour les comptes critiques (Proxmox, service admin), utiliser \"Password never expires\" pour \u00e9viter les blocages inattendus.</li> </ul>"},{"location":"Service%20AD/incidents/#7-references-microsoft","title":"7. R\u00e9f\u00e9rences Microsoft","text":"<ul> <li>Search-ADAccount</li> <li>Get-ADUser</li> <li>GPO Password Policy</li> <li>Troubleshoot password expiration</li> </ul>"},{"location":"Service%20AD/liaison-prox-ad/","title":"Mise en place liaison LDAP entre Proxmox &amp; AD.","text":""},{"location":"Service%20AD/liaison-prox-ad/#objectif","title":"Objectif :","text":"<ol> <li>Cr\u00e9er un utilisateur et un groupe d\u2019administration Proxmox dans Active Directory (AD).  </li> <li>Int\u00e9grer le domaine Active Directory dans Proxmox VE pour l\u2019authentification centralis\u00e9e.  </li> <li>Configurer les permissions dans Proxmox.  </li> <li>G\u00e9rer le mode d\u2019authentification LDAP / LDAPS.</li> </ol>"},{"location":"Service%20AD/liaison-prox-ad/#2-creation-des-utilisateurs-et-groupes-ad","title":"2. Cr\u00e9ation des utilisateurs et groupes AD","text":""},{"location":"Service%20AD/liaison-prox-ad/#21-description","title":"2.1 Description","text":"<p>Le script PowerShell suivant permet de :</p> <ul> <li>Cr\u00e9er l\u2019OU <code>UserServices</code> si elle n\u2019existe pas.</li> <li>Cr\u00e9er l\u2019utilisateur <code>proxmox.admin</code>.</li> <li>Cr\u00e9er le groupe <code>G_Proxmox_Admins</code>.</li> <li>Ajouter l\u2019utilisateur au groupe.</li> <li>V\u00e9rifier la cr\u00e9ation et l\u2019appartenance.</li> </ul>"},{"location":"Service%20AD/liaison-prox-ad/#22-script-powershell","title":"2.2 Script PowerShell","text":"<pre><code>Import-Module ActiveDirectory\n\n# ============================\n# 1. Variables g\u00e9n\u00e9rales\n# ============================\n$Domaine = \"cha.chartres.sportludique.fr\"\n$OUPath = \"OU=UserServices,DC=cha,DC=chartres,DC=sportludique,DC=fr\"\n$NomUtilisateur = \"proxmox.admin\"\n$NomComplet = \"proxmox\"\n$MotDePasse = ConvertTo-SecureString \"CHAPVE2526!\" -AsPlainText -Force\n$NomGroupe = \"G_Proxmox_Admins\"\n\n# ============================\n# 2. V\u00e9rification / Cr\u00e9ation de l'OU\n# ============================\nif (-not (Get-ADOrganizationalUnit -Filter \"Name -eq 'UserServices'\" -ErrorAction SilentlyContinue)) {\n    Write-Host \"\ud83d\udcc1 Cr\u00e9ation de l'OU 'UserServices'...\"\n    New-ADOrganizationalUnit -Name \"UserServices\" -Path \"DC=cha,DC=chartres,DC=sportludique,DC=fr\"\n} else {\n    Write-Host \"\u2705 L'OU 'UserServices' existe d\u00e9j\u00e0.\"\n}\n\n# ============================\n# 3. Cr\u00e9ation de l'utilisateur Proxmox\n# ============================\nif (-not (Get-ADUser -Filter \"SamAccountName -eq '$NomUtilisateur'\" -ErrorAction SilentlyContinue)) {\n    Write-Host \"\ud83d\udc64 Cr\u00e9ation de l'utilisateur '$NomUtilisateur'...\"\n    New-ADUser `\n        -Name $NomComplet `\n        -GivenName \"Proxmox\" `\n        -Surname \"Admin\" `\n        -SamAccountName $NomUtilisateur `\n        -UserPrincipalName \"$NomUtilisateur@$Domaine\" `\n        -Path $OUPath `\n        -AccountPassword $MotDePasse `\n        -Enabled $true `\n        -ChangePasswordAtLogon $false `\n        -PasswordNeverExpires $true `\n        -Description \"Compte d'administration Proxmox li\u00e9 \u00e0 l'AD\" `\n        -Title \"Service Infrastructure\"\n    Write-Host \"\u2705 Utilisateur '$NomUtilisateur' cr\u00e9\u00e9 avec succ\u00e8s.\"\n} else {\n    Write-Host \"\u2139\ufe0f L'utilisateur '$NomUtilisateur' existe d\u00e9j\u00e0, aucune action n\u00e9cessaire.\"\n}\n\n# ============================\n# 4. Cr\u00e9ation du groupe G_Proxmox_Admins\n# ============================\nif (-not (Get-ADGroup -Filter \"Name -eq '$NomGroupe'\" -ErrorAction SilentlyContinue)) {\n    Write-Host \"\ud83d\udc65 Cr\u00e9ation du groupe '$NomGroupe'...\"\n    New-ADGroup `\n        -Name $NomGroupe `\n        -GroupScope Global `\n        -GroupCategory Security `\n        -Path $OUPath `\n        -Description \"Groupe des administrateurs Proxmox\"\n    Write-Host \"\u2705 Groupe '$NomGroupe' cr\u00e9\u00e9 avec succ\u00e8s.\"\n} else {\ud83d\udda5\ufe0f \u00c9tape 2 \u2014 Int\u00e9gration du domaine AD dans Proxmox\n1\ufe0f\u20e3 Cr\u00e9ation du Realm (Royaume)\n\nChemin d\u2019acc\u00e8s :\nDatacenter \u2192 Permissions \u2192 Realms \u2192 Add \u2192 Active Directory\nChamp   Valeur\nRealm   ad\nDefault Domain  cha.chartres.sportludique.fr\nPort    389 (par d\u00e9faut)\nMode    LDAP (par d\u00e9faut)\nServer1 / Server2   10.10.120.2 et 10.10.120.3\nCommentaire Authentification AD\n    Write-Host \"\u2705 Le groupe '$NomGroupe' existe d\u00e9j\u00e0.\"\n}\n\n# ============================\n# 5. Ajout de l'utilisateur au groupe\n# ============================\nif (-not (Get-ADGroupMember -Identity $NomGroupe | Where-Object {$_.SamAccountName -eq $NomUtilisateur})) {\n    Write-Host \"\u2795 Ajout de l'utilisateur '$NomUtilisateur' au groupe '$NomGroupe'...\"\n    Add-ADGroupMember -Identity $NomGroupe -Members $NomUtilisateur\n    Write-Host \"\u2705 Utilisateur ajout\u00e9 au groupe avec succ\u00e8s.\"\n} else {\n    Write-Host \"\u2139\ufe0f L'utilisateur '$NomUtilisateur' est d\u00e9j\u00e0 membre du groupe '$NomGroupe'.\"\n}\n\n# ============================\n# 6. V\u00e9rification finale\n# ============================\nWrite-Host \"`n\ud83c\udfaf V\u00e9rification finale :\"\nGet-ADUser -Identity $NomUtilisateur -Properties Name,SamAccountName,DistinguishedName,PasswordNeverExpires | \nSelect-Object Name, SamAccountName, DistinguishedName, PasswordNeverExpires\n\nGet-ADGroupMember -Identity $NomGroupe | \nSelect-Object Name, SamAccountName\n\nWrite-Host \"`n\u2705 Script ex\u00e9cut\u00e9 avec succ\u00e8s.\"\n</code></pre>"},{"location":"Service%20AD/liaison-prox-ad/#2-integration-du-domaine-ad-dans-proxmox","title":"2. Int\u00e9gration du domaine AD dans Proxmox","text":""},{"location":"Service%20AD/liaison-prox-ad/#22-creation-du-realm-royaume","title":"2.2 Cr\u00e9ation du Realm (Royaume)","text":"<p>Chemin d\u2019acc\u00e8s :</p> <pre><code>Datacenter \u2192 Permissions \u2192 Realms \u2192 Add \u2192 Active Directory\n</code></pre> Champ Valeur Realm ad Default Domain cha.chartres.sportludique.fr Port 389 (par d\u00e9faut) Mode LDAP (par d\u00e9faut) Server1 / Server2 10.10.120.2 et 10.10.120.3 Commentaire Authentification AD"},{"location":"Service%20AD/liaison-prox-ad/#23-creation-de-lutilisateur-proxmox-dans-linterface","title":"2.3 Cr\u00e9ation de l\u2019utilisateur Proxmox dans l\u2019interface","text":"<p>Chemin d\u2019acc\u00e8s :</p> <pre><code>Datacenter \u2192 Permissions \u2192 Utilisateurs \u2192 Add\n</code></pre> Champ Valeur Nom utilisateur proxmox.admin Royaume Authentification AD Appliquer la GPO puis forcer la mise \u00e0 jour :"},{"location":"Service%20AD/liaison-prox-ad/#24-attribution-des-permissiation-ldap-ldaps","title":"2.4 Attribution des permissiation LDAP / LDAPS.","text":"<p>Chemin d\u2019acc\u00e8s :</p> <pre><code>Datacenter \u2192 Permissions \u2192 Add \u2192 Permissions de l'utilisateur\n</code></pre> Champ Valeur Chemin d'acc\u00e8s <code>/</code> (acc\u00e8s total) Utilisateur proxmox.admin@ad R\u00f4le Administrator Propager \u2705 Activ\u00e9 <p>\ud83d\udca1 Note : Le mode LDAP est temporaire. Une migration vers LDAPS sera effectu\u00e9e pour s\u00e9curiser les \u00e9changes. Nous activerons ici LDAP \u00e0 des fins de test uniquement, penser \u00e0 remettre la configuration par d\u00e9faut que nous allons modifier ci-dessous une fois le test termin\u00e9 !</p>"},{"location":"Service%20AD/liaison-prox-ad/#3-gestion-du-protocole-ldap-ldaps","title":"3. Gestion du protocole LDAP / LDAPS","text":"<p>Appliquer la GPO puis forcer la mise \u00e0 jour : \u26a0\ufe0f Probl\u00e9matique</p> <p>Depuis Windows Server 2019 (patch 2020) et renforc\u00e9 dans Windows Server 2022 / 2025, les connexions LDAP simples non chiffr\u00e9es (port 389) sont d\u00e9sormais bloqu\u00e9es ou limit\u00e9es.</p> <p>Erreur typique :</p> <pre><code>can't contact LDAP server\n</code></pre> <p>Raison : Les identifiants sont envoy\u00e9s en clair sur le r\u00e9seau.</p> <p>Recommandation : Utiliser LDAPS (port 636) pour chiffrer les \u00e9changes entre Proxmox et Active Directory.</p> <p>\ud83d\udca1 Note : Le mode LDAP est temporaire. Une migration vers LDAPS sera effectu\u00e9e pour s\u00e9curiser les \u00e9changes.  Voici la configuration du LADPS qui a \u00e9t\u00e9 r\u00e9alis\u00e9 : Tuto LDAPS</p> <p>M\u00e9thode : via la Strat\u00e9gie de groupe (GPO)</p> <ul> <li>Ouvrir la console de gestion des strat\u00e9gies de groupe (GPMC).</li> <li>\u00c9diter la GPO appliqu\u00e9e aux contr\u00f4leurs de domaine : <code>default domain policy</code> \u2192 Clique droit \u2192 Modifier.</li> </ul> <p>Naviguer vers :</p> <pre><code>Configuration ordinateur\n   \u2192 Strat\u00e9gies\n      \u2192 Param\u00e8tres Windows\n         \u2192 Param\u00e8tres de s\u00e9curit\u00e9\n            \u2192 Strat\u00e9gies locales\n               \u2192 Options de s\u00e9curit\u00e9\n</code></pre> <p>Modifier les param\u00e8tres suivants :</p> Param\u00e8tre Valeur Contr\u00f4leur de domaine : conditions requises pour la signature de serveur LDAP Aucun Contr\u00f4leur de domaine : application des conditions requises pour la signature de serveur LDAP D\u00e9sactiv\u00e9 Contr\u00f4leur de domaine : configuration requise pour le jeton de liaison du canal du serveur LDAP Lorsqu\u2019il est pris en charge <p>Appliquer la GPO puis forcer la mise \u00e0 jour :</p> <pre><code>gpupdate /force\n</code></pre>"},{"location":"Service%20AD/servfichier/","title":"Installation et configuration d\u2019un serveur de fichiers sur Windows Server","text":""},{"location":"Service%20AD/servfichier/#1-introduction","title":"1. Introduction","text":"<p>Un serveur de fichiers permet de centraliser, partager et s\u00e9curiser l\u2019acc\u00e8s aux donn\u00e9es dans une infrastructure r\u00e9seau. C\u2019est l\u2019un des r\u00f4les les plus courants et utiles sur un serveur Windows. </p> <p>Dans cet article, nous allons voir comment installer et configurer un serveur de fichiers sur Windows Server, avec une explication des diff\u00e9rentes options disponibles pour adapter la configuration \u00e0 vos besoins.</p>"},{"location":"Service%20AD/servfichier/#2-prerequis","title":"2. Pr\u00e9requis","text":"<p>Un Windows Server install\u00e9 (et de pr\u00e9f\u00e9rence rejoint \u00e0 un domaine). Un disque ou volume disponible pour le stockage des donn\u00e9es. Une connexion \u00e0 l\u2019interface d\u2019administration(Gestionnaire de serveur).</p> <p>A) Installer le r\u00f4le \u00ab Serveur de fichiers \u00bb B) Ouvrir le Gestionnaire de serveur. C) Cliquer sur G\u00e9rer, puis sur Ajouter des r\u00f4les et fonctionnalit\u00e9s :</p> <p></p> <p>Dans l\u2019assistant, s\u00e9lectionner Installation bas\u00e9e sur un r\u00f4le ou une fonctionnalit\u00e9 :</p> <p></p> <p>Choisir votre serveur dans la liste propos\u00e9e :</p> <p></p> <p>Dans la section des r\u00f4les, cocher Services de fichiers et de stockage, puis Services de fichiers et iSCSI puis cochez Serveur de fichiers dans les sous-r\u00f4les propos\u00e9s :</p> <p></p> <p>Pour une configuration standard, le Serveur de fichiers suffit. Passez \u00e0 la section Confirmation et cliquez sur Installer pour lancer l\u2019installation. Vous pouvez ensuite cliquer sur Installer :</p> <p></p> <p>Finaliser l\u2019installation en suivant l\u2019assistant jusqu\u2019au bout :</p> <p></p> <ol> <li>Cr\u00e9er un dossier partag\u00e9</li> </ol> <p>Ouvrir l\u2019outil Gestionnaire de serveur, puis aller dans Services de fichiers et de stockage &gt; Partages :</p> <p></p> <p>Cliquer sur T\u00e2ches, puis s\u00e9lectionner Nouveau partage :</p> <p></p> <p>Choisir le type de partage selon le besoin : SMB \u2013 Partage rapide pour un usage courant, ou SMB \u2013 Avanc\u00e9 pour configurer plus en d\u00e9tail les autorisations :</p> <p></p> <p>S\u00e9lectionner le serveur et le disque sur lequel sera cr\u00e9\u00e9 le dossier \u00e0 partager, ou en cr\u00e9er un nouveau via l\u2019interface :</p> <p></p> <p>D\u00e9finir les param\u00e8tres comme le nom du partage, le chemin d\u2019acc\u00e8s :</p> <p></p> <p>Configurer les autorisations d\u2019acc\u00e8s selon les besoins (voir section suivante pour les d\u00e9tails) :</p> <p></p>"},{"location":"Services/bdd/","title":"Base De Donn\u00e9es","text":""},{"location":"Services/bdd/#1-installation","title":"1. Installation","text":"<p>Pour commencer, mettez \u00e0 jour votre syst\u00e8me : <pre><code>sudo apt update\nsudo apt full-upgrade\n</code></pre> Installez le service MariaDB : <pre><code>sudo apt install mariadb-server mariadb-client \n</code></pre> V\u00e9rifiez que le service est actif :  <pre><code>sytemctl status mariadb\n</code></pre></p> <p>Si le service n'es pas actif (1)</p> <ol> <li><code>systemctl enable mariadb  systemctl start mariadb</code></li> </ol>"},{"location":"Services/bdd/#2-securisation-basique","title":"2. S\u00e9curisation basique","text":"<p>Nous allons s\u00e9curiser l'acces a la base de donn\u00e9e gr\u00e2ce aux syst\u00e8me int\u00e9gr\u00e9es a mariaDB <pre><code>sudo mysql_secure_installation \n    NOTE: RUNNING ALL PARTS OF THIS SCRIPT IS RECOMMENDED FOR ALL MariaDB SERVERS IN PRODUCTION USE! PLEASE READ EACH STEP CAREFULLYI\n\nIn order to log into MariaDB to secure it, we'll need the current password for the root user. If you've just installed MariaDB, and haven't set the root password yet, you should just press enter here,\n\nEnter current password for root (enter for none):\n</code></pre> Choisiez si vous voulez changer le socket d'authentification pour unix : <pre><code>Enter current password for root (enter for none); OK, successfully used password, moving on.\n\nSetting the root password or using the unix_socket ensures that nobody can log into the MariaDB root user without the proper authorisation,\n\nYou already have your root account protected, so you can safely answer\n\nSwitch to unix socket authentication [Y/n] : n\n</code></pre></p> <p>Info (1)</p> <ol> <li>Dans notre cas, comme indiqu\u00e9 sur la ligne de commande, le compte root est d\u00e9ja s\u00e9curis\u00e9, nul besoin d'activer ce socket d'authentification</li> </ol> <p>Changer le mot de passe root si besoin :  <pre><code>you already have your root account protected, so you can safely answer 'n'\n\nChange the root password? [Y/n]: n\n</code></pre></p> <p>Suprimmer les utilisateurs anonymes : </p> <pre><code>By default, a MariaDB installation has an anonymous user, allowing anyone to log into MariaDB without having to have a user account created for them. This is intended only for testing, and to make the installation go a bit smoother. You should remove them before moving into a\n\nproduction environment.\n\nRemove anonymous users? [Y/n]: y\n</code></pre> <p>D\u00e9sactivez le login a distance via le compte root si besoin (1)</p> <ol> <li>Dans notre cas, tout les acc\u00e8s se feront via SSH donc nous laisserons l'option active</li> </ol> <p>Suprimez la base de donn\u00e9e test : </p> <pre><code>By default, MariaDB comes with a database named 'test' that anyone can access, This is also intended only for testing, and should be removed before moving into a production environment,\n\nRemove test database and access to it? [Y/n] y\n</code></pre> <p>Pour finir, metez la table des privileges a jour pour appliquer vos modifications :  <pre><code>Reloading the privilege tables will ensure that all changes made so far will take effect immediately,\n\nReload privilege tables now? [Y/n] y ... Success!\n\nCleaning up...\n\nAll done! If you've completed all of the above steps, your MariaDB installation should now be secure.\n\nThanks for using MariaDBI bdd@CHA-BDD:\"$\n</code></pre></p>"},{"location":"Services/https/","title":"Mise en place HTTPS avec CA interne","text":""},{"location":"Services/https/#objectif","title":"Objectif :","text":"<p>Mettre en place un site web s\u00e9curis\u00e9 avec Apache2 utilisant une autorit\u00e9 de certification interne (CA) sur Ubuntu Server 22.04. Le domaine utilis\u00e9 est : www.chartres.sportludique.fr La localit\u00e9 : Chartres L'organisation : SportLudique</p>"},{"location":"Services/https/#serveurs-utilises","title":"Serveurs utilis\u00e9s :","text":"<ol> <li>CHA-CA  : VM Ubuntu Server 22.04 (Autorit\u00e9 de certification)</li> <li>CHA-WEB : VM Ubuntu Server 22.04 (Serveur Apache2)</li> </ol>"},{"location":"Services/https/#1-preparation-des-serveurs","title":"1. Pr\u00e9paration des serveurs","text":"<p>Sur CHA-CA et CHA-WEB : <pre><code>sudo apt update &amp;&amp; sudo apt upgrade -y\n</code></pre></p> <p>Sur CHA-WEB uniquement, installer Apache2 et modules SSL : <pre><code>sudo apt install apache2 -y\nsudo a2enmod ssl\nsudo a2enmod rewrite\nsudo systemctl restart apache2\n</code></pre></p>"},{"location":"Services/https/#2-creation-de-lautorite-de-certification-ca-interne","title":"2. Cr\u00e9ation de l'autorit\u00e9 de certification (CA interne)","text":"<p>Sur CHA-CA uniquement :</p>"},{"location":"Services/https/#21-creer-la-structure-de-la-ca-dans-etcsslca","title":"2.1 Cr\u00e9er la structure de la CA dans /etc/ssl/ca","text":"<pre><code>sudo mkdir -p /etc/ssl/ca/{certs,crl,newcerts,private}\nsudo chmod 700 /etc/ssl/ca/private\nsudo touch /etc/ssl/ca/index.txt\necho 1000 | sudo tee /etc/ssl/ca/serial\n</code></pre>"},{"location":"Services/https/#22-generation-de-la-cle-privee-de-la-ca","title":"2.2 G\u00e9n\u00e9ration de la cl\u00e9 priv\u00e9e de la CA","text":"<pre><code>sudo openssl genrsa -out /etc/ssl/ca/private/ca.key.pem 4096\nsudo chmod 400 /etc/ssl/ca/private/ca.key.pem\n</code></pre>"},{"location":"Services/https/#objectif_1","title":"Objectif :","text":""},{"location":"Services/https/#23-creation-du-certificat-racine-auto-signe","title":"2.3 Cr\u00e9ation du certificat racine auto-sign\u00e9","text":"<pre><code>sudo openssl req -x509 -new -nodes \\\n  -key /etc/ssl/ca/private/ca.key.pem \\\n  -sha256 -days 3650 \\\n  -out /etc/ssl/ca/certs/ca.cert.pem \\\n  -subj \"/C=FR/ST=Centre-Val de Loire/L=Chartres/O=SportLudique/CN=CA-CHARTRES\"\n\nsudo chmod 444 /etc/ssl/ca/certs/ca.cert.pem\n</code></pre>"},{"location":"Services/https/#3-creation-du-certificat-serveur-web","title":"3. Cr\u00e9ation du certificat serveur web","text":"<p>Sur CHA-WEB uniquement :</p>"},{"location":"Services/https/#31-preparer-le-repertoire-pour-les-certificats","title":"3.1 Pr\u00e9parer le r\u00e9pertoire pour les certificats","text":"<pre><code>sudo mkdir -p /etc/ssl/localcerts\n</code></pre>"},{"location":"Services/https/#32-generation-de-la-cle-privee-du-serveur-web","title":"3.2 G\u00e9n\u00e9ration de la cl\u00e9 priv\u00e9e du serveur web","text":"<pre><code>sudo openssl genrsa -out /etc/ssl/localcerts/www.chartres.sportludique.fr.key.pem 2048\nsudo chmod 400 /etc/ssl/localcerts/www.chartres.sportludique.fr.key.pem\n</code></pre>"},{"location":"Services/https/#33-generation-de-la-csr-certificate-signing-request","title":"3.3 G\u00e9n\u00e9ration de la CSR (Certificate Signing Request)","text":"<pre><code>sudo openssl req -new \\\n  -key /etc/ssl/localcerts/www.chartres.sportludique.fr.key.pem \\\n  -out /etc/ssl/localcerts/www.chartres.sportludique.fr.csr.pem \\\n  -subj \"/C=FR/ST=Centre-Val de Loire/L=Chartres/O=SportLudique/CN=www.chartres.sportludique.fr\"\n</code></pre>"},{"location":"Services/https/#34-transfert-de-la-csr-vers-la-ca","title":"3.4 Transfert de la CSR vers la CA","text":"<pre><code>scp /etc/ssl/localcerts/www.chartres.sportludique.fr.csr.pem \\\n    certificat@IP_CHA-CA:/tmp/\n</code></pre>"},{"location":"Services/https/#4-signature-du-certificat-cote-ca","title":"4. Signature du certificat c\u00f4t\u00e9 CA","text":"<p>Sur CHA-CA uniquement :</p>"},{"location":"Services/https/#objectif_2","title":"Objectif :","text":""},{"location":"Services/https/#41-copier-la-csr-dans-le-dossier-ca","title":"4.1 Copier la CSR dans le dossier CA","text":"<p>sudo mv /tmp/www.chartres.sportludique.fr.csr.pem /etc/ssl/ca/</p>"},{"location":"Services/https/#42-creation-du-fichier-dextension-san-pour-le-serveur","title":"4.2 Cr\u00e9ation du fichier d\u2019extension SAN pour le serveur","text":"<pre><code>sudo nano /etc/ssl/ca/www.chartres.sportludique.fr.ext\n\nContenu :\n[ v3_req ]\nbasicConstraints = CA:FALSE\nkeyUsage = nonRepudiation, digitalSignature, keyEncipherment\nsubjectAltName = @alt_names\n\n[ alt_names ]\nDNS.1 = www.chartres.sportludique.fr\nDNS.2 = chartres.sportludique.fr\n</code></pre>"},{"location":"Services/https/#43-signature-du-certificat-serveur","title":"4.3 Signature du certificat serveur","text":"<pre><code>sudo openssl x509 -req \\\n  -in /etc/ssl/ca/www.chartres.sportludique.fr.csr.pem \\\n  -CA /etc/ssl/ca/certs/ca.cert.pem \\\n  -CAkey /etc/ssl/ca/private/ca.key.pem \\\n  -CAcreateserial \\\n  -out /etc/ssl/ca/certs/www.chartres.sportludique.fr.cert.pem \\\n  -days 825 -sha256 \\\n  -extfile /etc/ssl/ca/www.chartres.sportludique.fr.ext\n</code></pre>"},{"location":"Services/https/#44-transfert-des-certificats-vers-cha-web","title":"4.4 Transfert des certificats vers CHA-WEB","text":"<pre><code>scp /etc/ssl/ca/certs/www.chartres.sportludique.fr.cert.pem \\\n    user@CHA-WEB:/etc/ssl/localcerts/\nscp /etc/ssl/ca/certs/ca.cert.pem \\\n    user@CHA-WEB:/etc/ssl/localcerts/\n</code></pre>"},{"location":"Services/https/#5-configuration-apache-sur-cha-web","title":"5. Configuration Apache sur CHA-WEB","text":""},{"location":"Services/https/#51-creation-du-virtualhost","title":"5.1 Cr\u00e9ation du VirtualHost","text":"<pre><code>sudo nano /etc/apache2/sites-available/www.chartres.sportludique.fr.conf\n</code></pre> <pre><code>&lt;VirtualHost *:80&gt;\n    ServerName www.chartres.sportludique.fr\n    ServerAlias chartres.sportludique.fr\n    Redirect permanent / https://www.chartres.sportludique.fr/\n&lt;/VirtualHost&gt;\n\n&lt;VirtualHost *:443&gt;\n    ServerName www.chartres.sportludique.fr\n    DocumentRoot /var/www/www.chartres.sportludique.fr\n\n    SSLEngine on\n    SSLCertificateFile /etc/ssl/localcerts/www.chartres.sportludique.fr.cert.pem\n    SSLCertificateKeyFile /etc/ssl/localcerts/www.chartres.sportludique.fr.key.pem\n    SSLCACertificateFile /etc/ssl/localcerts/ca.cert.pem\n\n    &lt;Directory /var/www/www.chartres.sportludique.fr&gt;\n        Options Indexes FollowSymLinks\n        AllowOverride All\n        Require all granted\n    &lt;/Directory&gt;\n\n    ErrorLog ${APACHE_LOG_DIR}/www-chartres-error.log\n    CustomLog ${APACHE_LOG_DIR}/www-chartres-access.log combined\n&lt;/VirtualHost&gt;\n</code></pre>"},{"location":"Services/https/#52-organisation-du-site-web","title":"5.2 Organisation du site web","text":"<pre><code>sudo mkdir -p /var/www/www.chartres.sportludique.fr\nsudo nano /var/www/www.chartres.sportludique.fr/index.html\nsudo chown -R www-data:www-data /var/www/www.chartres.sportludique.fr\nsudo chmod -R 755 /var/www/www.chartres.sportludique.fr\n</code></pre>"},{"location":"Services/https/#53-activation-du-site-et-verification","title":"5.3 Activation du site et v\u00e9rification","text":"<pre><code>sudo a2ensite www.chartres.sportludique.fr.conf\nsudo a2dissite 000-default.conf\nsudo apachectl configtest\nSyntax OK \u2192 relancer Apache\nsudo systemctl restart apache2\n</code></pre>"},{"location":"Services/https/#6-test-du-certificat-ssl","title":"6. Test du certificat SSL","text":"<pre><code>curl -Iv https://www.chartres.sportludique.fr --cacert /etc/ssl/localcerts/ca.cert.pem\n</code></pre> <p>R\u00e9sultat attendu : <pre><code>SSL certificate verify ok.\nHTTP/1.1 200 OK\n</code></pre></p>"},{"location":"Services/https/#7-astuce-redirection-automatique-http-https","title":"7. Astuce : Redirection automatique HTTP \u2192 HTTPS","text":"<p>D\u00e9j\u00e0 incluse dans le VirtualHost *:80 avec la ligne : Redirect permanent / https://www.chartres.sportludique.fr/</p>"},{"location":"Services/https/#8-verification-san-subject-alternative-name","title":"8. V\u00e9rification SAN (Subject Alternative Name)","text":"<pre><code>openssl x509 -in /etc/ssl/localcerts/www.chartres.sportludique.fr.cert.pem \\\n    -noout -text | grep -A2 \"Subject Alternative Name\"\n</code></pre> <p>Si le SAN ne s\u2019affiche pas : - V\u00e9rifier le fichier d\u2019extension : <code>www.chartres.sportludique.fr.ext</code> - Reg\u00e9n\u00e9rer le certificat avec l\u2019option : <code>-extfile</code></p>"},{"location":"Services/https/#9-deploiement-sur-client","title":"9. D\u00e9ploiement sur client","text":"<ul> <li>Copier le certificat CA <code>ca.cert.pem</code> sur le poste client</li> <li>L\u2019ajouter comme certificat de confiance pour supprimer l\u2019avertissement navigateur</li> <li>Exemple Linux :  sudo cp ca.cert.pem /usr/local/share/ca-certificates/mon-ca.crt sudo update-ca-certificates</li> </ul>"},{"location":"Services/https/#10-gestion-des-certificats-et-suppression","title":"10. Gestion des certificats et suppression","text":"<p>Pour repartir proprement sur CHA-CA ou CHA-WEB : <code>sudo rm -rf /etc/ssl/ca /etc/ssl/localcerts sudo mkdir -p /etc/ssl/ca /etc/ssl/localcerts</code></p>"},{"location":"Services/wordpress/","title":"Installation de WordPress sur Debian avec serveur MySQL distant","text":""},{"location":"Services/wordpress/#objectif","title":"Objectif :","text":"<p>WordPress est un syst\u00e8me de gestion de contenu (CMS) open source, bas\u00e9 sur PHP et MySQL/MariaDB. Il est con\u00e7u pour permettre aux utilisateurs de cr\u00e9er, g\u00e9rer et publier des sites web dynamiques \u00e0 l'aide de templates sans n\u00e9cessiter de programmation manuelle.</p>"},{"location":"Services/wordpress/#1-prerequis-sur-le-serveur-web-17228623","title":"1. Pr\u00e9requis sur le serveur web (172.28.62.3)","text":"<p>Installer Apache, PHP et extensions n\u00e9cessaires :</p> <pre><code>sudo apt update\nsudo apt install apache2 php php-mysql libapache2-mod-php php-cli php-curl php-xml php-mbstring unzip wget -y\n</code></pre>"},{"location":"Services/wordpress/#2-telecharger-et-placer-wordpress","title":"2. T\u00e9l\u00e9charger et placer WordPress","text":"<pre><code>cd /var/www/\nsudo wget https://wordpress.org/latest.zip\nsudo unzip latest.zip\nsudo mv wordpress /var/www/html/\n</code></pre>"},{"location":"Services/wordpress/#3-configurer-les-droits","title":"3. Configurer les droits","text":"<pre><code>sudo chown -R www-data:www-data /var/www/html/wordpress\nsudo chmod -R 755 /var/www/html/wordpress\n</code></pre>"},{"location":"Services/wordpress/#4-creer-la-base-de-donnees-mysql-1921682810","title":"4. Cr\u00e9er la base de donn\u00e9es MySQL (192.168.28.10)","text":"<p>Se connecter \u00e0 MySQL :</p> <pre><code>mysql -u wp_user -p -h 192.168.28.10 --ssl=0\n</code></pre> <p>Puis cr\u00e9er la BDD et l'utilisateur :</p> <pre><code>CREATE DATABASE wordpress DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;\nCREATE USER 'wp_user'@'192.168.28.10' IDENTIFIED BY 'mot_de_passe_fort';\nGRANT ALL PRIVILEGES ON wordpress.* TO 'wp_user'@'192.168.28.10';\nFLUSH PRIVILEGES;\nEXIT;\n</code></pre> <p>Modifier le fichier MySQL pour autoriser les connexions distantes :</p> <ul> <li>\u00c9diter <code>/etc/mysql/mariadb.conf.d/50-server.cnf</code> et modifier <code>bind-address = 127.0.0.1</code> et mettre <code>bind-address = 192.168.28.10</code> (adresse de la BDD)</li> <li>Red\u00e9marrer MySQL : <code>sudo systemctl restart mysql</code></li> </ul>"},{"location":"Services/wordpress/#5-configurer-wordpress","title":"5. Configurer WordPress","text":"<pre><code>cd /var/www/html/wordpress\nsudo cp wp-config-sample.php wp-config.php\nsudo nano /var/www/html/wordpress/wp-config.php\n</code></pre> <p>Modifier :</p> <pre><code>define( 'DB_NAME', 'wordpress_db' );\ndefine( 'DB_USER', 'wp_user' );\ndefine( 'DB_PASSWORD', 'mot_de_passe_fort' );\ndefine( 'DB_HOST', '192.168.28.10' );\n</code></pre>"},{"location":"Services/wordpress/#6-configurer-apache","title":"6. Configurer Apache","text":"<p>Cr\u00e9er un VirtualHost :</p> <pre><code>sudo nano /etc/apache2/sites-available/wordpress.conf\n</code></pre> <p>Exemple de configuration :</p> <pre><code>&lt;VirtualHost *:80&gt;\n    ServerAdmin admin@172.28.62.3\n    DocumentRoot /var/www/html/wordpress\n    ServerName 172.28.62.3\n\n    &lt;Directory /var/www/html/wordpress&gt;\n        AllowOverride All\n        Require all granted\n    &lt;/Directory&gt;\n\n    ErrorLog ${APACHE_LOG_DIR}/wordpress_error.log\n    CustomLog ${APACHE_LOG_DIR}/wordpress_access.log combined\n&lt;/VirtualHost&gt;\n</code></pre> <p>Activer le site et le module rewrite, d\u00e9sactiver le site par d\u00e9faut :</p> <pre><code>sudo a2ensite wordpress.conf\nsudo a2enmod rewrite\nsudo a2dissite 000-default.conf\nsudo systemctl reload apache2\n</code></pre>"},{"location":"Services/wordpress/#7-installer-lextension-mysql-pour-php","title":"7. Installer l\u2019extension MySQL pour PHP","text":"<p>/var/www/html/wordpress Si page blanche avec message \"Your PHP installation appears to be missing the MySQL extension\":</p> <pre><code>sudo apt install php-mysql -y\nsudo systemctl restart apache2\nphp -m | grep mysqli   # v\u00e9rifier que mysqli est actif\n</code></pre>"},{"location":"Services/wordpress/#8-activer-laffichage-des-erreurs-php-pour-debug","title":"8. Activer l\u2019affichage des erreurs PHP (pour debug)","text":"<p>\u00c9diter le fichier php.ini :</p> <pre><code>sudo nano /etc/php/*la version du php*/apache2/php.ini\n</code></pre> <p>Modifier ou ajouter :</p> <pre><code>display_errors = On\n</code></pre> <p>Puis red\u00e9marrer Apache :</p> <pre><code>sudo systemctl restart apache2\n</code></pre>"},{"location":"Services/wordpress/#9-acceder-a-wordpress","title":"9. Acc\u00e9der \u00e0 WordPress","text":"<p>Dans ton navigateur :</p> <pre><code>http://192.168.28.10/\n</code></pre> <p>Tu devrais voir l\u2019\u00e9cran d\u2019installation de WordPress (choix de la langue, cr\u00e9ation compte admin, etc.).</p>"},{"location":"Services/wordpress2/","title":"Configuration du site WordPress &amp; Nom de domaine.","text":"<p>Site WordPress : <code>www.cimmob.chartres.sportludique.fr</code></p>"},{"location":"Services/wordpress2/#1-prerequis","title":"1. Pr\u00e9requis","text":"<ul> <li>Serveur WordPress : <code>172.28.62.3</code></li> <li>Serveur Base de donn\u00e9es : <code>192.168.28.10</code></li> <li>Reverse Proxy : <code>172.28.62.5 (Nginx)</code></li> <li>DNS interne : <code>Bind9 (serveur autorit\u00e9 interne)</code></li> <li>WordPress install\u00e9 dans : <code>/var/www/html/wordpress</code></li> </ul>"},{"location":"Services/wordpress2/#2-configuration-dns-bind9","title":"2. Configuration DNS (Bind9)","text":""},{"location":"Services/wordpress2/#21-zone-interne-chartressportludiquefr","title":"2.1 Zone interne : chartres.sportludique.fr","text":"<ul> <li>Fichier : /etc/bind/zones/db.chartres.sportludique.fr.internal</li> <li> <p>Ajouter les enregistrements : <pre><code>www      IN  A   172.28.62.5\nwww.cimmob   IN  A   172.28.62.5   \n</code></pre></p> </li> <li> <p>V\u00e9rifier la syntaxe : <pre><code>sudo named-checkzone chartres.sportludique.fr /etc/bind/zones/db.chartres.sportludique.fr.internal\n</code></pre></p> </li> <li> <p>Recharger Bind9 : <pre><code>sudo systemctl reload bind9\n</code></pre></p> </li> </ul>"},{"location":"Services/wordpress2/#22-zone-externe-chartressportludiquefr","title":"2.2 Zone externe : chartres.sportludique.fr","text":"<ul> <li>Fichier : /etc/bind/zones/db.chartres.sportludique.fr.external</li> <li> <p>Ajouter les enregistrements : <pre><code>www      IN  A   183.44.28.1; IP de la FAI\nwww.cimmob   IN  A   183.44.28.1   ; IP de la FAI\n</code></pre></p> </li> <li> <p>V\u00e9rifier la syntaxe : <pre><code>sudo named-checkzone chartres.sportludique.fr /etc/bind/zones/db.chartres.sportludique.fr.external\n</code></pre></p> </li> <li> <p>Recharger Bind9 : <pre><code>sudo systemctl reload bind9\n</code></pre></p> </li> </ul>"},{"location":"Services/wordpress2/#3-configuration-reverse-proxy-nginx","title":"3. Configuration Reverse Proxy (Nginx)","text":""},{"location":"Services/wordpress2/#31-site-client-deja-existant","title":"3.1 Site client (d\u00e9j\u00e0 existant)","text":"<ul> <li>Domaine : <code>www.cimmob.chartres.sportludique.fr</code></li> <li>Redirige le trafic vers WordPress</li> </ul>"},{"location":"Services/wordpress2/#32-site-admin","title":"3.2 Site admin","text":"<ul> <li>Fichier : /etc/nginx/sites-available/cimmob.chartres.sportludique.fr </li> <li>Contenu :</li> </ul> <pre><code>server {\n    listen 80;\n    server_name www.cimmob.chartres.sportludique.fr;\n\n    location / {\n        proxy_pass http://172.28.62.3;   \n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n    }\n}\n</code></pre> <ul> <li>Activer le site : <pre><code>sudo ln -s /etc/nginx/sites-available/cimmob.chartres.sportludique.fr  /etc/nginx/sites-enabled/\nsudo nginx -t\nsudo systemctl restart nginx\n</code></pre></li> </ul>"},{"location":"Services/wordpress2/#4-configuration-apache-sur-serveur-wordpress","title":"4. Configuration Apache sur serveur WordPress","text":"<ul> <li>VirtualHost pour WordPress (/etc/apache2/sites-available/cimmob.conf):</li> </ul> <pre><code>&lt;VirtualHost *:80&gt;\n    ServerName www.cimmob.chartres.sportludique.fr\n    ServerAlias www.cimmob.chartres.sportludique.fr\n    DocumentRoot /var/www/html/wordpress\n\n    &lt;Directory /var/www/html/wordpress&gt;\n        AllowOverride All\n        Require all granted\n    &lt;/Directory&gt;\n\n    ErrorLog ${APACHE_LOG_DIR}/cimmob_error.log\n    CustomLog ${APACHE_LOG_DIR}/cimmob_access.log combined\n&lt;/VirtualHost&gt;\n</code></pre> <ul> <li>Red\u00e9marrer Apache: <pre><code>sudo systemctl restart apache2\n</code></pre></li> </ul>"},{"location":"Services/wordpress2/#5-wordpress-configuration-wp-configphp","title":"5. WordPress Configuration (wp-config.php)","text":"<ul> <li>Fichier: /var/www/html/wordpress/wp-config.php</li> <li>V\u00e9rifier les lignes DB :</li> </ul> <pre><code>define( 'DB_NAME', 'wordpress_db' );\ndefine( 'DB_USER', 'wp_user' );\ndefine( 'DB_PASSWORD', 'CHABDD083' );\ndefine( 'DB_HOST', '192.168.28.10' );\n</code></pre>"},{"location":"Services/wordpress2/#6-verifications","title":"6. V\u00e9rifications","text":""},{"location":"Services/wordpress2/#61-depuis-reseau-client","title":"6.1 Depuis r\u00e9seau client :","text":"<ul> <li>URL : <code>http://www.cimmob.chartres.sportludique.fr</code></li> <li>R\u00e9sultat: site accessible via reverse proxy</li> </ul>"},{"location":"Services/wordpress3/","title":"Mise en place du Multi Site sur WordPress.","text":"<ul> <li>Site (Wassim) WordPress : <code>www.cimmob.chartres.sportludique.fr</code></li> <li>Site (David) WordPress : <code>www.david.cimmob.chartres.sportludique.fr</code></li> <li>Site (Simon) WordPress : <code>www.simon.cimmob.chartres.sportludique.fr</code></li> </ul>"},{"location":"Services/wordpress3/#prerequis","title":"Pr\u00e9requis","text":"<ul> <li>Serveur WordPress : <code>172.28.62.3</code></li> <li>Serveur Base de donn\u00e9es : <code>192.168.28.10</code></li> <li>Reverse Proxy : <code>172.28.62.5 (Nginx)</code></li> <li>DNS interne : <code>Bind9 (serveur autorit\u00e9 interne)</code></li> <li>WordPress install\u00e9 dans : <code>/var/www/html/wordpress</code></li> </ul>"},{"location":"Services/wordpress3/#1-choix-du-type-de-multisite","title":"1. Choix du type de multisite","text":"<p>WordPress permet deux modes de multisite :</p>"},{"location":"Services/wordpress3/#11-sous-domaines","title":"1.1 Sous-domaines","text":"<p>Exemple : site1.domain.fr, site2.domain.fr    \u2192 N\u00e9cessite la configuration DNS (wildcard ou enregistrements individuels).</p>"},{"location":"Services/wordpress3/#12-sous-repertoires","title":"1.2 Sous-r\u00e9pertoires","text":"<p>Exemple : domain.fr/site1, domain.fr/site2    \u2192 Ne n\u00e9cessite aucune modification DNS.</p> <p>Ici, nous choisirons la m\u00e9thode A \u00e0 savoir les Sous-domaines.</p>"},{"location":"Services/wordpress3/#2-activer-le-mode-multisite","title":"2. Activer le mode multisite","text":"<p>Modifier le fichier <code>wp-config.php</code> (\u00e0 la racine de WordPress).</p> <p>Ajouter avant la ligne : / That's all, stop editing! / :</p> <p><code>define('WP_ALLOW_MULTISITE', true);</code></p> <p>Enregistrer et recharger l\u2019interface d\u2019administration WordPress.</p>"},{"location":"Services/wordpress3/#3-installer-le-reseau-multisite","title":"3. Installer le r\u00e9seau multisite","text":"<p>Dans le tableau de bord WordPress :</p> <p><code>Outils &gt; Configuration du R\u00e9seau</code></p> <p>Choisir : - Sous-domaines</p> <p>Puis cliquer sur \u201cInstaller\u201d.</p>"},{"location":"Services/wordpress3/#4-ajouter-les-lignes-demandees-par-wordpress","title":"4. Ajouter les lignes demand\u00e9es par WordPress","text":"<p>Une fois l\u2019installation lanc\u00e9e, WordPress fournit deux blocs de code \u00e0 ajouter :</p>"},{"location":"Services/wordpress3/#41-dans-le-fichiers-wp-configphp","title":"4.1 Dans le fichiers <code>wp-config.php</code>","text":"<p>Le chemin d'acc\u00e8s : sudo nano /var/www/html/wordpress/wp-config.php</p> <pre><code>define('WP_ALLOW_MULTISITE', true);\ndefine('MULTISITE', true);\ndefine('SUBDOMAIN_INSTALL', true);\ndefine('DOMAIN_CURRENT_SITE', 'www.cimmob.chartres.sportludique.fr');\ndefine('PATH_CURRENT_SITE', '/');\ndefine('SITE_ID_CURRENT_SITE', 1);\ndefine('BLOG_ID_CURRENT_SITE', 1);\n</code></pre>"},{"location":"Services/wordpress3/#42-dans-le-fichier-htaccess","title":"4.2 Dans le fichier <code>.htaccess</code>","text":"<p>Le chemin d'acc\u00e8s : sudo nano /var/www/html/wordpress/.htaccess</p> <pre><code>RewriteEngine On\nRewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]\nRewriteBase /\nRewriteRule ^index\\.php$ - [L]\n\nRewriteRule ^wp-admin$ wp-admin/ [R=301,L]\n\nRewriteCond %{REQUEST_FILENAME} -f [OR]\nRewriteCond %{REQUEST_FILENAME} -d\nRewriteRule ^ - [L]\nRewriteRule ^(wp-(content|admin|includes).*) $1 [L]\nRewriteRule ^(.*\\.php)$ $1 [L]\nRewriteRule . index.php [L]\n</code></pre> <p>(WordPress fournit exactement les lignes adapt\u00e9es, il faut respecter ce qu\u2019il montre.)</p>"},{"location":"Services/wordpress3/#5-reconnexion","title":"5. Reconnexion","text":"<p>Apr\u00e8s les modifications, WordPress demande de se reconnecter. Vous \u00eates maintenant en mode multisite.</p>"},{"location":"Services/wordpress3/#6-creer-les-sites-pour-chaque-utilisateur","title":"6. Cr\u00e9er les sites pour chaque utilisateur","text":"<p>Aller dans :</p> <p>Mes sites &gt; R\u00e9seau admin &gt; Sites &gt; Ajouter</p> <p>Cr\u00e9er un site par personne, exemple :</p> <ul> <li>Domaine : cimmob.chartres.sportludique.fr</li> <li>Domaine : david.cimmob.chartres.sportludique.fr</li> <li>Domaine : simon.cimmob.chartres.sportludique.fr</li> </ul> <p>Chaque site est totalement ind\u00e9pendant.</p>"},{"location":"Services/wordpress3/#7-configuration-dns-proxy-si-vous-utilisez-les-sous-domaines","title":"7. Configuration DNS &amp; Proxy (si vous utilisez les sous-domaines)","text":"<p>Mettre en place la m\u00eame configuration pour tous les noms de domaines qui ont \u00e9t\u00e9 cr\u00e9\u00e9s via le Multisite gr\u00e2ce aux explications pr\u00e9sentes sur les pages suivantes :</p> <p>Vous pouvez aller voir la documention pour le Reverse Proxy &amp; DNS.</p>"},{"location":"Services/wordpress3/#8-gestion-des-utilisateurs","title":"8. Gestion des utilisateurs","text":"<p>Dans :</p> <p><code>R\u00e9seau admin &gt; Utilisateurs &gt; Ajouter</code></p> <p>Cr\u00e9er ou associer un utilisateur \u00e0 un site sp\u00e9cifique en lui donnant le r\u00f4le \u201cAdministrateur\u201d uniquement sur son site (et non sur le r\u00e9seau entier).</p>"},{"location":"Services/GLPI/Glpi/","title":"Installation d'un serveur GLPI (Version VIA DOCKER)","text":"<p>\u26a0\ufe0f L'installation du GLPI via Docker est diff\u00e9rente qu'une installation classique !  Pour voir la mise en place du Docker li\u00e9 \u00e0 celle de notre GLPI voir la documentation Docker</p>"},{"location":"Services/GLPI/Glpi/#objectif","title":"Objectif :","text":"<p>Notre serveur GLPI va nous permettre de centraliser la gestion du parc informatique et du support technique de l'organisation chartres.sportludique.</p> <p>Il offre une vue globale sur les \u00e9quipements (postes, serveurs, r\u00e9seaux, logiciels), facilite le suivi des incidents gr\u00e2ce \u00e0 un syst\u00e8me de tickets, automatise l\u2019inventaire des machines et am\u00e9liore la tra\u00e7abilit\u00e9 des interventions. </p> <p>En r\u00e9sum\u00e9, GLPI est un outil essentiel pour organiser, superviser et optimiser l\u2019ensemble des activit\u00e9s du service informatique.</p>"},{"location":"Services/GLPI/Glpi/#1-installation","title":"1. Installation","text":"<p>Comme pr\u00e9c\u00e9demment cit\u00e9, nous allons utiliser Docker pour installer notre service GLPI. Pour ce faire, apr\u00e8s avoir cr\u00e9\u00e9 le conteneur et le fichier docker-compose.yml, nous allons lui indiquer cette configuration :</p> <pre><code>version: \"3.9\"\n\nservices:\n  glpi:\n    image: diouxx/glpi:latest # Installe la d\u00e8rni\u00e8re versionde GLPI depuis les d\u00e9p\u00f4ts Docker\n    container_name: glpi_app # Nom du conteneur\n    restart: always\n    ports:\n      - \"172.28.33.8:2000:80\"   # Mappage des ports (expliqu\u00e9 en dessous)\n      - \"10.10.120.15:2000:80\"  \n    environment:\n      GLPI_DB_HOST: ${DB_HOST} # Appel de variables, pr\u00e9sentes dans le fichier .env\n      GLPI_DB_NAME: ${DB_NAME}\n      GLPI_DB_USER: ${DB_USER}\n      GLPI_DB_PASSWORD: ${DB_PASSWORD}\n    volumes: \n      - ./glpi:/var/www/html/glpi # Mappage des volumes (expliqu\u00e9 en dessous)\n    networks:\n      - glpi_net #Isolation des r\u00e9seaux\n\nnetworks:\n  glpi_net:\n    driver: bridge\n</code></pre>"},{"location":"Services/GLPI/Glpi/#2-differences","title":"2. Diff\u00e9rences","text":"<p>Avec notre installation Docker, plusieurs diff\u00e9rences existent entre une installation Docker et une installation classique.</p>"},{"location":"Services/GLPI/Glpi/#21-instalation","title":"2.1 Instalation","text":"<p>GLPI est install\u00e9 depuis les d\u00e9p\u00f4ts Docker. \u00c9tant donn\u00e9 que GLPI est dans un conteneur, la version utilis\u00e9e est une version sp\u00e9ciale Docker qui fonctionnera sur tous les OS.</p>"},{"location":"Services/GLPI/Glpi/#22-mappage-des-ports","title":"2.2 Mappage des ports","text":"<p>Compte tenu de l'existence de plusieurs services gr\u00e2ce \u00e0 Docker, il est possible que plusieurs services aient besoin du m\u00eame port de sortie (80, 443, etc.). Le mappage des ports permet de r\u00e9soudre cette probl\u00e9matique : on attribue un port local de la machine \u00e0 un port virtuel du conteneur, ce qui \u00e9vite de modifier les fichiers de configuration de nos applications. </p> <p>Dans notre cas, nous avons attribu\u00e9 et d\u00e9limit\u00e9 ces ports :</p> <p><pre><code>  - \"172.28.33.8:2000:80\"\n  - \"10.10.120.15:2000:80\"  \n</code></pre> Nous autorisons le r\u00e9seau <code>172.28.33.8</code> et le r\u00e9seau <code>10.10.120.15</code> sur ce conteneur. Le port 2000 est le port local de notre machine (port \u00e0 contacter pour joindre le conteneur Docker) et il est mapp\u00e9 sur le port 80 du conteneur. Cela signifie que toutes les requ\u00eates adress\u00e9es au port 2000 des deux r\u00e9seaux autoris\u00e9s de notre VM arriveront sur le port 80 du conteneur GLPI.</p>"},{"location":"Services/GLPI/Glpi/#23-mappage-des-volumes","title":"2.3 Mappage des volumes","text":"<p>Par d\u00e9faut, les fichiers d'un conteneur sont internes \u00e0 celui-ci. Quand le conteneur est stopp\u00e9, tous ses fichiers sont supprim\u00e9s. Il est donc important de mapper un volume. Ce mappage permet de sauvegarder les fichiers d'un conteneur dans un dossier local de la machine, rendant possible la sauvegarde de ceux-ci ainsi que la persistance des configurations. Dans notre cas, nous avons mapp\u00e9 le dossier <code>/glpi</code> de notre machine locale vers le dossier <code>/var/www/html/glpi</code> de notre conteneur.</p> <p>Nous retrouvons bien les fichiers de GLPI dans le dossier <code>glpi</code> de notre machine locale.</p> <pre><code>user@user:~/glpi/glpi$ ls\najax        bin           config           css                   files  inc         install     lib      locales      plugins  README.md  routes       src         templates  version\napirest.md  CHANGELOG.md  CONTRIBUTING.md  dependency_injection  front  index.html  INSTALL.md  LICENSE  marketplace  public   resources  SECURITY.md  SUPPORT.md  vendor\n</code></pre>"},{"location":"Services/GLPI/Glpi/#isolation-des-reseaux","title":"Isolation des r\u00e9seaux","text":"<p>L'isolation des r\u00e9seaux est la cr\u00e9ation de cartes virtuelles propres \u00e0 chaque conteneur, qui ne s'activent que lors du lancement du conteneur associ\u00e9. Cela permet d'\u00e9viter toute communication ind\u00e9sirable entre les conteneurs.</p>"},{"location":"Services/GLPI/Glpi2/","title":"Mise en place du LDAP entre l'AD &amp; GLPI","text":""},{"location":"Services/GLPI/Glpi2/#objectif","title":"Objectif :","text":"<p>La mise en place de la liaison LDAP entre l'AD &amp; GLPI va permettre \u00e0 tous les utilisateurs du domaine chartres.sportludique de pouvoir se connecter au GLPI afin de faire des tickets, demandes et autres. Ainsi qu'aux utilisateurs de la DSI de g\u00e9rer les configurations, tickets, demandes faites par les clients gr\u00e2ce aux habilitations Super-Admin qui leur seront attribu\u00e9s.</p>"},{"location":"Services/GLPI/Glpi2/#1-prerequis","title":"1. Pr\u00e9requis","text":"<ul> <li>Serveur GLPI fonctionnel (mis en place sur un Docker dans le cas pr\u00e9sent).</li> <li>Serveur AD fonctionnel avec les utilistaeurs.</li> </ul>"},{"location":"Services/GLPI/Glpi2/#2-configuration-annuaire-ldap","title":"2. Configuration annuaire LDAP","text":"<p>Connectez-vous \u00e0 l'interface GLPI avec un compte administrateur, puis dans le menu : Configuration \u2192 Authentification \u2192 Annuaire LDAP \u2192 Ajouter.</p> <p>Vous devez \u00eatre rendu sur cette interface : </p> <p></p> <p>Voici les valeurs \u00e0 remplir dans notre cas : </p> Param\u00e8tre Valeur Nom Active Directory Serveur par d\u00e9faut Oui Actif Oui Serveur 10.10.120.2 Port 389 Filtre de connexion Laisser le champ vide BaseDN DC=cha,DC=chartres,DC=sportludique,DC=fr Utiliser bind Oui DN du compte admin.ldap Mot de passe du compte Mot de passe du compte - voir keepass Champ de l'identifiant SamAccountName Champ de synchronisation Laisser le champ vide <p>Dans la foul\u00e9e, GLPI va effectuer un test de connexion LDAP et vous indiquer s'il est parvenu, ou non, \u00e0 se connecter \u00e0 votre annuaire. Si ce n'est pas le cas , cliquez sur le nom de votre annuaire, v\u00e9rifiez la configuration, puis retournez dans \"Tester\" sur la gauche afin de lancer un nouveau test. </p>"},{"location":"Services/GLPI/Glpi2/#3-importation-des-utilisateurs-de-lad","title":"3. Importation des utilisateurs de l'AD","text":"<p>A partir de GLPI, vous pouvez forcer une synchronisation LDAP de fa\u00e7on \u00e0 mettre \u00e0 jour les comptes dans GLPI \"li\u00e9s\" \u00e0 des comptes Active Directory, mais aussi pour importer en masse tous les comptes des utilisateurs Active Directory. Ceci vous \u00e9vite d'attendre la premi\u00e8re connexion et vous permet de pr\u00e9parer le compte : attribution du bon r\u00f4le, etc.</p> <p>Cliquez sur \"Administration\" dans le menu, puis \"Utilisateurs\". Ici, vous avez acc\u00e8s au bouton \"Liaison annuaire LDAP\".</p> <p></p> <p>Si vous cliquez sur \"Importation de nouveaux utilisateurs\", vous pourrez importer en masse les comptes dans l'Active Directory. Il vous suffit de lancer une recherche, de s\u00e9lectionner les comptes \u00e0 importer et de lancer l'import gr\u00e2ce au bouton \"Actions\".</p>"},{"location":"Services/GLPI/Glpi2/#4-attribution-des-habilitations-aux-utilisateurs-dsi-admin","title":"4. Attribution des habilitations aux utilisateurs DSI (Admin)","text":"<p>Rendez-vous dans le menu : Administration \u2192 Utilisateurs \u2192 Cliquer sur le profil souhait\u00e9 \u2192 Habilitations.</p> <p>Une fois rendu ici, remplissez les champs suivants avant de cliquer sur Ajouter: </p> Entit\u00e9 Profil R\u00e9cursif Entr\u00e9e Racine Selectionner le profil avec les droits souhait\u00e9s : Super-Admin pour la DSI Non <p>D\u00e8s lors que l'entit\u00e9 appara\u00eet dans la liste, l'utilisateur a donc les habilitations s\u00e9lectionn\u00e9es au pr\u00e9alable.</p>"},{"location":"Services/GLPI/Glpi3/","title":"Deploiement de l'agent GLPI sur toutes les VM Linux via Ansible","text":""},{"location":"Services/GLPI/Glpi3/#1-prerequis","title":"1. Pr\u00e9requis","text":"<p>Nous avons besoin de :</p> <p>\u2714 L\u2019URL du serveur GLPI (ex : http://10.10.120.15) \u2714 Le lien de t\u00e9l\u00e9chargement de l\u2019agent GLPI Linux \u2714 Le port utilis\u00e9 par l\u2019agent (par d\u00e9faut 62354)</p>"},{"location":"Services/GLPI/Glpi3/#2-creer-un-dossier-dedie-aux-playbooks","title":"2. Cr\u00e9er un dossier d\u00e9di\u00e9 aux playbooks","text":"<p>Sur ton serveur Ansible :</p> <pre><code>sudo mkdir -p /etc/ansible/playbooks\ncd /etc/ansible/playbooks\n</code></pre>"},{"location":"Services/GLPI/Glpi3/#3-creer-le-playbook-dinstallation-glpi","title":"3. Cr\u00e9er le playbook d\u2019installation GLPI","text":"<p>Cr\u00e9e le fichier :</p> <pre><code>sudo nano /etc/ansible/playbooks/install_glpi_agent.yml\n</code></pre> <p>Colle ce playbook pr\u00eat \u00e0 l\u2019emploi :</p> <p>\ud83d\udccc install_glpi_agent.yml (copie EXACTE \u00e0 mettre dans le fichier)</p> <pre><code>---\n- name: Installer et configurer l'agent GLPI sur toutes les VM Linux\n  hosts: all_linux\n  become: yes\n\n  vars:\n    glpi_release_folder: \"1.7\"\n    glpi_agent_filename: \"glpi-agent_1.7-1_all.deb\"\n    glpi_agent_url: \"https://github.com/glpi-project/glpi-agent/releases/download/{{ glpi_release_folder }}/{{ glpi_agent_filename }}\"\n    glpi_server_url: \"http://10.10.120.15/front/inventory.php\"\n\n  tasks:\n\n    - name: 1. Mettre \u00e0 jour le cache APT\n      ansible.builtin.apt:\n        update_cache: yes\n      tags: update\n\n    - name: 2. T\u00e9l\u00e9charger le package GLPI Agent (DEB)\n      ansible.builtin.get_url:\n        url: \"{{ glpi_agent_url }}\"\n        dest: \"/tmp/glpi-agent.deb\"\n        mode: '0644'\n\n    - name: 3. Installer le package GLPI Agent\n      ansible.builtin.apt:\n        deb: \"/tmp/glpi-agent.deb\"\n        state: present\n        update_cache: yes\n      notify:\n        - D\u00e9marrer et Activer GLPI Agent\n\n    # --- T\u00c2CHES DE NETTOYAGE ET DE CONFIGURATION (NO AUTH) ---\n\n    - name: 4a. Configurer l'URL du serveur GLPI dans agent.cfg\n      ansible.builtin.lineinfile:\n        path: /etc/glpi-agent/agent.cfg\n        regexp: '^server ='\n        line: 'server = {{ glpi_server_url }}'\n        state: present\n      notify: Red\u00e9marrer GLPI Agent pour appliquer la config\n\n    - name: 4b. Supprimer l'ancienne configuration de login (pour Aucune Authentification)\n      ansible.builtin.lineinfile:\n        path: /etc/glpi-agent/agent.cfg\n        regexp: '^user ='\n        state: absent\n      notify: Red\u00e9marrer GLPI Agent pour appliquer la config\n\n\n    - name: 4c. Supprimer l'ancienne configuration de mot de passe\n      ansible.builtin.lineinfile:\n        path: /etc/glpi-agent/agent.cfg\n        regexp: '^password ='\n        state: absent\n      notify: Red\u00e9marrer GLPI Agent pour appliquer la config\n\n  handlers:\n\n    # 1. Handler pour d\u00e9marrer l'agent apr\u00e8s l'installation\n    - name: D\u00e9marrer et Activer GLPI Agent\n      ansible.builtin.systemd:\n        name: glpi-agent\n        enabled: yes\n        state: started\n\n    # 2. Handler pour red\u00e9marrer l'agent apr\u00e8s une modification de config (celui qui manquait)\n    - name: Red\u00e9marrer GLPI Agent pour appliquer la config\n      ansible.builtin.systemd:\n        name: glpi-agent\n        enabled: yes\n        state: restarted\n</code></pre>"},{"location":"Services/GLPI/Glpi3/#4-lancer-linstallation-sur-toutes-tes-vm","title":"4. Lancer l\u2019installation sur TOUTES tes VM","text":"<p>Depuis le serveur Ansible :</p> <pre><code>ansible-playbook /etc/ansible/playbooks/install_glpi_agent.yml\n</code></pre> <p>Si tout est OK, tu verras des lignes changed=true un peu partout.</p> <p>Forcer l'inventaire si apr\u00e8s le lancement les machines n'apparaissent pas dans le GLPI.</p> <pre><code>ansible all_linux -b -m shell -a \"sudo glpi-agent --server http://10.10.120.15/front/inventory.php --force\"\n</code></pre>"},{"location":"Services/GLPI/Glpi3/#5-verifier-que-lagent-fonctionne","title":"5. V\u00e9rifier que l\u2019agent fonctionne","text":"<p>Ex\u00e9cute :</p> <pre><code>ansible all_linux -a \"systemctl status glpi-agent\" -b\n</code></pre> <p>Tu dois voir quelque chose comme :</p> <pre><code>Active: active (running)\n</code></pre>"},{"location":"Services/GLPI/Glpi5/","title":"D\u00e9ploiement de l\u2019agent GLPI sur toutes les VM Windows via GPO","text":""},{"location":"Services/GLPI/Glpi5/#objectif","title":"Objectif :","text":"<p>Centraliser l\u2019inventaire mat\u00e9riel et logiciel des machines Windows du domaine via l\u2019agent GLPI. L\u2019objectif est de d\u00e9ployer l\u2019agent automatiquement sur toutes les machines de l\u2019infrastructure gr\u00e2ce \u00e0 une GPO et la configuration du registre.</p>"},{"location":"Services/GLPI/Glpi5/#1-configuration-des-serveurs-et-preparation","title":"1. Configuration des serveurs et pr\u00e9paration","text":""},{"location":"Services/GLPI/Glpi5/#11-definir-les-serveurs-concernes-et-le-chemin-du-deploiement","title":"1.1 D\u00e9finir les serveurs concern\u00e9s et le chemin du d\u00e9ploiement :","text":"<pre><code>$servers = @(\n    \"CHA-DC-01\",    # AD Principal\n    \"CHA_DC_02\",    # AD Secondaire\n    \"CHA-HMAIL\"     # Serveur Mail\n)\n\n$deployPath = \"C:\\Deploy\\GLPI-Agent\"\n$batDest = \"$deployPath\\glpi-agent.bat\"\n$shareName = \"Deploy\"\n$gpoName = \"D\u00e9ploiement Agent GLPI\"\n</code></pre>"},{"location":"Services/GLPI/Glpi5/#12-verifier-le-fichier-glpi-agentbat","title":"1.2 V\u00e9rifier le fichier <code>glpi-agent.bat</code> :","text":"<pre><code>if (-not (Test-Path $batDest)) {\n    Write-Host \"\u274c Le fichier glpi-agent.bat n'existe pas dans $deployPath !\"\n    exit\n}\n</code></pre>"},{"location":"Services/GLPI/Glpi5/#13-creer-le-partage-reseau-pour-le-deploiement","title":"1.3 Cr\u00e9er le partage r\u00e9seau pour le d\u00e9ploiement :","text":"<pre><code>if (Get-SmbShare -Name $shareName -ErrorAction SilentlyContinue) {\n    Remove-SmbShare -Name $shareName -Force\n}\n\nNew-SmbShare -Name $shareName -Path \"C:\\Deploy\" -ReadAccess \"Authenticated Users\" -FullAccess \"Administrators\"\n\nChemin du partage : \\\\CHA-DC-01\\Deploy\n</code></pre>"},{"location":"Services/GLPI/Glpi5/#2-creation-de-la-gpo-pour-deploiement","title":"2. Cr\u00e9ation de la GPO pour d\u00e9ploiement","text":""},{"location":"Services/GLPI/Glpi5/#21-creer-ou-recuperer-la-gpo","title":"2.1 Cr\u00e9er ou r\u00e9cup\u00e9rer la GPO :","text":"<pre><code>$gpo = Get-GPO -Name $gpoName -ErrorAction SilentlyConti(optionnel)nue\nif (!$gpo) {\n    $gpo = New-GPO -Name $gpoName\n}\n</code></pre>"},{"location":"Services/GLPI/Glpi5/#22-lier-la-gpo-a-toutes-les-machines-de-linfrastructure","title":"2.2 Lier la GPO \u00e0 toutes les machines de l\u2019infrastructure :","text":"<p>Exemple : lier \u00e0 la racine du domaine pour toucher toutes les machines</p> <pre><code>New-GPLink -Name $gpoName -Target \"DC=mondomaine,DC=local\"\n</code></pre>"},{"location":"Services/GLPI/Glpi5/#3-deploiement-de-lagent-glpi-via-la-gpo","title":"3. D\u00e9ploiement de l\u2019agent GLPI via la GPO","text":""},{"location":"Services/GLPI/Glpi5/#31-dans-la-console-gpmc-sur-cha-dc-01","title":"3.1 Dans la console GPMC (sur CHA-DC-01) :","text":"<ul> <li>Win + R \u2192 <code>gpmc.msc</code> \u2192 Entr\u00e9e OU Menu D\u00e9marrer \u2192 Outils d\u2019administration \u2192 Gestion des strat\u00e9gies de groupe</li> </ul>"},{"location":"Services/GLPI/Glpi5/#32-localiser-la-gpo-deploiement-agent-glpi-et-modifier","title":"3.2 Localiser la GPO \u201cD\u00e9ploiement Agent GLPI\u201d et modifier :","text":"<pre><code>Configuration ordinateur\n    \u2192 Strat\u00e9gies\n        \u2192 Param\u00e8tres logiciels\n            \u2192 Installation de logiciels\n</code></pre>"},{"location":"Services/GLPI/Glpi5/#4-configuration-du-registre-via-gpo","title":"4. Configuration du registre via GPO","text":"<p>Pour que toutes les machines pointent vers le serveur GLPI correct :</p> \u00c9l\u00e9ment Valeur Chemin du registre HKEY_LOCAL_MACHINE\\SOFTWARE\\GLPI-Agent Valeur server Type REG_SZ Donn\u00e9e http://10.10.120.15/front/inventory.php Action Mettre \u00e0 jour <p>Cela permet de configurer automatiquement l\u2019adresse du serveur GLPI pour toutes les machines.</p>"},{"location":"Services/GLPI/Glpi5/#5-installation-manuelle-dc-principal","title":"5. Installation manuelle (DC principal)","text":"<ul> <li> <p>Installer manuellement l\u2019agent sur CHA-DC-01 : <code>\"C:\\Program Files\\GLPI-Agent\\glpi-agent.bat\" --server http://10.10.120.15/front/inventory.php --force --debug --logger=stderr</code></p> </li> <li> <p>V\u00e9rifier que l\u2019agent remonte dans GLPI.</p> </li> </ul>"}]}